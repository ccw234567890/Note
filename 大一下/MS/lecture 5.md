![[Pasted image 20250811165348.png]]
![[Pasted image 20250811165446.png]]
![[Pasted image 20250811165549.png]]
![[Pasted image 20250811165624.png]]
![[Pasted image 20250811165705.png]]
![[Pasted image 20250811165755.png]]

![[Pasted image 20250811165825.png]]
![[Pasted image 20250811165855.png]]
![[Pasted image 20250811165935.png]]
![[Pasted image 20250811170014.png]]
![[Pasted image 20250811170121.png]]

# 笔记：数模转换器 (DAC) 全解析 - 将数字世界的声音转为现实

> [!abstract] 核心纲要
> 本笔记旨在深入剖析**数模转换器 (DAC)** 的核心概念与工作原理。我们将重点关注：
> 1.  **DAC的必要性**: 为什么它是微控制器系统输出模拟信号的唯一途径。
> 2.  **DAC的四步工作法**: 从接收二进制数字到输出连续模拟电压的内部流程。
> 3.  **DAC的两大核心指标**: **分辨率（精度）**与**采样频率（速度）**。
> 4.  **实践中的挑战**: 通过mbed代码实例，理解DAC在**分辨率**和**转换时间**上的实际限制。

---

### Ⅰ. 什么是DAC？- 连接数字世界与模拟世界

> [!info]
> **定义**: **数模转换器 (DAC)** 是一种将**数字信号**（通常是二进制数）转换为**连续变化的模拟信号**（通常是电压或电流）的电子设备。

> [!check] **核心功能：数字到物理量的转换**
> - **ADC的反向过程**: 如果说ADC是“读取”模拟世界，那么DAC就是“**书写**”或“**影响**”模拟世界。
> - **多输入，单输出**: DAC接收多条并行的**二进制输入**线（例如8位、12位），并将它们代表的数值，转换成**单一的模拟输出**电压。
> - **能量相加**: 与ADC的“信号切割”（量化）相反，DAC的过程可以被理解为一种“**能量相加**”。它根据每个输入位的权重，将能量（电压）累加起来，形成最终的输出。

---

### Ⅱ. DAC的工作流程：从二进制码到模拟电压

> [!example]
> 一个通用的DAC内部通常包含四个主要步骤来完成转换。



> [!todo] **第1步：输入电路 (Input Circuit)**
> > - **作用**: 安全地接收来自微控制器（MCU）的二进制数字输入信号，并可能进行一些初步的滤波。

> [!todo] **第2步：电压切换电路 (Voltage Switching Circuit)**
> > - **作用**: 像一组由输入二进制位控制的**高速开关**。
> > - **机制**: 根据输入的某一位是 `1` 还是 `0`，这个电路会将下一级的对应部分连接到一个**精确的参考电压 (Reference Voltage)** 或 **地 (Ground)**。

> [!todo] **第3步：电阻网络 (Resistive Network)**
> > - **作用**: **DAC的核心部分**，负责为每个输入位赋予不同的“**权重**”。
> > - **机制**: 通过一个精密设计的电阻网络（如 **R-2R梯形网络**），将来自切换电路的电压信号进行加权求和。最高有效位 (MSB) 的开关会对输出电压产生最大的影响，而最低有效位 (LSB) 的影响最小。

> [!todo] **第4步：放大器 (Amplifier)**
> > - **作用**: 通常是一个**运算放大器 (Op-Amp)**，负责对电阻网络产生的电压信号进行**缓冲或放大**。
> > - **机制**: 它提供一个稳定、低阻抗的最终模拟信号输出，使其能够驱动后续的电路或设备。

---

### Ⅲ. DAC的两大核心指标：精度与速度

> [!help]
> 与ADC类似，任何一个DAC的性能，都主要由**分辨率**和**采样频率**这两个核心参数来定义。

> [!tip] **1. 分辨率 (Resolution) - 输出的“细腻度”**
> > - **定义**: 由DAC的**输入位数 `n`** 决定。一个 `n` 位的DAC，可以产生 **$2^n$** 个离散的输出电压等级。
> > - **输出步长 (Output Step Size)**: DAC能够产生的**最小电压变化量**。
> >   - **公式**: `Step Size = V_ref / 2ⁿ`
> >   - **图中示例**: 一个8位的DAC，参考电压 `V_ref=10V`。
> >     - 它可以产生 $2^8 = 256$ 个电压等级。
> >     - 其最小电压步长为 `10V / 256 = 0.0391V`。

> [!danger] **2. 最大采样频率 (Maximum Sampling Frequency) - 转换的“速度”**
> > - **定义**: DAC能够**每秒钟**处理多少个新的数字输入值。
> > - **作用**: 这个参数决定了DAC能够生成的模拟信号的**最高频率**。要生成一个平滑的高频正弦波，就需要一个非常高的采样频率。

---

### Ⅳ. 实践中的挑战与考量

> [!cite]
> 通过mbed平台的代码实例，我们可以看到DAC在实际应用中的一些具体问题。

> [!warning] **实践问题一：分辨率的限制**
> > - **代码示例 (Program 1)**: 程序试图在一个循环中，以 `0.0001` 的极小增量来改变 `AnalogOut` 的浮点值。
> > - **问题分析**:
> >   - `0.0001`的软件增量对应的电压变化仅为 `0.36mV`。
> >   - 而一个12位的DAC（$2^{12}=4096$级），其物理上的最小电压步长 `V_res` 经计算为 `0.87mV`。
> > - **结论**: **DAC的输出电压，只有在软件中的目标值变化量累积到超过其物理最小步长时，才会真正发生一次跳变**。这就是为什么代码中输出电压大约每隔“2步”循环才变化一次的原因。

> [!note] **实践问题二：转换需要时间**
> > - **代码示例 (Program 2)**: 程序先执行一次ADC转换，然后立即用其结果执行一次DAC转换。同时用一个数字引脚 `test` 输出脉冲来标记每个操作的结束时间。
> > - **示波器追踪**: `test` 引脚的波形显示，ADC转换和DAC转换都需要花费一定的时间，它们**不是瞬时完成的**。
> >   - **单脉冲 (Single pulse)**: 标记ADC转换结束。
> >   - **双脉冲 (Double pulse)**: 标记DAC转换结束。
> > - **结论**: 在需要高速实时控制的系统中，必须考虑ADC和DAC的转换延迟。

![[Pasted image 20250811170336.png]]
![[Pasted image 20250811170259.png]]![[Pasted image 20250811170425.png]]
![[Pasted image 20250811170516.png]]
![[Pasted image 20250811170601.png]]
![[Pasted image 20250811170631.png]]
![[Pasted image 20250811170702.png]]
![[Pasted image 20250811170732.png]]
![[Pasted image 20250811170802.png]]
![[Pasted image 20250811170819.png]]
![[Pasted image 20250811170907.png]]
![[Pasted image 20250811170930.png]]
# 笔记：DAC核心电路原理 - 加权电阻 vs. R-2R梯形网络

> [!abstract] 核心纲要
> 本笔记旨在深入剖析**数模转换器 (DAC)** 将二进制数字转换为模拟电压的内部电路实现。我们将重点关注：
> 1.  **DAC的数学原理**: 理解二进制数的“位权”如何通过加权求和转换成十进制值。
> 2.  **两种核心电路**: 详细对比**加权电阻网络 (Weighted Resistors)**和**R-2R梯形网络 (R-2R Ladder Network)**的原理、优缺点。
> 3.  阐明为何**R-2R梯形网络**是现代集成电路中更常用、更优越的设计方案。

---

### Ⅰ. DAC的数学原理：二进制的“加权求和”

> [!info]
> DAC工作的根本，是将一个二进制数的每一位，根据其所在的位置（位权），赋予不同的权重，然后将它们“加”起来，形成一个与该二进制数成正比的模拟电压。

> [!example] **位权 (Bit Weight) = 2ⁿ**
> > - **定义**: 在一个二进制数中，从右往左数，第 `n` 位（从0开始）的权重是 $2^n$。
> > - **最高有效位 (MSB)**: 最左边的位，权重最大。
> > - **最低有效位 (LSB)**: 最右边的位，权重最小。
> >
> > **示例**: `10011₂` 如何转换为十进制？
> > $$
> > \begin{align*}
> > 10011_2 &= (1 \times 2^4) + (0 \times 2^3) + (0 \times 2^2) + (1 \times 2^1) + (1 \times 2^0) \\
> > &= 16 + 0 + 0 + 2 + 1 \\
> > &= 19_{10}
> > \end{align*}
> > $$
> **DAC电路的核心任务，就是用模拟电路（主要是电阻和运放）来实现这个数学上的“加权求和”过程。**

---

### Ⅱ. 两种核心电路实现

> [!question]
> 在DAC的四步流程（输入->切换->**电阻网络**->放大）中，最核心的“电阻网络”是如何实现“加权”的呢？主要有两种方法。

> [!danger] **方法一：加权电阻网络 (Weighted Resistors Method)**
> > - **原理**: 利用一个**求和运算放大器**电路。每个输入的二进制位 `Bᵢ` 控制一个开关，决定是否将一个与之对应的电阻 `Rᵢ` 连接到参考电压 `Vref`。
> > - **“加权”的实现**: 为了让每个位具有正确的二进制权重，电阻的值必须**指数级变化**。
> >   - LSB (最低位) 对应的电阻最大。
> >   - 每向高位移动一位，电阻值**减半**。
> >   - 例如，对于一个n位的DAC，电阻关系为：$R_{LSB} = 2^{n-1} \cdot R_{MSB}$。
> >
> >
> >
> > > [!fail] **致命缺陷**
> > > 1. **电阻值范围巨大**: 随着位数的增加，所需电阻值的范围呈指数级增长。一个12位的DAC可能需要从 `1 kΩ` 到 `2 MΩ` 跨度的电阻。
> > > 2. **精度难以保证**: 在单个芯片上，制造出阻值范围如此之大、且比例关系又极其精确的电阻，是非常困难和昂贵的。
> > > 3. **误差敏感**: 大阻值的微小误差，就会对最终输出精度造成巨大影响。
> > >
> > > **结论**: 由于这些难以克服的制造难题，**加权电阻网络在实际中很少用于高位数的DAC**。

> [!success] **方法二：R-2R梯形网络 (R-2R Ladder Network Method)**
> > - **原理**: 采用一种非常巧妙的、由两种阻值的电阻 `R` 和 `2R` 重复排列组成的“梯形”结构。
> > - **“加权”的实现**: 通过电路的串并联特性（戴维南等效），这个梯形网络能够自动地、精确地为每个输入位实现 $2^n$ 的二进制加权。
> >
> > 
> >
> > > [!check] **巨大优势**
> > > 4. **仅需两种阻值 (R 和 2R)**: 芯片制造中，要精确控制电阻的**相对比例**远比控制其**绝对值**容易。因此，制造大量精确匹配的 `R` 和 `2R` 电阻非常方便。
> > > 5. **易于扩展**: 想要增加DAC的位数？只需在梯形网络上**再加一个R-2R单元**即可，设计极其简单。
> > > 6. **精度更高、更准确**: 由于电阻值匹配度高，R-2R网络的精度和线性度远优于加权电阻网络。
> > >
> > > **结论**: **因其设计简单、易于制造且精度高，R-2R梯形网络是现代集成电路DAC中最主流、最常用的架构。****