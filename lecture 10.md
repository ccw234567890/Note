![[屏幕截图 2025-08-12 154441.png]]

![[屏幕截图 2025-08-12 154456.png]]

![[屏幕截图 2025-08-12 154509.png]]

![[屏幕截图 2025-08-12 154528.png]]

![[屏幕截图 2025-08-12 154551.png]]

![[屏幕截图 2025-08-12 154606.png]]

![[屏幕截图 2025-08-12 154625.png]]

![[屏幕截图 2025-08-12 154641.png]]

# 笔记：SPI (Serial Peripheral Interface) 协议全解析

> [!abstract] 核心纲要
> 本笔记旨在深入剖析**SPI (串行外设接口)** 的核心概念与工作原理。我们将重点关注：
> 1.  **SPI是什么**: 了解其作为一种**高速、全双工、同步**通信协议的定位和优势。
> 2.  **硬件连接**: 详细解析其经典的**四线制**结构（MOSI, MISO, SCLK, SS）中每个引脚的职责。
> 3.  **数据传输流程**: 理解其主从架构下，数据是如何以**连续流**的形式进行**全双工**交换的。
> 4.  **SPI的典型应用**: 了解在哪些场景下SPI是首选的通信方案。

---

### Ⅰ. SPI是什么？- 一种高速的串行接口

> [!info]
> - **全称**: **S**erial **P**eripheral **I**nterface (串行外设接口)。
> - **定义**: 一种由摩托罗拉在1980年代开发的**同步、串行、全双工**通信协议，采用**单主多从 (single master, one or more slaves)** 架构。
> - **定位**:
>   - 相比于USB、以太网等高速协议，SPI、I2C和UART都属于**低速通信协议**，但它们**更简单**且使用的**硬件更少**。
>   - 相比于I2C和UART，SPI通常能提供**更快的速度**。

---

### Ⅱ. 硬件连接：经典的四线制系统

> [!example]
> 标准的SPI通信需要使用四根信号线来连接一个主设备（通常是MCU）和一个或多个从设备（外设）。

![SPI 4-Wire System](https://i.imgur.com/81Y0B3s.png)

> [!check] **四根线的职责 (Pin Description)**
> 1. **SCLK (Serial Clock)**: **串行时钟**
>    - 由**主设备 (Master)** 产生，为数据传输提供同步节拍。
>    - 从设备 (Slaves) **不需要**自己的时钟，完全依赖主设备的时钟信号。
>    - 时钟只在数据传输期间是**活动**的。
> 2. **CS / SS (Chip Select / Slave Select)**: **从设备选择**
>    - **作用**: 在有多个从设备时，主设备通过将特定从设备的CS/SS线**拉为低电平**来“选中”它进行通信。
>    - **寻址方式**: 这是一种简单的、基于**独立线路**的寻址方式，与I2C的地址码寻址不同。
>    - **特性**: 通常是**低电平有效 (Active Low)**，所以信号名上常有一条横线，表示 `¯CS` 或 `¯SS`。
> 3. **MOSI (Master Output, Slave Input)**: **主出从入**
>    - **作用**: 数据**从主设备流向从设备**的通道。
>    - **别名**: SDO (Serial Data Out), SDI (Serial Data In) 等，取决于你看的是主设备还是从设备的数据手册。
> 4. **MISO (Master In, Slave Out)**: **主入从出**
>    - **作用**: 数据**从从设备流回主设备**的通道。

---

### Ⅲ. 数据传输流程：全双工的数据交换

> [!help]
> SPI的数据传输可以看作是主从设备内部的两个**移位寄存器**在进行**同步的数据交换**。

> [!tip] **核心特性**
> > - **连续流 (Continuous Stream)**: 与UART和I2C的“数据包”不同，SPI可以无中断地传输**任意数量**的比特位。
> > - **全双工 (Full-duplex)**: 主设备在通过**MOSI**线发送数据的**同时**，也在通过**MISO**线接收数据。

> [!success] **基本传输步骤**
> 1. **选择从设备**: 主设备将目标从设备的 **CS/SS 线拉为低电平**，激活该设备。
> 2. **启动时钟**: 主设备在 **SCLK** 线上产生时钟脉冲。
> 3. **同步交换**:
>    - 在**每一个**时钟脉冲的驱动下，主设备将1位数据推上**MOSI**线。
>    - **与此同时**，被选中的从设备也将1位数据推上**MISO**线。
>    - 主设备和从设备同时完成一次1位的发送和接收。
> 4. **结束通信**: 数据传输完毕后，主设备将 **CS/SS 线拉回高电平**，结束本次通信。
>
> ![SPI Timing Diagram](https://i.imgur.com/KzG5ebY.png)
>
> **实际应用示例**:
> 主设备（MCU）可以通过MOSI线向一个ADC/DAC芯片**写入配置参数**，并**同时**通过MISO线**读回上一次的ADC测量结果**，极大地提高了通信效率。

---

### Ⅳ. SPI的典型应用

> [!list]
> SPI因其**高速**和**全双工**的特性，被广泛用于需要大数据量、高速度传输的场景：
> - **传感器 (Sensors)**: 如陀螺仪、加速度计。
> - **显示设备 (Displays)**: 驱动各类LCD和OLED屏幕。
> - **数据转换器 (ADC/DAC)**。
> - **实时时钟 (RTC)**。
> - **游戏手柄 (Game controllers)**。
> - **存储设备 (Memory)**: 如SD卡和Flash闪存芯片。



![[屏幕截图 2025-08-12 154656.png]]

![[屏幕截图 2025-08-12 154710.png]]

![[屏幕截图 2025-08-12 154727.png]]

![[屏幕截图 2025-08-12 154743.png]]

![[屏幕截图 2025-08-12 154801.png]]

![[屏幕截图 2025-08-12 154820.png]]

![[屏幕截图 2025-08-12 154838.png]]

![[屏幕截图 2025-08-12 154855.png]]





# 笔记：SPI协议深度解析 - 移位寄存器与多从机配置

> [!abstract] 核心纲要
> 本笔记旨在深入剖析**SPI (串行外设接口)** 的核心工作原理与多设备连接方案。我们将重点关注：
> 1.  **SPI的本质**: 理解其基于**移位寄存器 (Shift Registers)** 的全双工数据交换机制。
> 2.  **多从设备配置**: 详细对比**标准独立总线**和**菊花链 (Daisy-Chain)** 两种连接方式。
> 3.  **SPI的关键属性**: 明确其在通信确认、寻址等方面的协议局限性。

---

### Ⅰ. SPI的核心机制：一个由移位寄存器构成的“环”

> [!info]
> **SPI通信的本质**，可以被看作是**主设备 (Master)** 和**从设备 (Slave)** 内部的两个**移位寄存器**连接成一个环，然后进行同步的数据**交换**。

> [!example] **工作流程：同步数据交换**
> 1. **加载数据**: 通信开始前，主设备将要发送的数据加载到自己的移位寄存器中。
> 2. **启动时钟**: 主设备激活从设备（拉低CS线），并开始在**SCLK**线上生成时钟脉冲。
> 3. **同步移位**:
>    - 在**每一个**时钟脉冲的驱动下，主设备的移位寄存器将**一位**数据通过 **MOSI** 线“推”入从设备的移位寄存器。
>    - **与此同时**，从设备的移位寄存器也将**一位**数据通过 **MISO** 线“推”入主设备的移位寄存器。
> 4. **完成交换**: 在8个时钟脉冲后，主从设备就**完整地交换了**一个字节的数据。主设备发送的数据进入了从设备，从设备发送的数据进入了主设备。
>
> 

> [!success] **全双工 (Full-duplex) 的根源**
> > 正是因为这种“环形”的移位寄存器结构，数据在MOSI和MISO线上的流动是**同时发生**的。
> > > [!warning] **重要提示**
> > > 这也意味着，**为了从从设备读取N位数据，主设备必须也发送N位数据**（即使是无意义的“虚拟”数据），以产生足够的时钟脉冲来完成数据交换。

---

### Ⅱ. 处理多个从设备：两种配置方案

> [!question]
> 当一个主设备需要与多个从设备通信时，有两种主流的连接配置。

> [!tip] **1. 标准/独立SPI总线 (Typical / Independent SPI Bus)**
> > - **原理**: **这是最常见、最直接的方式**。主设备为**每一个**从设备都提供一根**独立的片选线 (CS/SS)**。
> > - **连接方式**:
> >   - SCLK, MOSI, MISO 这三根线是所有设备**共享**的。
> >   - 主设备通过其不同的GPIO引脚（如 `CS1`, `CS2`, `CS3`）分别连接到每个从设备的CS引脚。
> > - **工作流程**: 主设备想和哪个从设备通信，就将哪条对应的CS线**拉为低电平**。此时，只有被选中的从设备会响应SCLK和MOSI信号，而其他所有从设备都保持不活动状态。
> > - **优缺点**:
> >   - **优点**: 逻辑简单，可以直接与任何从设备进行高速通信。
> >   - **缺点**: 当从设备数量很多时，会**占用大量**主设备的GPIO引脚。
> >
> > 

> [!help] **2. 菊花链SPI总线 (Daisy-Chained SPI Bus)**
> > - **原理**: 这是一种**节省引脚**的连接方式，尤其适用于主设备只有一个可用片选引脚的情况。
> > - **连接方式**:
> >   - SCLK 和 CS 线是所有设备**共享**的。
> >   - 数据线形成一个“**链条**”：
> >     - 主设备的 MOSI 连接到 **从设备1** 的 MOSI。
> >     - **从设备1** 的 MISO 连接到 **从设备2** 的 MOSI。
> >     - **从设备2** 的 MISO 连接到 **从设备3** 的 MOSI ...
> >     - **最后一个从设备**的 MISO 连接回**主设备**的 MISO。
> > - **工作流程**: 当主设备发送数据时，数据会像水流一样，依次流过从设备1、从设备2、从设备3... 形成一个巨大的、跨越所有设备的移位寄存器。
> > - **优缺点**:
> >   - **优点**: **极大地节省了CS引脚**（只需要1个）。
> >   - **缺点**:
> >     - **通信效率低**: 要想给链条末端的从设备3发送一个字节，主设备必须连续发送三个字节，才能将数据“推”到正确的位置。
> >     - **失去了全双工特性**: 主设备无法在发送的同时，从特定的从设备接收有意义的数据。
> >
> > 

---

### Ⅲ. SPI协议的关键属性与局限性

> [!summary]
> SPI的高速和简洁性，是建立在牺牲了一些复杂功能的基础上的。

- **没有应答机制 (No ACK)**:
  - SPI是一个“**只管发，不管收**”的协议。主设备发送数据后，**没有内置机制**可以确认从设备是否正确收到了数据。通信的可靠性需要由上层应用来保证。
- **主设备无法感知从设备存在**:
  - 主设备不知道CS引脚上是否真的连接了一个从设备，它只会照常发送数据。
- **没有特定的寻址方案**:
  - 寻址是通过**物理的CS/SS线**来实现的，而不是像I2C那样在协议内部发送地址字节。
- **没有定义最大数据速率**:
  - SPI的通信速率上限，取决于主设备、从设备以及PCB布线所能支持的**最高时钟频率**，协议本身没有规定上限。

![[屏幕截图 2025-08-12 154908.png]]

![[屏幕截图 2025-08-12 154920.png]]

![[屏幕截图 2025-08-12 154928.png]]

![[屏幕截图 2025-08-12 155000.png]]

![[屏幕截图 2025-08-12 155013.png]]

![[屏幕截图 2025-08-12 155028.png]]

![[屏幕截图 2025-08-12 155043.png]]

![[屏幕截图 2025-08-12 155104.png]]

# 笔记：SPI协议深度解析 - 移位寄存器与多从机配置

> [!abstract] 核心纲要
> 本笔记旨在深入剖析**SPI (串行外设接口)** 的核心工作原理与多设备连接方案。我们将重点关注：
> 1.  **SPI的本质**: 理解其基于**移位寄存器 (Shift Registers)** 的全双工数据交换机制。
> 2.  **多从设备配置**: 详细对比**标准独立总线**和**菊花链 (Daisy-Chain)** 两种连接方式。
> 3.  **SPI的关键属性**: 明确其在通信确认、寻址等方面的协议局限性。

---

### Ⅰ. SPI的核心机制：一个由移位寄存器构成的“环”

> [!info]
> **SPI通信的本质**，可以被看作是**主设备 (Master)** 和**从设备 (Slave)** 内部的两个**移位寄存器**连接成一个环，然后进行同步的数据**交换**。

> [!example] **工作流程：同步数据交换**
> 1. **加载数据**: 通信开始前，主设备将要发送的数据加载到自己的移位寄存器中。
> 2. **启动时钟**: 主设备激活从设备（拉低CS线），并开始在**SCLK**线上生成时钟脉冲。
> 3. **同步移位**:
>    - 在**每一个**时钟脉冲的驱动下，主设备的移位寄存器将**一位**数据通过 **MOSI** 线“推”入从设备的移位寄存器。
>    - **与此同时**，从设备的移位寄存器也将**一位**数据通过 **MISO** 线“推”入主设备的移位寄存器。
> 4. **完成交换**: 在8个时钟脉冲后，主从设备就**完整地交换了**一个字节的数据。主设备发送的数据进入了从设备，从设备发送的数据进入了主设备。
>
> ![SPI Shift Register Diagram](https://i.imgur.com/81Y0B3s.png)

> [!success] **全双工 (Full-duplex) 的根源**
> > 正是因为这种“环形”的移位寄存器结构，数据在MOSI和MISO线上的流动是**同时发生**的。
> > > [!warning] **重要提示**
> > > 这也意味着，**为了从从设备读取N位数据，主设备必须也发送N位数据**（即使是无意义的“虚拟”数据），以产生足够的时钟脉冲来完成数据交换。

---

### Ⅱ. 处理多个从设备：两种配置方案

> [!question]
> 当一个主设备需要与多个从设备通信时，有两种主流的连接配置。

> [!tip] **1. 标准/独立SPI总线 (Typical / Independent SPI Bus)**
> > - **原理**: **这是最常见、最直接的方式**。主设备为**每一个**从设备都提供一根**独立的片选线 (CS/SS)**。
> > - **连接方式**:
> >   - SCLK, MOSI, MISO 这三根线是所有设备**共享**的。
> >   - 主设备通过其不同的GPIO引脚（如 `CS1`, `CS2`, `CS3`）分别连接到每个从设备的CS引脚。
> > - **工作流程**: 主设备想和哪个从设备通信，就将哪条对应的CS线**拉为低电平**。此时，只有被选中的从设备会响应SCLK和MOSI信号，而其他所有从设备都保持不活动状态。
> > - **优缺点**:
> >   - **优点**: 逻辑简单，可以直接与任何从设备进行高速通信。
> >   - **缺点**: 当从设备数量很多时，会**占用大量**主设备的GPIO引脚。
> >
> > 

> [!help] **2. 菊花链SPI总线 (Daisy-Chained SPI Bus)**
> > - **原理**: 这是一种**节省引脚**的连接方式，尤其适用于主设备只有一个可用片选引脚的情况。
> > - **连接方式**:
> >   - SCLK 和 CS 线是所有设备**共享**的。
> >   - 数据线形成一个“**链条**”：
> >     - 主设备的 MOSI 连接到 **从设备1** 的 MOSI。
> >     - **从设备1** 的 MISO 连接到 **从设备2** 的 MOSI。
> >     - **从设备2** 的 MISO 连接到 **从设备3** 的 MOSI ...
> >     - **最后一个从设备**的 MISO 连接回**主设备**的 MISO。
> > - **工作流程**: 当主设备发送数据时，数据会像水流一样，依次流过从设备1、从设备2、从设备3... 形成一个巨大的、跨越所有设备的移位寄存器。
> > - **优缺点**:
> >   - **优点**: **极大地节省了CS引脚**（只需要1个）。
> >   - **缺点**:
> >     - **通信效率低**: 要想给链条末端的从设备3发送一个字节，主设备必须连续发送三个字节，才能将数据“推”到正确的位置。
> >     - **失去了全双工特性**: 主设备无法在发送的同时，从特定的从设备接收有意义的数据。
> >
> > 

---

### Ⅲ. SPI协议的关键属性与局限性

> [!summary]
> SPI的高速和简洁性，是建立在牺牲了一些复杂功能的基础上的。

- **没有应答机制 (No ACK)**:
  - SPI是一个“**只管发，不管收**”的协议。主设备发送数据后，**没有内置机制**可以确认从设备是否正确收到了数据。通信的可靠性需要由上层应用来保证。
- **主设备无法感知从设备存在**:
  - 主设备不知道CS引脚上是否真的连接了一个从设备，它只会照常发送数据。
- **没有特定的寻址方案**:
  - 寻址是通过**物理的CS/SS线**来实现的，而不是像I2C那样在协议内部发送地址字节。
- **没有定义最大数据速率**:
  - SPI的通信速率上限，取决于主设备、从设备以及PCB布线所能支持的**最高时钟频率**，协议本身没有规定上限。****


![[屏幕截图 2025-08-12 155118.png]]

![[屏幕截图 2025-08-12 155131.png]]

![[屏幕截图 2025-08-12 155149.png]]

![[屏幕截图 2025-08-12 155159.png]]

![[屏幕截图 2025-08-12 155209.png]]

![[屏幕截图 2025-08-12 155216.png]]

![[屏幕截图 2025-08-12 155233.png]]

![[屏幕截图 2025-08-12 155248.png]]

# 笔记：SPI模式详解与I2C对比 (SPI Modes & vs. I2C)

> [!abstract] 核心纲要
> 本笔记旨在深入剖析**SPI (串行外设接口)** 的核心配置与实际应用考量。我们将重点关注：
> 1.  **SPI的四种工作模式**: 详细解析**CPOL (时钟极性)** 与 **CPHA (时钟相位)** 如何组合定义数据传输的时序。
> 2.  **SPI的优缺点**: 全面总结SPI协议的优势与局限性。
> 3.  **SPI vs. I2C**: 通过一个详细的对比表，清晰地辨析两种主流同步串行协议的差异。
> 4.  **设计实践**: 根据实际需求（如设备数量、引脚限制），学习如何选择合适的通信协议。

---

### Ⅰ. SPI的四种工作模式 (CPOL & CPHA)

> [!question]
> 主从设备必须就“**何时**发送和**何时**读取数据”达成一致。这个“何时”由**时钟极性(CPOL)**和**时钟相位(CPHA)**两个参数共同决定，它们组合成了四种SPI模式。

> [!note] **CPOL (Clock Polarity) - 时钟极性**
> > - **定义**: 决定了SCLK时钟信号在**空闲状态**（即CS为高电平时）的电平。
> > - **`CPOL = 0`**: 空闲时为**低电平**。时钟的有效状态从**上升沿**开始。
> > - **`CPOL = 1`**: 空闲时为**高电平**。时钟的有效状态从**下降沿**开始。

> [!note] **CPHA (Clock Phase) - 时钟相位**
> > - **定义**: 决定了数据是在时钟周期的**哪一个边沿**被**采样（读取）**。
> > - **`CPHA = 0`**: 数据在**第一个有效边沿 (Leading Edge)** 被采样。
> > - **`CPHA = 1`**: 数据在**第二个有效边沿 (Trailing Edge)** 被采样。

> [!check] **四种模式总结**
| 模式 | CPOL | CPHA | 描述 |
| :--- | :--- | :--- | :--- |
| **Mode 0** | 0 | 0 | 空闲时钟为低，在**第一个边沿（上升沿）**采样数据 |
| **Mode 1** | 0 | 1 | 空闲时钟为低，在**第二个边沿（下降沿）**采样数据 |
| **Mode 2** | 1 | 0 | 空闲时钟为高，在**第一个边沿（下降沿）**采样数据 |
| **Mode 3** | 1 | 1 | 空闲时钟为高，在**第二个边沿（上升沿）**采样数据 |
>
> **关键**: **主设备和从设备必须配置成完全相同的SPI模式才能正常通信！**

---

### Ⅱ. SPI协议的优缺点

> [!summary]

> [!success] **优点 (Advantages)**
> - **全双工通信**: 可以同时发送和接收数据。
> - **高吞吐量**: 协议简单，没有太多开销（如起始/停止位），数据可以连续流式传输，通常比I²C快得多。
> - **协议灵活**: 传输的位数（字长）不受8位限制，可以任意定义。
> - **硬件简单**: 从设备无需精密时钟，硬件电路比I²C简单，功耗较低。

> [!danger] **缺点 (Disadvantages)**
> - **需要更多引脚**: 标准模式下至少需要4根线，而I²C和UART只需要2根。
> - **没有应答机制 (No ACK)**: 主设备无法确认从设备是否成功收到了数据。
> - **没有内置错误检测**: 不像UART有可选的奇偶校验位。
> - **只支持单主设备**: 无法实现多主设备控制。

---

### Ⅲ. 终极对决：SPI vs. I2C

> [!example]

| 特性 | I2C | SPI |
| :--- | :--- | :--- |
| **双工模式** | 半双工 (Half-duplex) | **全双工 (Full-duplex)** |
| **主从能力** | **支持多主多从** | 仅支持单主多从 |
| **引脚数量** | **2** (SDA, SCL) | **4+** (MOSI, MISO, SCLK, SS) |
| **时钟伸展** | **支持** (从设备可以拉低时钟线以暂停通信) | 不支持 |
| **速度** | 较慢 (Slower) | **更快 (Faster)** |
| **协议开销** | 高 (有起始/停止位、地址、ACK位) | **低** (无额外控制位) |
| **应答机制** | **有** (每个字节后都有ACK/NACK位) | **没有** |

---

### Ⅳ. 设计实践：如何选择协议？

> [!help]

> [!todo] **场景一：如果你需要连接120个从设备，你会用哪个协议？**
> > - **首选**: **I²C**。
> > - **原因**: I²C通过**地址**来选择从设备，无论连接多少设备，都只需要**2根**总线。7位地址支持112个设备，如果不够，可以切换到10位地址或使用多个I²C总线。
> > - **SPI为什么不合适**: 标准SPI需要为每个从设备提供一根独立的片选线，连接120个设备将需要**120根**GPIO引脚，这在任何微控制器上都是**不现实的**。

> [!todo] **场景二：在以下情况中你会选择串行还是并行？**
> > **(i) 如果你可用的GPIO引脚很少**:
> > - **选择**: **串行通信 (Serial)**。因为它使用的引脚数远少于并行通信（I²C只需2个，SPI只需4个）。
> >
> > **(ii) 如果你需要在短距离内通信，并且有大量空闲的GPIO引脚**:
> > - **选择**: **并行通信 (Parallel)**。因为在短距离下，并行通信可以一次性传输多个比特，能获得最高的数据传输速度。

---

### Ⅴ. SPI的典型应用回顾

> [!list]
> SPI因其高速和全双工的特性，被广泛用于需要大数据量、高速度传输的场景：
> - **传感器 (Sensors)**: 温度、压力、加速度计等。
> - **存储设备 (Storage)**: **SD卡**、Flash闪存、EEPROM。
> - **控制设备 (Control devices)**: 音频编解码器 (Audio codecs)、数模转换器 (DAC)。
> - **显示设备 (LCD displays)**: 驱动TFT-LCD屏幕。


![[屏幕截图 2025-08-12 155303.png]]

![[屏幕截图 2025-08-12 155323.png]]

![[屏幕截图 2025-08-12 155342.png]]

![[屏幕截图 2025-08-12 155353.png]]

![[屏幕截图 2025-08-12 155405.png]]

![[屏幕截图 2025-08-12 155415.png]]