![[0d4466f53cc5b60c68ad3a6a8176145.jpg]]
![[bcfad26ba635f0e17d0dcde8d8827ef.jpg]]
![[9ffbf00c7ede51190ea2b1efea5a42c.jpg]]

# 笔记：MCU数字输入/输出 (Digital I/O) 原理与实践

> [!abstract] 核心纲要
> 本笔记旨在深入剖析微控制器（MCU）最基础也最重要的功能——**数字输入/输出**。我们将：
> 1.  理解**数字电平 (Digital Levels)** 的物理含义。
> 2.  学习**数字输出**的应用，以**控制LED灯**为例，并区分高/低电平驱动。
> 3.  学习**数字输入**的应用，以**读取开关状态**为例，并理解**上拉/下拉电阻**的核心作用。
> 4.  通过一个**完整的演示代码**，理解输入与输出如何协同工作。

---

### Ⅰ. 基础概念：数字电平 (Digital Levels)

> [!info]
> 在数字电路中，我们用**电压 (Voltage)** 的高低来表示抽象的逻辑 `1` 和 `0`。

> [!check] **电平的定义**
> - **逻辑 `1` (高电平, High)**: 对应一个**较高的电压**，通常接近于电路的供电电压（如 `3.3V` 或 `5V`）。
> - **逻辑 `0` (低电平, Low)**: 对应一个**较低的电压**，通常接近于**地 (GND, `0V`)**。

> [!warning] **电压范围与不稳定区**
> > MCU在读取输入时，并非只认准精确的 `3.3V` 或 `0V`。它会有一个容错范围。
> > - **例如，对于一个3.3V的系统**:
> >   - `2.0V` 到 `3.3V` 之间的电压，可能被**视为逻辑 `1`**。
> >   - `0V` 到 `0.8V` 之间的电压，可能被**视为逻辑 `0`**。
> >   - `0.8V` 到 `2.0V` 之间的电压，则处于**不稳定区 (Indeterminate Region)**，MCU无法确定其逻辑状态，应在电路设计中极力避免。

---

### Ⅱ. 数字输出 (Digital Output) - 控制一个LED

> [!example]
> 数字输出最经典的应用就是点亮或熄灭一个发光二极管（LED）。

> [!help] **LED核心特性回顾**
> - **单向导电**: 电流只能从**阳极(Anode, +)** 流向**阴极(Cathode, -)**。
> - **开启电压**: 需要一个最低的正向电压才能导通并发光。
> - **限流电阻**: **必须**与LED串联一个电阻，以限制电流，防止其被烧毁。

> [!tip] **两种驱动方式**
> 1. **高电平驱动 (Active High)**:
>    - **电路**: MCU引脚 -> 电阻 -> LED阳极 -> LED阴极 -> 地(GND)。
>    - **工作原理**: 当MCU引脚输出**高电平 (逻辑`1`)** 时，电流导通，**LED点亮**。
> 2. **低电平驱动 (Active Low)**:
>    - **电路**: 电源(VDD) -> 电阻 -> LED阳极 -> LED阴极 -> MCU引脚。
>    - **工作原理**: 当MCU引脚输出**低电平 (逻辑`0`)** 时，形成到地的通路，电流导通，**LED点亮**。

---

### Ⅲ. 数字输入 (Digital Input) - 读取一个开关

> [!question]
> 读取一个简单的开关（按下/弹起）状态，看似简单，但存在一个关键的“陷阱”。

> [!danger] **“悬空”(Floating) 状态的问题**
> 如果我们直接将一个开关的两端分别接到MCU输入引脚和地，当开关**断开**时，这个输入引脚不与任何确定的电平相连，它的状态是未定义的，即**“悬空”**。此时MCU可能会随机读到`0`或`1`，导致程序逻辑混乱。

> [!success] **解决方案：上拉/下拉电阻 (Pull-up/Pull-down Resistors)**
> **核心思想**: 用一个电阻为输入引脚提供一个**默认的稳定电平**。

> [!check] **1. 下拉电阻 (Pull-down Resistor)**
> > - **电路**: 在**输入引脚**和**地 (GND)** 之间接一个电阻。开关则连接在**电源 (VDD)** 和输入引脚之间。
> > - **工作原理**:
> >   - **开关断开**: 引脚通过电阻被“拉”到**低电平**。MCU读到**逻辑`0`**。
> >   - **开关闭合**: 引脚被直接连接到VDD，被“拉”到**高电平**。MCU读到**逻辑`1`**。

> [!check] **2. 上拉电阻 (Pull-up Resistor)**
> > - **电路**: 在**输入引脚**和**电源 (VDD)** 之间接一个电阻。开关则连接在输入引脚和**地 (GND)** 之间。
> > - **工作原理**:
> >   - **开关断开**: 引脚通过电阻被“拉”到**高电平**。MCU读到**逻辑`1`**。
> >   - **开关闭合**: 引脚被直接连接到GND，被“拉”到**低电平**。MCU读到**逻辑`0`**。
> >
> > **提示**: 许多现代MCU（如mbed平台）内部已经**内置了可由软件配置的上拉/下拉电阻**，无需外部元件。

---

### Ⅳ. 综合应用：演示代码 (DEMO) 解析

> [!cite]
> 这段代码完美地结合了数字输入（读取开关）和数字输出（控制LED），实现了一个简单的交互功能。

**程序目标**: 根据一个开关的状态，来决定闪烁红色LED还是绿色LED。

```cpp
#include "mbed.h"

// --- 定义输出引脚 ---
DigitalOut redled(D3);
DigitalOut greenled(D4);

// --- 定义输入引脚 ---
// 假设D5引脚外接了一个带上拉/下拉电阻的开关
DigitalIn switchinput(D5);

int main() {
    while(1) { // 无限循环
        
        // --- 读取输入 ---
        if (switchinput == 1) { // 如果开关被按下 (读到高电平)
            
            // --- 控制输出 ---
            greenled = 0; // 确保绿灯灭
            
            // 闪烁红灯
            redled = 1; 
            ThisThread::sleep_for(1s); // 延时1秒
            redled = 0;
            ThisThread::sleep_for(1s);

        } else { // 如果开关未被按下 (读到低电平)
            
            // --- 控制输出 ---
            redled = 0; // 确保红灯灭

            // 闪烁绿灯
            greenled = 1;
            ThisThread::sleep_for(1s);
            greenled = 0;
            ThisThread::sleep_for(1s);
        }
    }
}
```
**工作流程**: 程序在一个无限循环中，不断地检查`switchinput`引脚的电平。如果读到`1`，就执行闪烁红灯的逻辑；如果读到`0`，就执行闪爍绿灯的逻辑。`sleep_for(1s)`的作用是产生人眼可见的1秒延时，形成“闪烁”的效果。