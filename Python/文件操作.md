# 🐍 Python 文件操作核心指南 (从open到with)

> [!NOTE] 核心概念：什么是文件？
> 简单来说，文件就是存储在你的硬盘等设备上的一组数据。Python主要将文件分为两种：
> - **📄 文本文件 (Text File)**: 由特定编码（如UTF-8）的字符组成，可以用记事本等软件直接打开阅读。
> - **🤖 二进制文件 (Binary File)**: 由0和1的字节流直接组成，没有统一的编码。图片、视频、音频、`.exe` 文件等都属于二进制文件，需要特定的软件才能正确解析。

---

> [!abstract] 文件操作的三步走流程
> 无论多复杂的文件操作，都遵循一个基本的三步流程，就像从仓库取货一样：
> 1.  **① 打开文件 (`open`)**: 从硬盘（仓库）中找到文件，并将其加载到内存中，准备操作。
> 2.  **② 操作文件 (`read`/`write`)**: 在内存中对文件内容进行读取或写入。
> 3.  **③ 关闭文件 (`close`)**: 将在内存中的修改保存回硬盘，并释放资源。**（这一步至关重要，忘记关闭可能导致数据丢失或文件损坏！）**
> ![[Pasted image 20250715002836.png]]

---

> [!success]- 最佳实践：使用 `with` 语句自动管理文件
> 
> 忘记 `close()` 文件是一个非常常见的错误。为了解决这个问题，Python提供了 `with` 语句（也叫上下文管理器），它能**保证在代码块执行完毕后，无论是否发生异常，都自动关闭文件**。
> 
> > [!tip] 语法结构
> > ```python
> > with open('文件名', '模式', encoding='utf-8') as 文件变量:
> >     # 在这个缩进块内进行所有的文件操作
> >     # 离开这个代码块后，文件会自动关闭
> >     文件变量.read() 
> > ```
> 
> **强烈推荐始终使用 `with` 语句来处理文件！**

---

### ⚙️ 文件操作的核心要素

> [!tip]- 文件打开模式 (mode)
> 
> 在 `open()` 函数中，`mode` 参数决定了你打算如何操作这个文件。
> 
> | 模式 | 含义 | 说明 |
> | :--- | :--- | :--- |
> | **`'r'`** | 📖 **只读 (Read)** | **默认模式**。文件指针在开头，如果文件不存在则报错 `FileNotFoundError`。 |
> | **`'w'`** | ✍️ **覆盖写入 (Write)** | 文件不存在则**创建**；文件存在则**清空原有内容**再写入。**（危险！会丢失原数据）** |
> | **`'a'`** | ➕ **追加 (Append)** | 文件不存在则**创建**；文件存在则在**文件末尾**追加新内容，不影响原有数据。 |
> | --- | --- | --- |
> | **`'b'`** | 🤖 **二进制模式** | 与 `r, w, a` 组合使用，如 `'rb'`, `'wb'`, `'ab'`。用于处理图片、音频等非文本文件。 |
> | **`'+'`** | 🔄 **读写模式** | 与 `r, w, a` 组合使用，如 `'r+'`, `'w+'`, `'a+'`。在原有功能基础上增加**同时读写**的功能。 |

---

> [!example]- 📖 从文件中读取内容
> 
> **假设我们有一个 `poem.txt` 文件，内容如下:**
> ```
> 静夜思
> 床前明月光，
> 疑是地上霜。
> ```
> 
> > [!info] `read()`: 一次性读取全部内容
> > ```python
> > with open('poem.txt', 'r', encoding='utf-8') as f:
> >     content = f.read() # 读取所有内容到一个字符串
> >     print(content)
> > ```
> 
> > [!info] `readline()`: 一次只读取一行
> > ```python
> > with open('poem.txt', 'r', encoding='utf-8') as f:
> >     line1 = f.readline() # 读取第一行
> >     line2 = f.readline() # 读取第二行
> >     print(f"第一行: {line1.strip()}") # .strip() 去掉末尾的换行符
> >     print(f"第二行: {line2.strip()}")
> > ```
> 
> > [!info] `readlines()`: 读取所有行到一个列表
> > ```python
> > with open('poem.txt', 'r', encoding='utf-8') as f:
> >     lines = f.readlines() # 每一行作为列表的一个元素
> >     print(lines)
> >     # 输出: ['静夜思\n', '床前明月光，\n', '疑是地上霜。']
> >     for line in lines:
> >         print(line.strip())
> > ```

---

> [!example]- ✍️ 向文件中写入内容
> 
> > [!warning] `write()`: 覆盖写入（使用 `'w'` 模式）
> > **注意：`'w'` 模式会清空文件的原始内容！**
> > ```python
> > with open('log.txt', 'w', encoding='utf-8') as f:
> >     f.write("这是第一行日志。\n") # .write() 不会自动加换行，需要手动加 \n
> >     f.write("这是第二行日志。")
> > # 执行后，log.txt 的内容为:
> > # 这是第一行日志。
> > # 这是第二行日志。
> > ```
> 
> > [!success] `write()`: 追加内容（使用 `'a'` 模式）
> > **`'a'` 模式是安全的，它只会在文件末尾添加内容。**
> > ```python
> > with open('log.txt', 'a', encoding='utf-8') as f:
> >     f.write("\n追加一行新的日志。")
> > # 再次执行后，log.txt 的内容变为:
> > # 这是第一行日志。
> > # 这是第二行日志。
> > # 追加一行新的日志。
> > ```
> 
> > [!info] `writelines()`: 将列表内容写入文件
> > ```python
> > lines_to_write = ["第一行\n", "第二行\n", "第三行\n"]
> > with open('list_log.txt', 'w', encoding='utf-8') as f:
> >     f.writelines(lines_to_write) # 将列表中的每个字符串依次写入
> > ```

---

> [!bug]- 文件指针 `seek()` (进阶)
> 
> **🎯 核心理解**:
> - 文件内部有一个看不见的“光标”，也叫文件指针，表示下一次读写操作开始的位置。
> - `seek(offset)` 可以让你手动移动这个光标。`offset` 是指要移动的**字节数**。
> - **⚠️ 注意**: 在文本文件中，由于不同字符编码（如UTF-8）下，一个字符可能占用多个字节，直接用 `seek()` 移动指针很容易出错，它在二进制文件中用得更多。