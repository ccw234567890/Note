![[65d8ea9948c787fc49b772082cebfb2.jpg]]
![[ad491804fcb91592a246fc3caead357.jpg]]
![[548fc2b9211c5d6f640a14b74aa1b80.jpg]]
![[3cae24f793b6f1df4a85bbb4a617db9.jpg]]
![[cc2fc7fd45cb8caa5658248dfc201b3.jpg]]
![[b783e6b174c0b563562f3ecb9e85a3c.jpg]]
![[571a765cb3567b0c053bc2f8044c022.jpg]]

# 笔记：PWM (脉冲宽度调制) 原理与实践

> [!abstract] 核心纲要
> 本笔记旨在深入剖析**脉冲宽度调制 (Pulse Width Modulation, PWM)** 的核心概念与应用。我们将：
> 1.  **理解PWM的必要性**：为何它是比可变电阻更高效的功率控制方法。
> 2.  **拆解PWM的定义**：理解“脉冲”、“宽度”和“调制”的含义。
> 3.  **掌握PWM的关键参数**：周期、频率和最重要的**占空比 (Duty Cycle)**。
> 4.  **了解PWM的生成方法**：从经典的模拟电路到现代MCU的数字实现。
> 5.  **学习Mbed平台的PWM编程API**，将理论应用于实践。

---

### Ⅰ. 为什么需要PWM？- 高效地控制功率

> [!question]
> **任务**: 控制输送到一个负载（如LED灯、直流电机）的功率，以实现**调节LED亮度**或**控制电机转速**等功能。

> [!fail] **方法一：使用可变电阻 (效率低下)**
> > - **原理**: 通过改变电阻值来改变电流大小，从而调节功率。
> > - **缺点**: 大量的能量在电阻上以**热量**的形式被白白浪费掉，**能源效率极低**。对于大功率应用，散热会成为严重问题。同时，控制不够快速和精确。

> [!success] **方法二：使用PWM (高效)**
> > - **原理**: PWM不通过模拟方式“减小”电压，而是通过**数字方式**，以极快的速度**反复通断开关**。通过控制“通”和“断”的时间比例，来控制负载在一个周期内获得的**平均功率**。
> > - **优点**: **效率极高**。因为开关（如MOSFET）在完全导通或完全截止时的损耗都非常小，几乎没有能量以热量形式浪费。PWM易于用微控制器或数字电路实现，能够进行**精确、快速和可编程的控制**。

---

### Ⅱ. 什么是PWM？- “脉冲宽度调制”的含义

> [!info]
> PWM (Pulse Width Modulation) 的名字完美地描述了它的工作原理。

- **脉冲 (Pulse)**: 指的是一个只有两种状态的数字信号：**开 (ON, 高电平)** 或 **关 (OFF, 低电平)**。
- **宽度 (Width)**: 指的是在一个周期内，脉冲处于**“开”状态的持续时间**。
- **调制 (Modulation)**: 指的是我们可以**改变**或**调节**这个“开”状态的**宽度**。

**结论**: **PWM是一种通过调节数字信号“高电平”的宽度（时间），来编码信息或控制平均功率的技术。**

---

### Ⅲ. PWM的关键参数

> [!example]
> 一个PWM信号由三个核心参数定义。

![PWM Parameters](https://i.imgur.com/81Y0B3s.png)

> [!check] **1. 周期 (Period, T) / 频率 (Frequency, f)**
> > - **周期 (T)**: 完成一个完整的“开-关”循环所需的时间。`T = T_on + T_off`。
> > - **频率 (f)**: 每秒钟重复这个循环的次数，单位是**赫兹 (Hz)**。`f = 1 / T`。

> [!tip] **2. 占空比 (Duty Cycle, D)**
> > - **定义**: 这是PWM**最重要**的参数。它指的是在一个周期内，信号处于**高电平 (ON) 状态的时间所占的百分比**。
> > - **公式**: `Duty Cycle (D) = (T_on / T) * 100%`。
> > - **例如**:
> >   - `D = 0%`: 信号始终为低电平。
> >   - `D = 50%`: 信号一半时间为高，一半时间为低。
> >   - `D = 100%`: 信号始终为高电平。

> [!success] **核心原理：用占空比模拟模拟电压**
> > PWM信号的**平均电压**与其**占空比**成正比：`V_avg = D * V_high`。
> >
> > 通过快速改变占空比，我们就可以用一个纯粹的数字信号，来等效地输出一个**任意大小的模拟电压**，从而实现对LED亮度或电机速度的平滑控制。

---

### Ⅳ. PWM的生成方法

> [!help]
> - **模拟方法**:
>   - **比较器法 (Comparator Method)**: 通过比较一个**控制电压**和一个**三角波/锯齿波**的大小关系来生成PWM波。当控制电压大于三角波时，输出高电平，反之则为低电平。
> - **数字方法**:
>   - **软件模拟 (Bit-banging)**: 在一个循环中，用CPU**手动**控制一个GPIO引脚的高低电平，并用`wait`等延时函数来控制时间。**缺点是占用CPU，且精度不高**。
>   - **硬件PWM模块 (Hardware Timers)**: **现代MCU的标准做法**。MCU内部有专门的**PWM硬件模块**（通常与定时器配合工作），你只需在程序中配置好**频率**和**占空比**，硬件就会在后台自动、精确地生成PWM波形，完全不占用CPU资源。

---

### Ⅴ. Mbed平台的PWM编程API

> [!cite]
> Mbed OS 提供了 `PwmOut` 类，让我们能非常方便地使用硬件PWM功能。

- **`PwmOut mypwm(PinName pin);`**: 构造一个PWM输出对象，并绑定到一个具体的MCU引脚。
- **`mypwm.period(float seconds);`**: 设置PWM信号的**周期**（单位：秒）。
- **`mypwm.pulsewidth(float seconds);`**: 设置脉冲**高电平的宽度**（单位：秒）。
- **`mypwm.write(float value);`**: **最常用的方法**。直接设置**占空比**，`value`是一个`0.0`到`1.0`之间的浮点数，分别对应`0%`到`100%`的占空比。

---

### Ⅵ. PWM的广泛应用

> [!list]
> - **视觉设备控制**: 如**控制LED的亮度**。
- **电机速度控制**: 控制直流电机、舵机（伺服电机）的转速和角度。
- **电源变换**: 在开关电源和DC-AC**逆变器**中作为核心技术。
- **电池充电器**: 通过PWM精确控制充电电流和电压。