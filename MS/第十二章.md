![[e25f13ddc50a6a8df0bf166ce154aef.jpg]]
![[a045f6ae067a53c2d9b2f75464c73e0.jpg]]
![[a880a3e211de68e26a2fcf54f0640a2.jpg]]
![[4005c2ad542223287e4a14070b69cf4.jpg]]
![[a23b5de4cfb8794aed9cc41e9b6c413.jpg]]

# 笔记：I2C (Inter-Integrated Circuit) 通信协议全解析

> [!abstract] 核心纲要
> 本笔记旨在深入剖析**I2C (集成电路互联总线)** 的核心概念与工作原理。我们将重点关注：
> 1.  **I2C的五大基本特性**: 了解其为何是一种高效的多设备近距离通信方案。
> 2.  **物理层**: 解析其独特的**开漏 (Open-Drain)** 输出结构与**上拉电阻**的必要性。
> 3.  **I2C的协议结构**: 详细拆解一次完整的I2C通信包含的**起始、地址、数据、应答和停止**等所有步骤。
> 4.  **优缺点**: 客观评估I2C协议的优势与局限性。

---

### Ⅰ. I2C是什么？- 五大基本特性

> [!info]
> **I²C** (或写作 IIC)，全称为 **Inter-Integrated Circuit (集成电路互联总线)**，是一种用于在**同一块电路板 (PCB)** 上的集成电路之间进行**短距离通信**的总线协议。

> [!check] **I2C的五大基本特性**
> 1. **双线制 (Two-wire)**:
>    - 仅使用**两条**双向信号线即可完成所有通信：
>      - **SDA (Serial Data)**: 串行数据线。
>      - **SCL (Serial Clock)**: 串行时钟线。
> 2. **同步 (Synchronous)**:
>    - 通信由**主设备 (Master)** 产生的 **SCL 时钟信号**进行同步。所有设备都根据这条时钟线的节拍来发送和接收数据。
> 3. **串行 (Serial)**:
>    - 数据是一位一位地在SDA线上进行传输。
> 4. **多主多从 (Multi-master, Multi-slave)**:
>    - **主设备 (Master)**: 负责**发起**通信、产生时钟信号并选择从设备。
>    - **从设备 (Slave)**: 负责**响应**主设备的请求。
>    - I2C总线允许连接**多个主设备**和**多个从设备**。它还内置了**总线仲裁机制**，用于解决多个主设备同时试图控制总线的冲突。
> 5. **基于地址 (Address-based)**:
>    - 总线上的**每一个从设备**都有一个**唯一的7位或10位地址**。主设备通过在通信开始时发送这个地址，来精确地“点名”并选择要与之通信的特定设备。

---

### Ⅱ. 物理层：开漏输出与上拉电阻

> [!help]
> I2C的两根线（SDA和SCL）在物理上采用了**开漏 (Open-Drain)**（或开集）输出结构，这是实现其多设备共享总线功能的关键。

- **开漏输出**:
  - 意味着I2C设备内部的晶体管只能将总线**拉向低电平 (GND)**，但**无法**主动输出高电平。
- **上拉电阻 (Pull-up Resistors)**:
  - **必须**在SDA和SCL线上各连接一个**外部上拉电阻**到电源 (VDD)。
  - **作用**: 当总线上没有任何设备“拉低”线路时，这两个电阻会将线路的电平**“拉高”到高电平**。
- **“线与”逻辑 (Wired-AND)**:
  - 这个结构决定了：总线电平为**高**，当且仅当**所有**设备都处于不拉低的状态。只要**有任何一个**设备将线路拉低，整条线路的电平就**变为低**。这个特性是I2C实现多主仲裁和从机应答的基础。

---

### Ⅲ. I2C的协议结构：一次完整的“对话”

> [!example]
> 一次完整的I2C通信，就像一次结构严谨的“对话”，包含了固定的开始、寻址、数据交换、确认和结束等步骤。



1. **起始条件 (Start Condition)**:
   - **主设备**通过在**SCL保持高电平**时，将**SDA从高电平跳变为低电平**来发起通信，通知总线上所有设备：“注意，我要开始说话了！”
2. **地址帧 (Address Frame)**:
   - 主设备发送7位或10位的**从设备地址**，后面紧跟一位**读/写控制位 (R/W)**（`0`代表主设备要**写**数据给从设备，`1`代表要**读**）。
3. **应答/非应答位 (ACK/NACK Bit)**:
   - **这是I2C协议可靠性的关键**。在每传输完一个字节（无论是地址还是数据）后，**接收方**会拉低SDA线一个时钟周期，以发送一个**ACK (Acknowledge)信号**，表示“我已成功收到”。
   - 如果接收方没有拉低SDA线（线路保持高电平），则表示**NACK (Not Acknowledge)**，可能意味着设备不存在、正忙或数据出错。
4. **数据帧 (Data Frame(s))**:
   - 在地址匹配且收到ACK后，主从设备之间开始传输一个或多个8位的数据字节。
5. **停止条件 (Stop Condition)**:
   - **主设备**通过在**SCL保持高电平**时，将**SDA从低电平跳变为高电平**来结束通信，释放总线。

---

### Ⅳ. I2C的优缺点

> [!summary]

> [!check] **优点 (Pros)**
> - **引脚少**: 仅用**两根线**即可连接多个设备，极大地节省了MCU的引脚资源和PCB布线空间。
> - **支持多设备**: 一条总线上可以挂载多个主设备和从设备。
> - **通信可靠**: 内置的**ACK/NACK机制**为每个字节的传输提供了确认，保证了通信的可靠性。
> - **协议广泛**: 是一个非常成熟和知名的协议，拥有大量的设备和库支持。

> [!danger] **缺点 (Disadvantages)**
> - **速度较慢**: 相比SPI等协议，I2C的速度通常较慢（常见有100kHz, 400kHz, 1MHz等模式）。
> - **硬件更复杂**: 相比SPI，I2C需要更复杂的硬件逻辑来实现地址解码、ACK/NACK生成和总线仲裁等功能。
> - **需要外部上拉电阻**: 这是一个额外的硬件需求。
> - **数据帧大小限制**: 每个传输单元通常是8位。