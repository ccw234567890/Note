# 概念：投影快捷连接 (Projection Shortcut)

**标签**: #DeepLearning #ResNet #CNN #NetworkArchitecture

> [!quote] 核心论述
> **[[Projection Shortcut]]**: 提出了一种当维度变化时使用的快捷连接变体，它使用一个线性变换（通常是1x1卷积）来调整x的维度。

---

## 1. 问题根源：维度不匹配

[[残差网络 (ResNet)]] 的核心操作是逐元素相加：
$$ H(x) = F(x) + x $$
一个基本的数学原则是，**只有维度（形状）完全相同的两个张量（tensor）才能直接相加**。

在 ResNet 的基础版本——[[恒等快捷连接 (Identity Shortcut)]]中，我们假设主通路 $F(x)$ 的输出维度与输入 $x$ 完全相同。

然而，在标准的卷积神经网络设计中，为了提取更抽象的特征和减少计算量，我们经常需要改变特征图的维度。主要有两种情况：

1.  **空间维度减半 (Downsampling)**:
    - 通过设置卷积层的**步长（Stride）为 2**，特征图的高度和宽度会被减半。
    - 例如，从 `56x56` 变为 `28x28`。
2.  **通道数量增加**:
    - 通常在网络的不同阶段（stage），我们会将通道数翻倍，以补偿空间信息的损失，并学习更丰富的特征。
    - 例如，从 `64` 个通道变为 `128` 个通道。

**冲突点**:
如果主通路 $F(x)$ 的输出维度是 `28 x 28 x 128`，而原始输入 $x$ 的维度是 `56 x 56 x 64`，那么 $F(x)$ 和 $x$ 就无法直接相加。此时，纯粹的恒等映射快捷连接就行不通了。

---

## 2. 解决方案：使用“投影”来匹配维度

为了解决维度不匹配的问题，ResNet 引入了**投影快捷连接**。

- **目的**: 对快捷连接通路上的输入 $x$ 进行一次“投影”变换，使其维度**变得与主通路输出 $F(x)$ 的维度完全一致**。
- **“投影”的含义**: 这里的“投影”是一个广义的说法，指的是一次**线性变换（Linear Transformation）**，它能改变输入张量的形状。

### “投影”的具体实现：1x1 卷积

在卷积神经网络中，实现这种线性变换最灵活、最高效的工具就是 **[[1x1 卷积]]**。

1.  **调整通道数**:
    - 一个 `1x1` 卷积核可以被看作是在通道维度上进行的一次全连接操作。
    - 如果想将 `64` 通道的输入 $x$ 变为 `128` 通道，只需在快捷连接上使用一个包含 **128 个 `1x1` 卷积核**的卷积层即可。
2.  **调整空间尺寸**:
    - 卷积操作本身就可以通过设置**步长（Stride）**来改变空间尺寸。
    - 如果想将 `56x56` 的空间尺寸降为 `28x28`，只需将这个 `1x1` 卷积的**步长设置为 2**。

**结论**:
一个**带步长为 2 的 `1x1` 卷积**，可以**同时解决**空间尺寸和通道数不匹配的问题，是实现投影快捷连接的完美工具。

---

## 3. 图示中的体现

在我们之前分析的 [[图像解析：VGG-19 vs. Plain-34 vs. ResNet-34 架构对比]] 图中，两种快捷连接有清晰的区分：

- **[[恒等快捷连接 (Identity Shortcut)]]**:
    - 用**实线弧形箭头**表示。
    - 用于维度完全匹配的 [[残差块 (Residual Block)|恒等块]] 中。

- **投影快捷连接 (Projection Shortcut)**:
    - 用**虚线弧形箭头**表示。
    - 它恰好出现在网络阶段切换的地方，即**特征图尺寸减半、通道数翻倍**的位置。

![Dotted vs Solid Shortcut](https://miro.medium.com/v2/resize:fit:1200/1*Qv0I4W3Q0-t2V2Lg2v5-4g.png)
*上图：左侧为恒等块（实线），右侧为执行了下采样的卷积块，其快捷连接（虚线）必须使用投影（如1x1卷积）来匹配维度。*

---

## 4. 总结与目的

- **投影快捷连接**是 ResNet 为了适应标准 CNN 架构中维度变化的**一种必要补充**。
- 它虽然引入了额外的参数和计算（快捷连接不再是零成本），但它使得残差学习的思想可以**贯穿整个网络**，即使在网络不同阶段的边界处也能无缝衔接。
- 它保证了无论主通路 $F(x)$ 的输出维度如何变化，我们总能找到一种方法来匹配维度并完成 $F(x) + x$ 这一核心操作，维持了 ResNet 结构的一致性和有效性。

## 关联概念
- [[残差网络 (ResNet)]]
- [[残差块 (Residual Block)]]
- [[快捷连接 (Shortcut Connection)]]
- [[恒等映射]]
- [[1x1 卷积]]