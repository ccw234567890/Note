# 核心关系：卷积、池化、维度与尺寸的变换

**标签**: #DeepLearning #CNN #Convolution #Pooling #Dimension

在 [[卷积神经网络 (CNN)]] 中，数据以 [[三维特征图 (3D Feature Map)]] 的形式在层与层之间流动。其形状由 **(高度 H, 宽度 W, 通道 C)** 这三个维度定义。**卷积核**和**池化层**是改变这个形状最主要的两个工具。

---

## 1. 卷积核 (Convolutional Kernel) 与尺寸维度的关系

一个卷积层通过其内部的**卷积核**，可以同时改变特征图的**空间维度（H, W）**和**通道维度（C）**。

### A. 对空间维度 (高度 H, 宽度 W) 的影响

输出特征图的高度和宽度由三个关键参数共同决定：

1.  **卷积核大小 (Kernel Size, K)**: 卷积核的尺寸，例如 `3x3` 或 `5x5`。
2.  **步长 (Stride, S)**: 卷积核在特征图上每次滑动的距离。
3.  **填充 (Padding, P)**: 在特征图的边缘周围添加额外的像素（通常是0）。**为什么需要填充？** a) 保持边缘信息不丢失；b) 控制输出的空间尺寸，使其可以保持不变。

**计算公式**:
假设输入尺寸为 $W_{in} \times H_{in}$，输出尺寸为 $W_{out} \times H_{out}$，则：
$$ W_{out} = \frac{W_{in} - K + 2P}{S} + 1 $$
$$ H_{out} = \frac{H_{in} - K + 2P}{S} + 1 $$
*注意：如果计算结果不是整数，通常会向下取整。*

#### **【示例】**
- **场景1：保持尺寸不变**
    - 输入: `32 x 32`
    - 卷积核 (K): `3x3`
    - 步长 (S): `1`
    - 填充 (P): `1`
    - $W_{out} = \frac{32 - 3 + 2 \cdot 1}{1} + 1 = 31 + 1 = 32$
    - **输出尺寸**: `32 x 32`。这是 CNN 中最常见的配置，通过设置 `P = (K-1)/2` 可以在 `S=1` 时保持空间尺寸不变。

- **场景2：尺寸减半（下采样）**
    - 输入: `32 x 32`
    - 卷积核 (K): `3x3`
    - 步长 (S): `2`
    - 填充 (P): `1`
    - $W_{out} = \frac{32 - 3 + 2 \cdot 1}{2} + 1 = 15.5 + 1 = 16.5 \rightarrow 16$ (向下取整)
    - **输出尺寸**: `16 x 16`。在 ResNet 等现代网络中，经常使用**步长为2的卷积**来替代池化层进行下采样。

### B. 对通道维度 (C) 的影响

这一点非常直接和关键：

> **输出的通道数 C_out，完全由该卷积层中卷积核（过滤器）的数量决定。**

- **规则**: 卷积层有多少个卷积核，输出就有多少个通道。
- **作用**: 每个卷积核被训练来检测一种特定的特征。因此，增加卷积核数量（即增加输出通道数）可以增强网络学习特征的丰富性和复杂性。
- **示例**:
    - 输入特征图维度: `(32, 32, 3)`
    - 卷积层有 **64 个** 卷积核。
    - **输出特征图维度**: `(H_out, W_out, 64)`。
    - 无论输入通道数是多少（这里是3），输出通道数都变成了64。

---

## 2. 池化层 (Pooling Layer) 与尺寸维度的关系

池化层（如 Max Pooling 或 Average Pooling）的主要目的是**降低空间维度（下采样）**，减少计算量，并提供一定程度的平移不变性。

### A. 对空间维度 (高度 H, 宽度 W) 的影响

- 池化操作通常被看作一种简化的滑动窗口操作，因此它也遵循与卷积相同的尺寸计算公式。
- **最常见的配置**:
    - 池化窗口大小 (K): `2x2`
    - 步长 (S): `2`
    - 填充 (P): `0`
- **示例**:
    - 输入: `32 x 32`
    - K=2, S=2, P=0
    - $W_{out} = \frac{32 - 2 + 2 \cdot 0}{2} + 1 = 15 + 1 = 16$
    - **输出尺寸**: `16 x 16`。
    - **结论**: 一个标准的 `2x2`、步长为2的池化层，会使特征图的**高度和宽度减半**。

### B. 对通道维度 (C) 的影响

> **池化层不改变通道维度。**

- **规则**: 池化操作是在**每一个通道上独立进行**的。它会分别对输入的每一个通道进行下采样，然后将结果堆叠起来。
- **示例**:
    - 输入特征图维度: `(16, 16, 64)`
    - 经过一个 `2x2`、步长为2的池化层。
    - **输出特征图维度**: `(8, 8, 64)`。
    - 空间尺寸减半，但通道数 `64` 保持不变。

---

## 3. 总结与速查表

| 操作 (Operation) | 对空间维度 (H, W) 的影响 | 对通道维度 (C) 的影响 | 主要目的 |
| :--- | :--- | :--- | :--- |
| **卷积层 (Conv Layer)** | 由 **核大小(K)**, **步长(S)**, **填充(P)** 共同决定。可以保持不变，也可以减小。 | **改变**。输出通道数由 **卷积核的数量** 决定。 | **特征提取** |
| **池化层 (Pool Layer)** | **减小**。通常用来将尺寸**减半**。 | **不变**。在每个通道上独立操作。 | **下采样/降维** |