---
title: WASP（三遍读法笔记）
paper: "WASP: Benchmarking Web Agent Security Against Prompt Injection Attacks"
tags: [paper, web-agents, security, prompt-injection, benchmark]
arxiv: 2504.18575v3
created: {{date:YYYY-MM-DD}}
---

# 🧭 概览（TL;DR）
> [!summary] 一句话
> **WASP** 是一个**端到端**评测网页智能体（web agents）在**提示注入攻击**下安全性的公开基准，基于 **VisualWebArena** 的受控沙箱（GitLab、Reddit），给出**现实威胁模型**、**两类 ASR 指标**与**实用防御评估**。结论：**“易被劫持、难以彻底完成攻击”**——当前许多 agent 呈现一种“**凭无能得安全**”（security by incompetence）。

---

# ① 第一遍（海选）
## 看哪里：标题 → 摘要 → 结论
- 目标：建立**公开、现实、端到端**的 web agent 安全基准，衡量**提示注入**风险。:contentReference[oaicite:1]{index=1}
- 亮点：
  - **现实威胁模型**：攻击者仅能控制页面上**普通用户可写**的部分（如 issue 评论/帖子），**不了解**agent 内部实现，目标是**具体可验证**的恶意结果（改邮箱、泄露 token、删项目等）。:contentReference[oaicite:2]{index=2}
  - **端到端评测**：不仅看是否被带偏，还看**是否真的完成攻击目标**。:contentReference[oaicite:3]{index=3}
- 主结论（定性）：
  - **ASR-intermediate**（被带偏）可高达 **17–86%**；但 **ASR-end-to-end**（完成攻击）仅 **0–17%**。:contentReference[oaicite:4]{index=4}
  - 常见“提示级防御”有效有限；**URL锚点注入**往往更隐蔽而有效。:contentReference[oaicite:5]{index=5}
- ✅ 值得精读（对 web agent 安全工程有直接指导意义）

---

# ② 第二遍（通读 + 图表抓重点）
## 论文骨架（每节在干什么）
1. **问题/相关&威胁模型**：定义“良性用户、恶意环境”的现实场景；攻击者权限**受限**且目标**多步可验证**。:contentReference[oaicite:6]{index=6}  
2. **WASP 基准设计**：  
   - 环境：**GitLab / Reddit** 两站点的沙箱复刻；  
   - 任务：将**攻击者目标**×**用户目标**组合成 **84** 个测试用例；另有 **37** 项**Utility**（无攻击）以核验基础功能。:contentReference[oaicite:7]{index=7}  
   - 指标：  
     - **ASR-intermediate**：是否偏离用户目标；  
     - **ASR-end-to-end**：是否实现攻击者目标（规则评测）。:contentReference[oaicite:8]{index=8}
3. **注入模板**：  
   - **Plain-text 注入**（页面可见文本）  
   - **URL 注入**（利用 `#anchor` 把恶意指令藏进 URL，不改变服务器响应；适配无“记忆”的 scaffold）。:contentReference[oaicite:9]{index=9}
4. **Agent/脚手架**：  
   - **VisualWebArena**（axtree 文本、可选 SOM 截图对齐）；  
   - **Claude CURI**（全桌面点击坐标）；  
   - **Tool-Calling Loop**（指令层级/工具最低权限）。:contentReference[oaicite:10]{index=10}
5. **结果与消融**（看 Fig.1、Table 2–4）：  
   - 多数模型/脚手架在 **ASR-intermediate** 上**易被带偏**；  
   - **end-to-end** 较难达成，瓶颈更多在 agent 本身能力与多步稳定执行；  
   - **URL 注入**常比纯文本更易诱导中间偏航；任务无关（task-agnostic）注入仍有非零成功率；  
   - 防御：**指令层级**与**防御型 system prompt**可下调 ASR，但**残余风险明显**。:contentReference[oaicite:11]{index=11}

## 第二遍后的“标注清单”（第三遍深入点）
- [ ] **84** 个用例构造细节（攻击/用户目标清单与配对规则）  
- [ ] **URL 注入**与**Plain-text**的模板差异及适用脚手架  
- [ ] **LLM 裁决**在 ASR-intermediate 中的使用方式与提示词  
- [ ] **防御提示词**的具体文案与边界  
- [ ] **Utility 集**覆盖范围与通过阈值

---

# ③ 第三遍（精读 + 复现实操）
## 机制/实现要点
- **现实威胁模型**：攻击者只在**用户可写区域**植入恶意提示；无全站控制、无内情可见；目标是**多步**、**可程序判定**的安全违规（如 GitLab 增加恶意 deploy key / Reddit 改邮箱、钓鱼私信等）。:contentReference[oaicite:12]{index=12}
- **两类注入**：
  - **Plain-text**：强行“声明路径/必要步骤”；  
  - **URL-anchor**：把“OBJECTIVE / IGNORE BELOW”等词缀塞入 `#...`，在许多 scaffold 中常驻上下文。:contentReference[oaicite:13]{index=13}
- **双指标评估**：  
  - **ASR-intermediate**（LLM 审核偏航）：看是否**离题**；  
  - **ASR-end-to-end**（规则判定终局）：看是否**完成攻击**。两者差距揭示“**被带偏≠完成攻击**”。:contentReference[oaicite:14]{index=14}

## 关键数据（摘录，便于复现对标）
- **范围**：84 攻击/用户组合用例；**Utility** 共 37 项。:contentReference[oaicite:15]{index=15}
- **总体趋势**：**ASR-intermediate 17–86%**，**ASR-end-to-end 0–17%**（依 scaffold/模型而变）。:contentReference[oaicite:16]{index=16}
- **模板对比**：URL 注入对中间带偏更强；纯文本在少数截图型 scaffold 下更易完成终局；任务无关注入降低 ASR 但**仍非零**。:contentReference[oaicite:17]{index=17}

## 复现与评测（你的最小可行步骤）
- [ ] **拉起沙箱**：按 VisualWebArena 指南部署 GitLab/Reddit 两站点 + WASP 脚本  
- [ ] **导入用例**：加载 21 个攻击目标 × 2 个用户目标 × 2 环境 = **84** 任务；再加载 **Utility** 37 任务  
- [ ] **接入你的 agent**：选择 scaffold（axtree/SOM、桌面坐标或工具循环）  
- [ ] **运行评测**：记录 step 轨迹、动作与最终状态；  
  - **ASR-intermediate** 用 LLM 审核提示词判定“是否偏航”；  
  - **ASR-end-to-end** 用规则判定是否达成攻击结果  
- [ ] **消融**：URL vs Plain-text；task-related vs task-agnostic；是否加**防御 system prompt**；是否启用**指令层级**。:contentReference[oaicite:18]{index=18}

## 工程防御建议（可直接落地）
- [ ] **URL 与 DOM 卫生**：监测 `#anchor` 与非常规字段，建立白名单/正则过滤；  
- [ ] **渲染一致性**：截图 OCR ↔ DOM/URL 文本对齐，不一致触发“高危模式”（只读/二次确认）；  
- [ ] **目标参数溯源**：对 (o, r, e) 中 **r**（关键参数）做**来源绑定**与跨回合一致性校验；  
- [ ] **提示级 + 策略级**双保险：在高风险域（金融/隐私）强制二次确认/多通道校验；  
- [ ] **持续红队**：把“带偏未成功 / 成功完成”样本都回流成对，开展**偏好式安全训练**。:contentReference[oaicite:19]{index=19}

---

# 🧩 术语速查
- **ASR-intermediate**：被恶意指令带偏的比例（但未必完成攻击）  
- **ASR-end-to-end**：最终**达成攻击者目标**的比例  
- **URL 注入**：把恶意指令塞进 `#anchor`，在上下文中常驻  
- **Security by incompetence**：agent 能力不足导致“即使被带偏也难以完成攻击”的现象:contentReference[oaicite:20]{index=20}

---

# 📝 我的问题 & TODO
- [ ] 我们现有 agent 属于哪类 scaffold？最易受哪类注入？  
- [ ] 对关键业务流能否快速加入 **URL/DOM 审计 + 渲染一致性**？  
- [ ] 先在 WASP 跑一轮基线 → 再做 **system prompt 防御** 与 **指令层级**对照  
- [ ] 采集偏航/成功对，搭一条**DPO/RLAIF 安全训练**最小管线

---

# 🔗 参考
- 论文与基准：WASP（Web Agent Security against Prompt injection attacks）:contentReference[oaicite:21]{index=21}
