# ðŸ§  PyTorch æ•°å­¦è¿ç®—æ ¸å¿ƒç¬”è®°

> [!abstract|bg-blue] **æœ¬é¡µæ ¸å¿ƒå†…å®¹æ¦‚è§ˆ**
> - **åŸºç¡€è¿ç®—**: é€å…ƒç´ çš„åŠ ã€å‡ã€ä¹˜ã€é™¤ã€‚
> - **çŸ©é˜µä¹˜æ³•**: åŒºåˆ† `torch.mm`, `torch.matmul` å’Œ `@` çš„ä½¿ç”¨åœºæ™¯ã€‚
> - **å¹‚è¿ç®—**: `pow`, `sqrt`, `rsqrt` ä»¥åŠæŒ‡æ•° `exp` å’Œå¯¹æ•° `log`ã€‚
> - **è¿‘ä¼¼å–æ•´**: `floor`, `ceil`, `round`, `trunc`, `frac` çš„åŒºåˆ«ã€‚
> - **æ•°å€¼è£å‰ª**: `clamp` åŠå…¶åœ¨æ¢¯åº¦è£å‰ªä¸­çš„é‡è¦åº”ç”¨ã€‚

---

## ðŸ“˜ 1. åŸºç¡€è¿ç®— (Element-wise Operations)

> [!NOTE|bg-green] **æŒ‰å…ƒç´ è¿ç®—**
> PyTorch çš„åŸºç¡€ç®—æœ¯è¿ç®— (`+`, `-`, `*`, `/`) é»˜è®¤éƒ½æ˜¯æŒ‰å…ƒç´  (element-wise) è¿›è¡Œçš„ã€‚è¿™æ„å‘³ç€å¼ é‡ä¸­å¯¹åº”ä½ç½®çš„å…ƒç´ ä¼šåˆ†åˆ«è¿›è¡Œè®¡ç®—ã€‚

> [!EXAMPLE|bg-gray] **ä»£ç ç¤ºä¾‹: è¿ç®—ç¬¦ vs å‡½æ•°**
> ```python
> # åˆ›å»ºä¸¤ä¸ªéšæœºå¼ é‡
> a = torch.rand(3, 4)
> b = torch.rand(3, 4)
> 
> # ä½¿ç”¨è¿ç®—ç¬¦
> c = a + b 
> 
> # ä½¿ç”¨å‡½æ•°
> d = torch.add(a, b)
> 
> # éªŒè¯ä¸¤è€…ç»“æžœæ˜¯å¦å®Œå…¨ç›¸ç­‰
> torch.all(torch.eq(c, d))
> # Out: tensor(1, dtype=torch.uint8) -> è¡¨ç¤ºç»“æžœä¸º True
> ```
> **ç»“è®º**: ä½¿ç”¨ `a + b` è¿™æ ·çš„è¿ç®—ç¬¦å’Œ `torch.add(a, b)` è¿™æ ·çš„å‡½æ•°æ˜¯å®Œå…¨ç­‰ä»·çš„ã€‚é€‰æ‹©å“ªç§å–å†³äºŽä»£ç é£Žæ ¼å’Œå¯è¯»æ€§åå¥½ã€‚

---

## ðŸ“— 2. çŸ©é˜µä¹˜æ³• (Matrix Multiplication)

è¿™æ˜¯ç¥žç»ç½‘ç»œä¸­æœ€ä¸ºæ ¸å¿ƒçš„è¿ç®—ä¹‹ä¸€ã€‚

### a) 2D çŸ©é˜µä¹˜æ³•

> [!INFO|bg-cyan] **ä¸‰ç§å®žçŽ°æ–¹å¼**
> 1.  `torch.mm(a, b)`: **æœ€ä¸¥æ ¼**ï¼ŒåªæŽ¥å—ä¸¤ä¸ª 2D å¼ é‡ã€‚
> 2.  `torch.matmul(a, b)`: **æ›´é€šç”¨**ï¼Œæ”¯æŒ 2D å’Œæ›´é«˜ç»´åº¦çš„å¹¿æ’­çŸ©é˜µä¹˜æ³•ã€‚
> 3.  `a @ b`: `torch.matmul` çš„è¿ç®—ç¬¦ç®€å†™ï¼Œ**ä»£ç æœ€ç®€æ´**ã€‚

> [!EXAMPLE|bg-gray] **2D Matmul ä»£ç **
> ```python
> a = torch.full((2,2), 3.)
> b = torch.ones(2,2)
> 
> # ä¸‰ç§æ–¹å¼ç»“æžœç›¸åŒ
> out1 = torch.mm(a, b)
> out2 = torch.matmul(a, b)
> out3 = a @ b
> 
> # out1, out2, out3 å‡ä¸º:
> # tensor([[6., 6.],
> #         [6., 6.]])
> ```

### b) é«˜ç»´å¼ é‡ (Batched) çš„çŸ©é˜µä¹˜æ³•

> [!WARNING|bg-red] **`torch.mm` çš„å±€é™æ€§**
> `torch.mm` **æ— æ³•å¤„ç†** åŒ…å«æ‰¹æ¬¡ç»´åº¦ï¼ˆBatch Dimensionï¼‰çš„ 3D æˆ–æ›´é«˜ç»´åº¦çš„å¼ é‡ã€‚å¼ºè¡Œä½¿ç”¨ä¼šç›´æŽ¥æŠ¥é”™ `RuntimeError`ã€‚

> [!SUCCESS|bg-green] **æ­£ç¡®æ–¹å¼: `torch.matmul` æˆ– `@`**
> å½“å¼ é‡ç»´åº¦ > 2 æ—¶ï¼Œ`torch.matmul` ä¼šå°†æœ€åŽä¸¤ä¸ªç»´åº¦è§†ä¸ºçŸ©é˜µè¿›è¡Œä¹˜æ³•ï¼Œè€Œå°†å‰é¢çš„ç»´åº¦è§†ä¸ºæ‰¹æ¬¡ç»´åº¦ï¼Œå¹¶è‡ªåŠ¨åº”ç”¨**å¹¿æ’­ (Broadcasting) æœºåˆ¶**ã€‚

> [!EXAMPLE|bg-gray] **Batched Matmul ä»£ç ä¸Žé”™è¯¯åˆ†æž**
> ```python
> # åœºæ™¯: açš„æ‰¹æ¬¡ç»´åº¦ä¸º(4,3), bçš„æ‰¹æ¬¡ç»´åº¦ä¸º(4,1)
> a = torch.rand(4, 3, 28, 64)
> b = torch.rand(4, 1, 64, 32)
> 
> # æ­£ç¡®: bçš„ç»´åº¦(4,1)å¯ä»¥å¹¿æ’­åˆ°(4,3)
> c = torch.matmul(a, b) 
> c.shape # Out: torch.Size([4, 3, 28, 32])
> 
> # --- é”™è¯¯ç¤ºèŒƒ ---
> # açš„æ‰¹æ¬¡ç»´åº¦(4,3)ä¸Žbçš„æ‰¹æ¬¡ç»´åº¦(4,)ä¸åŒ¹é…ä¸”æ— æ³•å¹¿æ’­
> a = torch.rand(4, 3, 28, 64)
> b = torch.rand(4, 64, 32) # bç¼ºå°‘ä¸€ä¸ªæ‰¹æ¬¡ç»´åº¦
> 
> # torch.matmul(a,b) # ä¼šå¯¼è‡´ RuntimeError
> ```
> **æ ¸å¿ƒè¦ç‚¹**: åœ¨å¤„ç†å¸¦æ‰¹æ¬¡ï¼ˆå¦‚å›¾åƒã€æ–‡æœ¬åºåˆ—ï¼‰çš„æ•°æ®æ—¶ï¼Œè¯·å§‹ç»ˆä½¿ç”¨ `torch.matmul` æˆ– `@`ã€‚

---

## ðŸ“™ 3. å¹‚ã€æŒ‡æ•°ã€å¯¹æ•°ä¸Žå¹³æ–¹æ ¹

> [!NOTE|bg-purple] **Power & Exponential Operations**
> è¿™äº›å‡½æ•°åŒæ ·æ˜¯æŒ‰å…ƒç´ è¿›è¡Œè¿ç®—çš„ã€‚

> [!EXAMPLE|bg-gray] **ä»£ç ç¤ºä¾‹**
> ```python
> a = torch.full((2,2), 9.)
> 
> # --- Power & Sqrt ---
> a.pow(2)   # or a**2,   ç»“æžœæ˜¯ [[81., 81.], [81., 81.]]
> a.sqrt()   # or a**0.5, ç»“æžœæ˜¯ [[3., 3.], [3., 3.]]
> a.rsqrt()  # å¹³æ–¹æ ¹çš„å€’æ•° 1/sqrt(a), ç»“æžœæ˜¯ [[0.3333, ...]]
> 
> # --- Exp & Log ---
> b = torch.ones(2,2)
> c = torch.exp(b) # è®¡ç®— e^1, ç»“æžœæ˜¯ [[2.7183, ...]]
> torch.log(c)     # è®¡ç®— ln(c), ç»“æžœè¿˜åŽŸä¸º [[1., 1.], [1., 1.]]
> ```
> **è¦ç‚¹**: `exp` å’Œ `log` æ˜¯äº’é€†è¿ç®—ã€‚`rsqrt()` åœ¨æŸäº›ç®—æ³•ä¸­ï¼ˆå¦‚ Adam ä¼˜åŒ–å™¨ï¼‰æ¯” `1/a.sqrt()` è®¡ç®—æ•ˆçŽ‡æ›´é«˜ã€‚

---

## ðŸ“’ 4. è¿‘ä¼¼ä¸Žå–æ•´ (Approximation)

> [!INFO|bg-orange] **å¸¸ç”¨å–æ•´å‡½æ•°**
> - `.floor()`: **å‘ä¸‹**å–æ•´ (åœ°æ¿)ã€‚`3.9 -> 3.0`
> - `.ceil()`: **å‘ä¸Š**å–æ•´ (å¤©èŠ±æ¿)ã€‚`3.1 -> 4.0`
> - `.trunc()`: **æˆªæ–­**ï¼Œç›´æŽ¥åŽ»æŽ‰å°æ•°éƒ¨åˆ†ã€‚`3.9 -> 3.0`
> - `.frac()`: åªå–**å°æ•°éƒ¨åˆ†**ã€‚`3.9 -> 0.9`
> - `.round()`: **å››èˆäº”å…¥**ã€‚

> [!QUESTION|bg-blue] **`round(x.5)` å¦‚ä½•å·¥ä½œ?**
> **ç­”æ¡ˆ**: PyTorch çš„ `round()` é‡‡ç”¨ "å››èˆäº”å…¥åˆ°æœ€è¿‘çš„å¶æ•°" (*Round half to even*) çš„ç­–ç•¥ï¼Œè¿™æ˜¯ IEEE 754 æµ®ç‚¹æ•°æ ‡å‡†ã€‚
> - `torch.tensor(3.5).round()`  ç»“æžœæ˜¯ `4.0` (4æ˜¯å¶æ•°)
> - `torch.tensor(2.5).round()`  ç»“æžœæ˜¯ `2.0` (2æ˜¯å¶æ•°)

---

## ðŸ“• 5. æ•°å€¼è£å‰ª (Clamp)

> [!TIP|bg-pink] **é‡è¦åº”ç”¨: æ¢¯åº¦è£å‰ª (Gradient Clipping)**
> `clamp` å‡½æ•°æ˜¯ç¨³å®šç¥žç»ç½‘ç»œè®­ç»ƒçš„åˆ©å™¨ã€‚åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œå¦‚æžœæ¢¯åº¦å€¼è¿‡å¤§ï¼ˆç§°ä¸ºâ€œæ¢¯åº¦çˆ†ç‚¸â€ï¼‰ï¼Œä¼šå¯¼è‡´æ¨¡åž‹å‚æ•°æ›´æ–°è¿‡çŒ›ï¼Œç ´åå­¦ä¹ è¿‡ç¨‹ã€‚`clamp` å¯ä»¥å°†æ¢¯åº¦å¼ºåˆ¶é™åˆ¶åœ¨ä¸€ä¸ªå®‰å…¨çš„èŒƒå›´å†…ã€‚

> [!EXAMPLE|bg-gray] **Clamp ä»£ç ç¤ºä¾‹**
> ```python
> grad = torch.rand(2, 3) * 15 # åˆ›å»ºä¸€ä¸ª 0-15 ä¹‹é—´çš„éšæœºæ¢¯åº¦
> # grad å¯èƒ½æ˜¯: 
> # tensor([[14.8737, 10.1571,  4.4872],
> #         [11.3591,  8.9101, 14.0524]])
> 
> # 1. åªè®¾ç½®ä¸‹é™ min
> # å°†æ‰€æœ‰å°äºŽ 10 çš„å€¼æå‡åˆ° 10
> grad.clamp(10)
> # Out:
> # tensor([[14.8737, 10.1571, 10.0000],
> #         [11.3591, 10.0000, 14.0524]])
> 
> # 2. è®¾ç½®ä¸Šä¸‹é™ [min, max]
> # å°†æ‰€æœ‰å€¼è£å‰ªåˆ° [0, 10] åŒºé—´å†…
> grad.clamp(0, 10)
> # Out:
> # tensor([[10.0000, 10.0000,  4.4872],
> #         [10.0000,  8.9101, 10.0000]])
> ```