# 概率论笔记：随机变量的函数 (Chapter 3 续)

> [!NOTE] 本讲核心
> 1.  **单变量函数 ($Y=g(X)$)**：学习如何从 $X$ 的分布推导出 $Y=g(X)$ 的分布，包括离散和连续两种情况。
> 2.  **多变量函数 ($Y=g(X_1, \dots, X_n)$)**：
>     * 学习离散型多变量函数的处理方法。
>     * **重点掌握**：连续型 $Y = X_1 + X_2$ 的分布推导，即**卷积 (Convolution)**。
> 3.  **IID 样本 (IID Samples)**：理解“独立同分布”的含义及其在构建联合分布中的关键作用。

---

## 1. 单个随机变量的函数 ($Y=g(X)$)

### 1.1 <font color="#8E44AD">离散型 (Discrete Case)</font>

> [!TIP] 核心思想：合并同类项
> 离散型 $Y=g(X)$ 的分布求解非常直接。我们只需要找到 $Y$ 的每个可能取值 $y$，然后找到所有能导致 $Y=y$ 的 $X$ 的取值 $x$，最后将这些 $x$ 的概率相加即可。

**<font color="#E67E22">1. 定义与公式</font>**
如果 $X$ 是一个离散随机变量，其 PMF 为 $f_X(x)$。设 $Y = g(X)$。
那么 $Y$ 的 PMF $f_Y(y)$ 为：
$$f_Y(y) = P(Y=y) = P(g(X)=y) = \sum_{x \text{ s.t. } g(x)=y} P(X=x) = \sum_{x \text{ s.t. } g(x)=y} f_X(x)$$

**<font color="#E67E22">2. 表格法 (The Table Method)</font>**
这是最直观的方法：
1.  列出 $X$ 的原始 PMF 表格 (所有 $x_i$ 和 $p_i$)。
2.  创建新的一行 $y_i = g(x_i)$。
3.  找出 $Y$ 的所有**唯一**取值。
4.  将 $Y$ 值相同（重复）的列的概率 $p_i$ 相加，得到 $Y$ 的新 PMF 表格。

> [!EXAMPLE] 示例： $Y = |X-5|$
> 假设 $X$ 在 $\{1, 2, 3, 4, 5, 6, 7, 8, 9\}$ 上服从均匀分布 ($f_X(x) = 1/9$)。
> 求 $Y = |X-5|$ 的 PMF。
>
> **1. 创建表格：**
> | $x$ | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 |
> | :--- | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
> | $f_X(x)$ | 1/9 | 1/9 | 1/9 | 1/9 | 1/9 | 1/9 | 1/9 | 1/9 | 1/9 |
> | **$y = |x-5|$** | **4** | **3** | **2** | **1** | **0** | **1** | **2** | **3** | **4** |
>
> **2. 合并同类项 (Y)：**
> * $P(Y=0) = P(X=5) = 1/9$
> * $P(Y=1) = P(X=4) + P(X=6) = 1/9 + 1/9 = 2/9$
> * $P(Y=2) = P(X=3) + P(X=7) = 1/9 + 1/9 = 2/9$
> * $P(Y=3) = P(X=2) + P(X=8) = 1/9 + 1/9 = 2/9$
> * $P(Y=4) = P(X=1) + P(X=9) = 1/9 + 1/9 = 2/9$
>
> **3. 最终 Y 的 PMF：**
> | $y$ | 0 | 1 | 2 | 3 | 4 |
> | :--- | :---: | :---: | :---: | :---: | :---: |
> | $f_Y(y)$ | $1/9$ | $2/9$ | $2/9$ | $2/9$ | $2/9$ |

---

### 1.2 <font color="#2E86C1">连续型 (Continuous Case) - 万能 CDF 法</font>

> [!WARNING] 核心方法：先求 CDF，再求 PDF
> 对于连续型 $Y=g(X)$，我们**不能**像离散型那样直接求解 $g(y)$。 $Y$ 的 PDF $g(y)$ 没有一个简单的直接定义。
>
> **标准流程（万能 CDF 法）：**
> 1.  **定义 $Y$ 的 CDF：** $G(y) = P(Y \le y)$。
> 2.  **转换回 $X$：** $G(y) = P(g(X) \le y)$。通过代数变换，将其**<font color="#F39C12">完全用 $X$ 的 CDF $F_X(\cdot)$ 来表示</font>**。
> 3.  **求导：** $Y$ 的 PDF $g(y)$ 就是 $Y$ 的 CDF $G(y)$ 的导数： $g(y) = G'(y) = \frac{d}{dy} G(y)$。

---

### 1.3 <font color="#1E8449">连续型重要示例</font>

#### 示例 1: $Y = 1/Z$ (Z > 0)
> [!EXAMPLE]
> 设 $Z$ 是一个连续正随机变量，CDF 为 $F_Z(z)$，PDF 为 $f_Z(z)$。求 $Y = 1/Z$ 的 PDF $g(y)$。
>
> **1. 求 $Y$ 的 CDF $G(y)$：**
> $G(y) = P(Y \le y) = P(1/Z \le y)$
>
> **2. 转换回 $Z$：**
> (假设 $y > 0$) $P(1 \le yZ) \implies P(Z \ge 1/y)$
> 我们可以用 $Z$ 的 CDF $F_Z$ 来表示这个概率：
> $P(Z \ge 1/y) = 1 - P(Z < 1/y) = 1 - F_Z(1/y)$
> 所以, $G(y) = 1 - F_Z(1/y)$
>
> **3. 求导 (使用链式法则)：**
> $g(y) = G'(y) = \frac{d}{dy} (1 - F_Z(1/y))$
> $g(y) = 0 - f_Z(1/y) \cdot \left(\frac{d}{dy} \frac{1}{y}\right)$
> $g(y) = -f_Z(1/y) \cdot (-1/y^2)$
> **<font color="#1E8449">$$g(y) = \frac{1}{y^2} f_Z(1/y)$$</font>**

#### 示例 2: $Y = X^2$ (X ~ U(-1, 1))
> [!EXAMPLE]
> 设 $X \sim U(-1, 1)$，其 PDF 为 $f_X(x) = 1/2$ (在 $x \in [-1, 1]$ 上)。求 $Y = X^2$ 的 PDF $g(y)$。
>
> **1. 求 $Y$ 的 CDF $G(y)$：**
> $G(y) = P(Y \le y) = P(X^2 \le y)$
>
> **2. 转换回 $X$：**
> * 首先确定 $Y$ 的范围： $X \in [-1, 1] \implies Y=X^2 \in [0, 1]$。
> * 如果 $y < 0$， $P(X^2 \le y) = 0$。所以 $G(y) = 0$。
> * 如果 $y > 1$， $P(X^2 \le y) = 1$ (因为 $X^2$ 最大只到 1)。所以 $G(y) = 1$。
> * **我们只关心 $y \in [0, 1]$ 的情况：**
>     $P(X^2 \le y) = P(-\sqrt{y} \le X \le \sqrt{y})$
>     这等于 $X$ 的 PDF $f_X(x)$ 在 $[-\sqrt{y}, \sqrt{y}]$ 区间上的积分：
>     $G(y) = \int_{-\sqrt{y}}^{\sqrt{y}} f_X(x) \,dx = \int_{-\sqrt{y}}^{\sqrt{y}} \frac{1}{2} \,dx$
>     $G(y) = \frac{1}{2} [x]_{-\sqrt{y}}^{\sqrt{y}} = \frac{1}{2} (\sqrt{y} - (-\sqrt{y})) = \frac{1}{2} (2\sqrt{y}) = \sqrt{y}$
>     所以, $G(y) = \begin{cases} 0 & y < 0 \\ \sqrt{y} & 0 \le y \le 1 \\ 1 & y > 1 \end{cases}$
>
> **3. 求导：**
> $g(y) = G'(y) = \frac{d}{dy} (\sqrt{y}) = \frac{1}{2\sqrt{y}}$
>
> **<font color="#1E8449">$$g(y) = \begin{cases} \frac{1}{2\sqrt{y}} & 0 \le y \le 1 \\ 0 & \text{otherwise} \end{cases}$$</font>**

#### 示例 3: 线性变换 $Y = aX + b$
> [!EXAMPLE]
> 设 $X$ 有 PDF $f_X(x)$。求 $Y = aX + b$ 的 PDF $g(y)$。
>
> **1. 求 $Y$ 的 CDF $G(y)$：**
> $G(y) = P(Y \le y) = P(aX+b \le y) = P(aX \le y-b)$
>
> **2. 转换回 $X$ (注意 $a$ 的符号)：**
> * **Case 1: $a > 0$** (不等号不变)
>     $G(y) = P(X \le \frac{y-b}{a}) = F_X\left(\frac{y-b}{a}\right)$
> * **Case 2: $a < 0$** (不等号反转)
>     $G(y) = P(X \ge \frac{y-b}{a}) = 1 - P(X < \frac{y-b}{a}) = 1 - F_X\left(\frac{y-b}{a}\right)$
>
> **3. 求导 (使用链式法则)：**
> * **Case 1 ($a > 0$)：** $g(y) = G'(y) = f_X\left(\frac{y-b}{a}\right) \cdot \frac{1}{a}$
> * **Case 2 ($a < 0$)：** $g(y) = G'(y) = 0 - f_X\left(\frac{y-b}{a}\right) \cdot \frac{1}{a} = f_X\left(\frac{y-b}{a}\right) \cdot \frac{1}{(-a)}$
>
> **<font color="#1E8449">$$g(y) = f_X\left(\frac{y-b}{a}\right) \cdot \frac{1}{|a|}$$</font>**

#### 示例 4: 概率积分变换 (Probability Integral Transform)
> [!EXAMPLE]
> 设 $X$ 是一个连续随机变量，其 CDF 为 $F_X(x)$。设 $Y = F_X(X)$。
> 问 $Y$ 服从什么分布？
>
> **1. 求 $Y$ 的 CDF $G(y)$：**
> $Y$ 的取值范围是 $[0, 1]$。我们对 $y \in [0, 1]$ 求解。
> $G(y) = P(Y \le y) = P(F_X(X) \le y)$
>
> **2. 转换回 $X$：**
> $F_X(x)$ 是一个单调递增函数。我们可以对两边同时应用其反函数 $F_X^{-1}(\cdot)$ (即分位数函数)：
> $G(y) = P( F_X^{-1}(F_X(X)) \le F_X^{-1}(y) )$
> $G(y) = P(X \le F_X^{-1}(y))$
>
> 根据 $X$ 的 CDF 的定义 $P(X \le x) = F_X(x)$：
> $G(y) = F_X( F_X^{-1}(y) ) = y$
>
> **3. 结论：**
> $Y$ 的 CDF 是 $G(y) = y$ (在 $y \in [0, 1]$ 上)。
> **<font color="#1E8449">这是 $U(0, 1)$ (0 到 1 均匀分布) 的 CDF。</font>**
> $Y$ 的 PDF 是 $g(y) = G'(y) = 1$。
>
> > [!IMPORTANT] 结论：
> > 任何连续随机变量 $X$，通过它自己的 CDF $F_X$ 进行变换，得到的新变量 $Y$ 必定服从 $U(0, 1)$ 分布。

---

## 2. 多个随机变量的函数 ($Y=g(X_1, \dots, X_n)$)

### 2.1 <font color="#8E44AD">离散型 (Discrete Case)</font>

理论上和单变量相同，但计算上复杂得多。
设 $Y_1 = g_1(X_1, X_2), Y_2 = g_2(X_1, X_2)$。
$Y$ 的联合 PMF $f_Y(y_1, y_2) = P(Y_1=y_1, Y_2=y_2)$
$$f_Y(y_1, y_2) = \sum_{(x_1, x_2) \text{ s.t. } g_1(x_1, x_2)=y_1, g_2(x_1, x_2)=y_2} f_X(x_1, x_2)$$

> [!EXAMPLE] 多项分布示例
> 假设 $X_1, \dots, X_{10}$ 是 10 个基金的表现 (1=优, 0=差)。
> 定义 $Y = X_1 + \dots + X_{10}$ (表现优的基金总数)。
> 求 $P(Y=3)$。
> 这需要遍历所有 $X_1, \dots, X_{10}$ 的组合，使得它们的和为 3。这是一个复杂的组合问题。

---

### 2.2 <font color="#D35400">连续型 (Continuous Case) - 重点</font>

多维连续变换非常复杂。在本科目中，我们**<font color="#D35400">只要求掌握一种情况</font>**：
**两个随机变量之和：$Y = X_1 + X_2$**

#### 卷积 (Convolution) 的推导
我们使用“万能 CDF 法”：

**1. 求 $Y$ 的 CDF $G(y)$：**
$G(y) = P(Y \le y) = P(X_1 + X_2 \le y)$

**2. 转换回 $X_1, X_2$：**
这是一个二重积分，积分区域为 $x_1 + x_2 \le y$。
$$G(y) = \iint_{x_1+x_2 \le y} f(x_1, x_2) \,dx_1 \,dx_2$$
我们可以将积分区域写为：
$$G(y) = \int_{-\infty}^\infty \left[ \int_{-\infty}^{y-x_2} f(x_1, x_2) \,dx_1 \right] \,dx_2$$

**3. 求导 (获取 PDF $g(y)$)：**
$g(y) = G'(y) = \frac{d}{dy} \left( \int_{-\infty}^\infty \left[ \int_{-\infty}^{y-x_2} f(x_1, x_2) \,dx_1 \right] \,dx_2 \right)$

(通过数学推导，我们可以将导数符号移入积分号内)
$g(y) = \int_{-\infty}^\infty \left[ \frac{d}{dy} \left( \int_{-\infty}^{y-x_2} f(x_1, x_2) \,dx_1 \right) \right] \,dx_2$

对内部的积分（变量是 $x_1$，上限是 $y-x_2$）使用**微积分基本定理**：
$g(y) = \int_{-\infty}^\infty f(y-x_2, x_2) \,dx_2$

**<font color="#D35400">这就是 $Y=X_1+X_2$ 的 PDF 公式 (卷积公式)。</font>**

* **对称形式：** 如果我们先对 $x_2$ 积分，会得到等价的：
    **<font color="#D35400">$$g(y) = \int_{-\infty}^\infty f(x_1, y-x_1) \,dx_1$$</font>**

#### <font color="#F39C12">独立变量的卷积公式</font>
如果 $X_1$ 和 $X_2$ 是**独立**的，那么 $f(x_1, x_2) = f_1(x_1) \cdot f_2(x_2)$。
卷积公式简化为：

**<font color="#E74C3C">$$g(y) = \int_{-\infty}^\infty f_1(x_1) f_2(y-x_1) \,dx_1$$</font>**

或者
**<font color="#E74C3C">$$g(y) = \int_{-\infty}^\infty f_1(y-x_2) f_2(x_2) \,dx_2$$</font>**

---

### 2.3 <font color="#1E8449">卷积的重要示例</font>

> [!EXAMPLE] 两个 IID U(0, 1) 之和
> 设 $X_1, X_2$ 独立同分布于 $U(0, 1)$。
> $f_1(t) = 1, t \in [0, 1]$ 且 $f_2(t) = 1, t \in [0, 1]$。
> 求 $Y = X_1 + X_2$ 的 PDF $g(y)$。
>
> **1. 套用公式：**
> $g(y) = \int_{-\infty}^\infty f_1(x_1) f_2(y-x_1) \,dx_1$
>
> **2. 分析积分的非零部分：**
> 积分核 $f_1(x_1) \cdot f_2(y-x_1)$ 要非零，必须**同时**满足：
> * $f_1(x_1) \neq 0 \implies \mathbf{0 \le x_1 \le 1}$
> * $f_2(y-x_1) \neq 0 \implies 0 \le y-x_1 \le 1 \implies \mathbf{y-1 \le x_1 \le y}$
>
> 积分 $g(y)$ 等于 1 在 $x_1$ 轴上两个区间 $[0, 1]$ 和 $[y-1, y]$ **交集**的长度。
>
> **3. 分情况讨论 $Y$ ( $Y$ 的范围是 $[0, 2]$ )：**
>
> * **Case 1: $0 \le y < 1$** (例如 $y=0.5$，交集为 $[0, 0.5]$)
>     交集为 $[0, y]$。
>     $g(y) = \int_0^y 1 \cdot 1 \,dx_1 = [x_1]_0^y = y$
>
> * **Case 2: $1 \le y \le 2$** (例如 $y=1.5$，交集为 $[0.5, 1]$)
>     交集为 $[y-1, 1]$。
>     $g(y) = \int_{y-1}^1 1 \cdot 1 \,dx_1 = [x_1]_{y-1}^1 = 1 - (y-1) = 2-y$
>
> * **Case 3: $y < 0$ 或 $y > 2$**
>     交集为空。$g(y) = 0$。
>
> **<font color="#1E8449">$$g(y) = \begin{cases} y & 0 \le y < 1 \\ 2-y & 1 \le y \le 2 \\ 0 & \text{otherwise} \end{cases}$$</font>**
> (这是一个“三角分布”)

---

## 3. IID 变量和的特殊性质

> [!NOTE] IID (Independent and Identically Distributed)
> **独立同分布 (IID)** 是统计学中最重要的概念之一，它代表了一组“随机样本”。
> * **Independent (独立)：** 变量间互不影响。
> * **Identically Distributed (同分布)：** 它们都来自同一个（未知的）总体分布 $f$。
>
> IID 使得联合 PDF 极大简化： $f(x_1, \dots, x_n) = \prod_{i=1}^n f(x_i)$。

#### <font color="#F39C12">特殊分布的和 (可加性)</font>

* **Bernoulli $\rightarrow$ Binomial:**
    如果 $X_i \sim \text{Bernoulli}(p)$ 且 IID，则 $Y = \sum_{i=1}^n X_i \sim \text{Binomial}(n, p)$。
* **Binomial + Binomial:**
    如果 $X_1 \sim \text{Binomial}(n_1, p)$ 且 $X_2 \sim \text{Binomial}(n_2, p)$ (**<font color="#E74C3C">P 必须相同</font>**) 且独立，
    则 $Y = X_1 + X_2 \sim \text{Binomial}(n_1 + n_2, p)$。
* **Normal + Normal:**
    (预告) 正态分布的和仍然是正态分布。
* **Poisson + Poisson:**
    (预告) 泊松分布的和仍然是泊松分布。


