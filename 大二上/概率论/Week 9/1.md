# 概率论笔记：条件分布、独立性与多维变量

> [!NOTE] 本讲核心
> 1.  **概率分布的三大定律**：乘法法则、全概率定律、贝叶斯定理在随机变量中的应用。
> 2.  **随机变量的独立性 (Independence)**：深入理解独立性的定义、等价条件、以及一个至关重要的判别陷阱（定义域陷阱）。
> 3.  **多维 (n-维) 随机变量**：将二维的概念（联合、边际）推广到 n-维，并引出统计学中最重要的基石：**IID 独立同分布**。
> 4.  **随机变量的函数**：介绍如何求解一个已知随机变量（如 $X$）的函数（如 $Y = X^2$）的分布。

---

## 1. 条件分布的应用 (回顾与深入)

上一讲我们推导了条件 PDF 的公式：$g_1(x|y) = \frac{f(x,y)}{f_Y(y)}$。现在我们来看如何使用它。

> [!EXAMPLE] 示例：使用条件 PDF 计算概率
> 假设已知 $X$ 在给定 $Y=y$ 下的条件 PDF 为：
> $$g_1(x|y) = e^{y-x}, \quad \text{for } x \ge y \quad \text{(y 是一个正数)}$$
>
> 现观测到 $Y=4$。求 $P(X \ge 9 \mid Y=4)$。
>
> **讲解：**
> 1.  **“给定 $Y=4$”** 意味着我们现在只关心 $g_1(x|4)$ 这个特定的分布。
> 2.  将 $y=4$ 代入条件 PDF：
>     $$g_1(x|4) = e^{4-x}, \quad \text{for } x \ge 4$$
> 3.  我们要求的概率 $P(X \ge 9 \mid Y=4)$ 就是在这个 $g_1(x|4)$ 分布下， $X$ 在 $[9, \infty)$ 区间上的积分。
>
> **计算：**
> $$P(X \ge 9 \mid Y=4) = \int_9^\infty g_1(x|4) \,dx = \int_9^\infty e^{4-x} \,dx$$
> $$= \left[ -e^{4-x} \right]_9^\infty = \lim_{x \to \infty} (-e^{4-x}) - (-e^{4-9})$$
> $$= 0 - (-e^{-5}) = e^{-5}$$

> [!WARNING] 条件 PDF 的局限性
> 条件 PDF $g(x|y)$ 只能处理 $Y$ 被固定为**单个值** (如 $Y=4$) 的情况。
> 如果你被要求计算 $P(X \ge 9 \mid 1 \le Y \le 3)$，你**不能**直接把区间代入 $g(x|y)$。你必须回到最基本的定义，计算联合概率和边际概率的积分：
> $$P(X \ge 9 \mid 1 \le Y \le 3) = \frac{P(X \ge 9, 1 \le Y \le 3)}{P(1 \le Y \le 3)} = \frac{\int_1^3 \int_9^\infty f(x,y) \,dx \,dy}{\int_1^3 f_Y(y) \,dy}$$

---

## 2. 联合、条件、边际的“三大定律”

这部分是将第二章关于事件的三个核心公式，推广到随机变量的 PMF/PDF。

### <font color="#3498DB">定律一：乘法法则 (Multiplication Rule)</font>

> [!NOTE] 核心思想：用“条件”和“边际”构建“联合”
> * **事件：** $P(A \cap B) = P(A|B) P(B)$
> * **随机变量：** $f(x,y) = g_1(x|y) \cdot f_Y(y)$ (也等于 $g_2(y|x) \cdot f_X(x)$)
>
> 这个定律适用于离散型 (PMF) 和连续型 (PDF)。

**<font color="#E67E22">为什么这很重要？</font>**
在现实世界中，**联合分布 $f(x,y)$ 往往很难直接得到**。相反，我们更容易通过实验观测到**条件分布** (例如，*在给定身高 $Y=y$ 的条件下*，体重的分布 $g_1(x|y)$) 和**边际分布** (例如，人群中身高的总体分布 $f_Y(y)$)。乘法法则允许我们用这两个更容易获得的部分，来构建出完整的联合分布 $f(x,y)$。

> [!WARNING] 定义域陷阱
> 当使用乘法法则 $f(x,y) = g_1(x|y) f_Y(y)$ 时，所得到的 $f(x,y)$ 的**支撑域 (Support)** 必须是 $g_1(x|y)$ 和 $f_Y(y)$ **两个定义域的交集**。

### <font color="#9B59B6">定律二：全概率定律 (Law of Total Probability)</font>

> [!NOTE] 核心思想：用“条件”和“另一边际”构建“本边际”
> * **事件：** $P(A) = \sum_i P(A|B_i) P(B_i)$
> * **随机变量：** 我们想求 $f_X(x)$，但只有关于 Y 的信息 ($g_1(x|y)$ 和 $f_Y(y)$)。
>
> 我们通过“积分掉”或“求和掉” Y 来得到 $f_X(x)$：
>
> * **如果 Y 是连续的：**
>   $$f_X(x) = \int_{-\infty}^\infty f(x,y) \,dy = \int_{-\infty}^\infty g_1(x|y) f_Y(y) \,dy$$
> * **如果 Y 是离散的：**
>   $$f_X(x) = \sum_y f(x,y) = \sum_y g_1(x|y) f_Y(y)$$

### <font color="#E74C3C">定律三：贝叶斯定理 (Bayes' Theorem)</font>

> [!NOTE] 核心思想：“翻转”条件
> * **事件：** $P(B|A) = \frac{P(A|B)P(B)}{P(A)}$
> * **随机变量：** 我们**有** $g_1(x|y)$ (例如：给定病因，看症状的分布)，但我们**想求** $g_2(y|x)$ (例如：观测到症状，反推病因的分布)。
>
> $$g_2(y|x) = \frac{f(x,y)}{f_X(x)}$$
>
> 结合**乘法法则** (分子) 和**全概率定律** (分母)，我们得到贝叶斯公式的 PDF/PMF 形式：
>
> <font color="#F39C12">**(连续型)**</font>
> $$g_2(y|x) = \frac{g_1(x|y) \cdot f_Y(y)}{\int_{-\infty}^\infty g_1(x|y) f_Y(y) \,dy}$$
> <font color="#F39C12">**(离散型)**</font>
> $$g_2(y|x) = \frac{g_1(x|y) \cdot f_Y(y)}{\sum_y g_1(x|y) f_Y(y)}$$

**讲解：**
* **$f_Y(y)$**：称为**先验分布 (Prior)**。这是我们在观测到 $x$ 之前对 $y$ 的了解。
* **$g_1(x|y)$**：称为**似然 (Likelihood)**。这是 $y$ "产生" $x$ 的概率模型。
* **$g_2(y|x)$**：称为**后验分布 (Posterior)**。这是我们观测到 $x$ 之后，对 $y$ 更新后的认识。
* 分母 $f_X(x)$ 是一个归一化常数，确保后验分布的积分（或求和）为 1。

---

## 3. 随机变量的独立性 (Independence)

> [!NOTE] 核心概念
> “独立性”意味着两个变量 $X$ 和 $Y$ 互不影响。知道一个变量的值，不会给另一个变量的分布提供任何新信息。

### <font color="#1E8449">等价定义 1：条件概率</font>

* **事件：** $P(A|B) = P(A)$。
* **随机变量：** $g_1(x|y) = f_X(x)$。
    * **讲解：** “在给定 $Y=y$ 的条件下 $X$ 的分布” ($g_1(x|y)$) 与“ $X$ 本身的边际分布” ($f_X(x)$) 是完全相同的。
    * 这意味着 $g_1(x|y)$ 这个函数表达式中**不能包含 $y$**。 $y$ 的取值不会改变 $x$ 的分布。

### <font color="#1E8449">等价定义 2：联合分布 (最常用的判据)</font>

> [!IMPORTANT] 独立性判据 (I)
> 两个随机变量 $X$ 和 $Y$ 是**独立**的，**当且仅当 (if and only if)** 它们的：
>
> * **联合 PMF/PDF** 等于它们**边际 PMF/PDF 的乘积**。
>     $$f(x,y) = f_X(x) \cdot f_Y(y)$$
> * **联合 CDF** 等于它们**边际 CDF 的乘积**。
>     $$F(x,y) = F_X(x) \cdot F_Y(y)$$

**推导 (从定义 1 $\rightarrow$ 定义 2):**
1.  我们从乘法法则开始：$f(x,y) = g_1(x|y) f_Y(y)$。
2.  我们使用独立性的定义 1：$g_1(x|y) = f_X(x)$。
3.  将 (2) 代入 (1)：$f(x,y) = f_X(x) f_Y(y)$。
(证毕)

### <font color="#1E8449">等价定义 3：可分离函数 (最简单的判据)</font>

> [!IMPORTANT] 独立性判据 (II) - "可分离"
> $X$ 和 $Y$ 是**独立**的，**当且仅当** 它们的联合 PMF/PDF $f(x,y)$ 可以被分解为一个*只关于 $x$ 的函数* $h_1(x)$ 和一个*只关于 $y$ 的函数* $h_2(y)$ 的乘积。
>
> $$f(x,y) = h_1(x) \cdot h_2(y)$$

**讲解：**
这个判据更强大，因为 $h_1(x)$ 和 $h_2(y)$ **不一定**需要是归一化的边际 PDF。它们可以是边际 PDF 的**任意常数倍**。这使我们不必费力去计算边际 $f_X(x)$ 和 $f_Y(y)$，只需要目测 $f(x,y)$ 能否“因式分解”。

> [!EXAMPLE] 示例：使用“可分离”判据
> 假设 $f(x,y) = e^{-x-y}$，定义域为 $x \ge 0, y \ge 0$。
> 我们可以将其分解为：
> $$f(x,y) = (e^{-x}) \cdot (e^{-y})$$
>
> * $h_1(x) = e^{-x}$ (一个只关于 x 的函数)
> * $h_2(y) = e^{-y}$ (一个只关于 y 的函数)
>
> **结论：** $X$ 和 $Y$ 是独立的。

---

### <font color="#C0392B">独立性的重大陷阱：定义域 (Support)</font>

> [!WARNING]
> 上述“可分离”判据 $f(x,y) = h_1(x)h_2(y)$ 必须**同时**满足：
> 1.  **函数形式** 可分离。
> 2.  **定义域 (Support)** 也必须是可分离的（即一个“矩形”区域）。
>
> 如果 $X$ 的取值范围**依赖于 $Y$ 的值**，那么它们**绝对不是**独立的。

> [!EXAMPLE] 失败案例 1：函数不可分离
> $f(x,y) = C(x^2 + y^2)$，定义域为 $x^2+y^2 \le 1$。
> **失败原因：** $x^2+y^2$ 无法因式分解为 $h_1(x) \cdot h_2(y)$。

> [!EXAMPLE] 失败案例 2：定义域不可分离 (更隐蔽!)
> 假设 $f(x,y) = C \cdot x^2 y^2$，定义域为 $x^2+y^2 \le 1$ (单位圆)。
>
> * **函数形式：** $x^2 y^2$ 是可分离的 ($h_1(x)=x^2, h_2(y)=y^2$)。
> * **定义域：** *不可分离*。 $Y$ 的取值范围是 $[-\sqrt{1-x^2}, \sqrt{1-x^2}]$，这**强烈依赖于 $x$ 的值**。
>
> **结论：** $X$ 和 $Y$ **不是**独立的。
>
> **严格证明 (寻找反例)：**
> 1.  在 $(0.8, 0.8)$ 处：$0.8^2 + 0.8^2 = 0.64 + 0.64 = 1.28 > 1$。
> 2.  这一点在定义域之外，所以 $f(0.8, 0.8) = 0$。
> 3.  但是， $X$ 可以取 0.8 (例如 $Y=0$ 时)，所以 $f_X(0.8) > 0$。
> 4.  同理， $Y$ 也可以取 0.8 (例如 $X=0$ 时)，所以 $f_Y(0.8) > 0$。
> 5.  因此， $f_X(0.8) \cdot f_Y(0.8) > 0$。
> 6.  由于 $f(0.8, 0.8) \neq f_X(0.8) \cdot f_Y(0.8)$ ( $0 \neq \text{正数}$ )，所以它们**不独立**。

### <font color="#1E8449">如何检验/使用独立性？</font>

**1. 如何证明“不独立” (Show NOT Independent):**
你只需要找到**一个**反例 $(x, y)$ 使得 $f(x,y) \neq f_X(x) f_Y(y)$。

> [!EXAMPLE] 离散型反例
> 假设 $f(2,0)=0.08$。
> 你计算出边际 $f_X(2) = 0.253$ 且 $f_Y(0) = 0.359$。
> $f_X(2) \cdot f_Y(0) = 0.253 \times 0.359 \approx 0.0908$。
> 因为 $0.08 \neq 0.0908$，所以 $X$ 和 $Y$ **不独立**。

**2. 如何证明“独立” (Show IS Independent):**
你必须证明 $f(x,y) = f_X(x) f_Y(y)$ 对**所有** $(x, y)$ 都成立。

**3. 如何使用“独立” (Use Independence):**
在现实中，我们常常**根据物理假设**（例如：连续两年的降雨量）来**假设 $X, Y$ 独立**。
这个假设允许我们从简单的边际分布 $f_X(x)$ 和 $f_Y(y)$ 出发，**构建**出联合分布 $f(x,y) = f_X(x) f_Y(y)$，从而计算复杂的联合概率。

> [!EXAMPLE] 示例：使用独立性
> 假设 $X \sim U(0,1)$ 且 $Y \sim U(0,1)$，并且 $X, Y$ 相互独立。求 $P(X+Y \le 1)$。
>
> 1.  **边际 PDF：** $f_X(x) = 1$ (在 $0 \le x \le 1$ 上)，$f_Y(y) = 1$ (在 $0 \le y \le 1$ 上)。
> 2.  **构建联合 PDF：** 因为独立， $f(x,y) = f_X(x) \cdot f_Y(y) = 1 \times 1 = 1$。
> 3.  **构建定义域：** $f(x,y)$ 的定义域是 $f_X(x)$ 和 $f_Y(y)$ 定义域的交集，即 $0 \le x \le 1$ 且 $0 \le y \le 1$ (一个单位正方形)。
> 4.  **计算概率：** 我们要求 $f(x,y)=1$ 在 $x+y \le 1$ 区域上的二重积分 (即体积)。
>     $$P(X+Y \le 1) = \iint_{x+y \le 1, x \ge 0, y \ge 0} 1 \,dA$$
>     * 由于 PDF 是常数 1，这个积分就等于**区域的面积**。
>     * $x+y \le 1, x \ge 0, y \ge 0$ 是一个底为 1、高为 1 的三角形。
>     * 面积 = $\frac{1}{2} \times \text{底} \times \text{高} = \frac{1}{2} \times 1 \times 1 = 1/2$。
>
> **(通过积分计算)：**
> $$\int_0^1 \left( \int_0^{1-x} 1 \,dy \right) \,dx = \int_0^1 [y]_0^{1-x} \,dx = \int_0^1 (1-x) \,dx = \left[ x - \frac{x^2}{2} \right]_0^1 = (1 - \frac{1}{2}) - 0 = \frac{1}{2}$$

---

## 4. 多维随机变量 (Multivariate Distributions)

> [!NOTE] 核心思想
> 将 2 维 $(X, Y)$ 的概念推广到 n 维 $(X_1, X_2, \dots, X_n)$。

* **联合 CDF：** $F(x_1, \dots, x_n) = P(X_1 \le x_1, \dots, X_n \le x_n)$
* **联合 PDF：** $f(x_1, \dots, x_n) = \frac{\partial^n F}{\partial x_1 \dots \partial x_n}$
* **边际 CDF：** 要求 $X_1$ 的边际，将所有其他变量 $x_2, \dots, x_n$ 设为 $\infty$。
* **边际 PDF：** 要求 $X_1$ 的边际，将所有其他变量 $x_2, \dots, x_n$ 积分积掉。
* **条件 PDF：** $f(x_n | x_1, \dots, x_{n-1}) = \frac{f(x_1, \dots, x_n)}{f(x_1, \dots, x_{n-1})}$

**计算**：这些概念在理论上是简单的推广，但在计算上极其困难（涉及 n 重积分）。

### <font color="#F39C12">多项分布 (Multinomial Distribution)</font>

这是**二项分布 (Binomial)** 的推广。
* **二项分布：** $n$ 次试验，2 种可能结果（成功/失败）。
* **多项分布：** $n$ 次试验， $k$ 种可能结果（类型 1, ..., 类型 k），每种结果的概率为 $p_1, \dots, p_k$ (且 $\sum p_i = 1$)。
* $X_i$ = 类型 $i$ 出现的次数。
* **联合 PMF：**
    $$f(x_1, \dots, x_k) = \frac{n!}{x_1! x_2! \dots x_k!} p_1^{x_1} p_2^{x_2} \dots p_k^{x_k}$$

### <font color="#E74C3C">IID 随机变量 (统计学的基石)</font>

> [!IMPORTANT]
> 在本课程和整个统计学中，我们最常处理的多维情形是 **IID**。
>
> **IID = <font color="#E74C3C">I</font>ndependent and <font color="#E74C3C">I</font>dentically <font color="#E74C3C">D</font>istributed (独立同分布)**
>
> * **Independent (独立)：** 变量间相互独立。
>     $f(x_1, \dots, x_n) = f_{X_1}(x_1) \cdot f_{X_2}(x_2) \cdot \dots \cdot f_{X_n}(x_n)$
> * **Identically Distributed (同分布)：** 所有边际分布**完全相同**。
>     $f_{X_1} = f_{X_2} = \dots = f_{X_n} = f$ (某个共同的分布 $f$)
>
> **IID 的联合 PDF (非常简单)：**
> $$f(x_1, \dots, x_n) = f(x_1) \cdot f(x_2) \cdot \dots \cdot f(x_n) = \prod_{i=1}^n f(x_i)$$
>
> **讲解：**
> 这就是“**随机样本** (Random Sample)”的数学定义。例如，从人群中随机抽取 $n$ 个人，测量他们的身高。这 $n$ 个身高 $X_1, \dots, X_n$ 就可以被建模为 IID 变量，它们都服从人群的身高分布 $f(x)$。

---

## 5. 随机变量的函数 (Functions of Random Variables)

> [!NOTE] 核心问题
> 我们已知 $X$ 的分布 (PMF 或 PDF)，现在我们定义一个新变量 $Y = g(X)$。
> 我们想求 $Y$ 的分布 (PMF 或 PDF)。

### <font color="#8E44AD">情况 A：离散型 (The Easy Case)</font>

对于离散型，我们只需要：
1.  找出 $Y$ 的所有可能取值。
2.  对于 $Y$ 的每一个可能值 $y$，找出所有 $X$ 的值 $x$ 使得 $g(x) = y$。
3.  将这些 $x$ 对应的**概率相加**。

> [!EXAMPLE] 示例： $Y = |X-5|$
> 假设 $X$ 在 $\{1, 2, 3, 4, 5, 6, 7, 8, 9\}$ 上服从均匀分布。
> * $X$ 的 PMF 为 $f_X(x) = 1/9$，对于 $x \in \{1, \dots, 9\}$。
> * 我们定义 $Y = |X-5|$。
>
> **求 $Y$ 的 PMF：**
> 1.  **$Y$ 的可能取值：**
>     * $x=1 \implies y=4$
>     * $x=2 \implies y=3$
>     * $x=3 \implies y=2$
>     * $x=4 \implies y=1$
>     * $x=5 \implies y=0$
>     * $x=6 \implies y=1$
>     * ... $x=9 \implies y=4$
>     $Y$ 的可能取值为 $\{0, 1, 2, 3, 4\}$。
>
> 2.  **计算 $Y$ 的概率：**
>     * **$P(Y=0)$：**
>         $Y=0 \implies |X-5|=0 \implies X=5$。
>         $P(Y=0) = P(X=5) = 1/9$。
>
>     * **$P(Y=1)$：**
>         $Y=1 \implies |X-5|=1 \implies X=4$ 或 $X=6$。
>         $P(Y=1) = P(X=4) + P(X=6) = 1/9 + 1/9 = 2/9$。
>
>     * **$P(Y=2)$：**
>         $Y=2 \implies |X-5|=2 \implies X=3$ 或 $X=7$。
>         $P(Y=2) = P(X=3) + P(X=7) = 1/9 + 1/9 = 2/9$。
>
>     * **$P(Y=3)$：**
>         $Y=3 \implies |X-5|=3 \implies X=2$ 或 $X=8$。
>         $P(Y=3) = P(X=2) + P(X=8) = 1/9 + 1/9 = 2/9$。
>
>     * **$P(Y=4)$：**
>         $Y=4 \implies |X-5|=4 \implies X=1$ 或 $X=9$。
>         $P(Y=4) = P(X=1) + P(X=9) = 1/9 + 1/9 = 2/9$。
>
> **结论 (Y 的 PMF)：**
> | $y$ | 0 | 1 | 2 | 3 | 4 |
> | :--- | :---: | :---: | :---: | :---: | :---: |
> | $f_Y(y)$ | $1/9$ | $2/9$ | $2/9$ | $2/9$ | $2/9$ |
>
> (检查：$1/9 + 4 \times (2/9) = 9/9 = 1$。正确。)

