# 第7章 贝叶斯统计推断 (Bayesian Statistical Inference)

> [!abstract] **本章核心思想**
> 
> * **传统统计 vs 贝叶斯统计**：
>     * 传统统计（频率学派）：参数 $\theta$ 是一个**未知但固定**的常数。
>     * **贝叶斯统计**：参数 $\theta$ 是一个**随机变量 (Random Variable)**。
> * **核心流程**：
>     我们对事物有一个原始的看法（**先验分布**），通过观测数据（**似然函数**），将两者融合，得到更新后的看法（**后验分布**）。
>     $$\text{Prior (经验)} + \text{Data (数据)} \rightarrow \text{Posterior (新认知)}$$

---

## 1. 核心概念定义的转变

### 1.1 先验分布 (Prior Distribution)
在观测到具体的样本数据 $X_1, X_2, \dots$ **之前**，根据以往的经验或信念，赋予参数 $\theta$ 的概率分布。

* **符号**：$\pi(\theta)$
    * 若 $\theta$ 是离散的：称为先验概率函数 (Prior Probability Function)。
    * 若 $\theta$ 是连续的：称为先验概率密度函数 (Prior PDF)。
* **直观理解**：“在我做实验验证之前，我觉得 $\theta$ 长什么样。”

### 1.2 似然函数 (Likelihood Function)
当样本观测值 $(x_1, \dots, x_n)$ **固定**下来后，联合概率密度函数 $f(\mathbf{x}|\theta)$ 被视为参数 $\theta$ 的函数。

* **符号**：$L(\theta|\mathbf{x}) = f(x_1, \dots, x_n | \theta)$
* **计算 (独立同分布样本)**：
    $$L(\theta) = \prod_{i=1}^n f(x_i|\theta)$$
* **核心区别**：虽然数学式子一样，但物理意义变了。这里 $x$ 是已知的常数，$\theta$ 是变量。我们要看哪个 $\theta$ 让这些数据出现的概率最大。

### 1.3 边缘分布 (Marginal Distribution)
为了算出后验分布，我们需要一个归一化常数（分母）。这是关于数据 $\mathbf{x}$ 的边缘分布，与 $\theta$ 无关。

* **公式**：
    $$g_n(\mathbf{x}) = \int_{-\infty}^{+\infty} L(\theta|\mathbf{x}) \pi(\theta) d\theta$$
* **作用**：确保后验分布积分等于1，成为一个合法的概率分布。

### 1.4 后验分布 (Posterior Distribution)
在观测到样本数据 $\mathbf{x}$ **之后**，结合了先验信息和数据证据，得到的关于 $\theta$ 的条件分布。

> [!important] **贝叶斯公式 (Bayes' Theorem)**
> $$\pi(\theta|\mathbf{x}) = \frac{f(\mathbf{x}|\theta) \pi(\theta)}{g_n(\mathbf{x})} \propto \text{Likelihood} \times \text{Prior}$$
> * **分子**：似然函数 $\times$ 先验分布
> * **分母**：边缘分布（归一化常数）

---

## 2. 经典例题与详细推导

### 2.1 例题一：产品次品率 (Defective Items)
**模型：Uniform Prior + Binomial Likelihood $\rightarrow$ Beta Posterior**

> [!question] **题目描述**
> * **场景**：工厂生产一批产品，次品率 $\theta$ 未知。
> * **先验**：假设 $\theta$ 服从 $0$ 到 $1$ 上的**均匀分布 (Uniform)**。
> * **数据**：抽取 $n$ 个产品，其中 $y$ 个是次品（$X_i=1$为次品，$X_i=0$为正品，$y=\sum X_i$）。
> * **目标**：求 $\theta$ 的后验分布。

#### **详细推导步骤**

1.  **写出先验分布 $\pi(\theta)$**：
    $$ \pi(\theta) = 
    \begin{cases} 
    1, & 0 \le \theta \le 1 \\
    0, & \text{其他}
    \end{cases} 
    $$

2.  **写出似然函数 $L(\theta)$**：
    样本服从伯努利分布，联合概率为：
    $$f(\mathbf{x}|\theta) = \prod_{i=1}^n \theta^{x_i} (1-\theta)^{1-x_i} = \theta^{\sum x_i} (1-\theta)^{n-\sum x_i} = \theta^y (1-\theta)^{n-y}$$

3.  **计算分母 $g_n(\mathbf{x})$ (关键积分)**：
    $$g_n(\mathbf{x}) = \int_0^1 \theta^y (1-\theta)^{n-y} \cdot 1 \, d\theta$$
    这里利用 **Beta函数 (Euler Integral)** 的性质：
    $$\int_0^1 x^{a-1} (1-x)^{b-1} dx = B(a, b) = \frac{\Gamma(a)\Gamma(b)}{\Gamma(a+b)}$$
    
    在本题中，对应指数为 $y$ 和 $n-y$，所以参数为 $y+1$ 和 $n-y+1$：
    $$g_n(\mathbf{x}) = \frac{\Gamma(y+1)\Gamma(n-y+1)}{\Gamma(n+2)}$$
    
    利用阶乘性质 $\Gamma(n) = (n-1)!$：
    $$g_n(\mathbf{x}) = \frac{y! (n-y)!}{(n+1)!}$$

4.  **得出后验分布**：
    $$\pi(\theta|\mathbf{x}) = \frac{\theta^y (1-\theta)^{n-y}}{\frac{y! (n-y)!}{(n+1)!}} = \frac{(n+1)!}{y!(n-y)!} \theta^y (1-\theta)^{n-y}, \quad 0 \le \theta \le 1$$

> [!success] **结论**
> 后验分布是 **Beta分布**。我们从“均匀分布”更新为了“Beta分布”。
> * 利用这个分布，我们可以更准确地计算次品率落在某个区间的概率。

---

### 2.2 例题二：荧光灯寿命 (Fluorescent Lamps)
**模型：Gamma Prior + Exponential Likelihood $\rightarrow$ Gamma Posterior**

> [!question] **题目描述**
> * **数据**：灯泡寿命 $X$ 服从指数分布 $Exp(\theta)$，PDF为 $f(x) = \theta e^{-\theta x}, x>0$。
>     * 注意：这里 $\theta$ 是率参数 (rate parameter)，平均寿命是 $1/\theta$。
> * **先验**：$\theta$ 服从 Gamma 分布。已知先验均值 $\mu_0 = 0.02$，标准差 $\sigma_0 = 0.01$。
> * **任务**：确定先验参数，并推导后验分布。

#### **详细推导步骤**

1.  **确定先验参数 $\alpha, \beta$**：
    Gamma分布 $Ga(\alpha, \beta)$ 的性质：
    * 均值 $E = \frac{\alpha}{\beta}$
    * 方差 $Var = \frac{\alpha}{\beta^2}$ (即 $\sigma^2$)
    
    联立方程：
    $$ 
    \begin{cases} 
    \frac{\alpha}{\beta} = 0.02 \\
    \frac{\alpha}{\beta^2} = 0.0001 \quad (0.01^2)
    \end{cases} 
    $$
    解方程（用①式除以②式）：
    $$\beta = \frac{0.02}{0.0001} = 200$$
    代回①式：
    $$\alpha = 0.02 \times 200 = 4$$
    
    $\therefore$ 先验分布 $\pi(\theta) \propto \theta^{4-1} e^{-200\theta} = \theta^3 e^{-200\theta}$。

2.  **写出似然函数**：
    $$L(\theta) = \prod_{i=1}^n \theta e^{-\theta x_i} = \theta^n e^{-\theta \sum x_i}$$

3.  **推导后验分布**：
    $$ 
    \begin{aligned}
    \pi(\theta|\mathbf{x}) &\propto \text{Likelihood} \times \text{Prior} \\
    &\propto (\theta^n e^{-\theta \sum x_i}) \times (\theta^3 e^{-200\theta}) \\
    &\propto \theta^{(n+4)-1} e^{-(200 + \sum x_i)\theta}
    \end{aligned}
    $$

> [!success] **结论**
> 观察上式结构，它依然是一个 **Gamma分布**。
> * 新参数 $\alpha' = n + 4$
> * 新参数 $\beta' = 200 + \sum_{i=1}^n x_i$
> * **共轭先验 (Conjugate Prior)**：当先验和后验属于同一个分布族时，我们称该先验是似然函数的共轭先验。

---

### 2.3 例题三：正态均值推断 (Normal Mean)
**模型：Normal Prior + Normal Likelihood $\rightarrow$ Normal Posterior**

> [!warning] **重点作业**
> 老师课上强调：这是一个定理（Theorem 7.3.1/7.3.2），**要求大家自己推导证明**。以下是详细证明过程。

* **已知**：
    * 样本 $X_i \sim N(\theta, \sigma^2)$ （$\sigma^2$ 已知）。
    * 先验 $\theta \sim N(\mu_0, v_0)$ （均值 $\mu_0$，方差 $v_0$）。
* **目标**：证明后验分布 $\theta|\mathbf{x}$ 也是正态分布，并求出其参数。

#### **详细证明与配方过程**

1.  **写出核心部分 (Kernel)**：
    忽略常数项，只看包含 $\theta$ 的部分。
    * 先验部分：$\exp \left( -\frac{(\theta - \mu_0)^2}{2v_0} \right)$
    * 似然部分：$\exp \left( -\frac{\sum (x_i - \theta)^2}{2\sigma^2} \right)$

2.  **相乘并展开指数**：
    $$\text{Posterior} \propto \exp \left( -\frac{1}{2} \left[ \frac{(\theta - \mu_0)^2}{v_0} + \frac{\sum (x_i - \theta)^2}{\sigma^2} \right] \right)$$
    
    重点处理中括号里的二次项（关于 $\theta$ 的整理）：
    $$ 
    \begin{aligned}
    Q(\theta) &= \frac{\theta^2 - 2\theta\mu_0 + \mu_0^2}{v_0} + \frac{\sum (x_i^2 - 2x_i\theta + \theta^2)}{\sigma^2} \\
    &= \theta^2 \left( \frac{1}{v_0} + \frac{n}{\sigma^2} \right) - 2\theta \left( \frac{\mu_0}{v_0} + \frac{\sum x_i}{\sigma^2} \right) + C \quad (C\text{为不含}\theta\text{的常数})
    \end{aligned}
    $$
    注意：$\sum \theta^2 = n\theta^2$，且 $\sum x_i = n\bar{x}$。

3.  **配方 (Completing the Square)**：
    我们希望凑成 $a(\theta - b)^2$ 的形式，其中 $a$ 是精度的倒数，$b$ 是均值。
    令后验方差的倒数为 $\frac{1}{v_1} = \frac{1}{v_0} + \frac{n}{\sigma^2}$。
    
    则一次项系数为：
    $$2\theta \left( \frac{\mu_0}{v_0} + \frac{n\bar{x}}{\sigma^2} \right) = 2\theta \cdot \frac{1}{v_1} \cdot \mu_1$$
    由此解出后验均值 $\mu_1$：
    $$\frac{\mu_1}{v_1} = \frac{\mu_0}{v_0} + \frac{n\bar{x}}{\sigma^2} \implies \mu_1 = \frac{\frac{\mu_0}{v_0} + \frac{n\bar{x}}{\sigma^2}}{\frac{1}{v_0} + \frac{n}{\sigma^2}}$$

> [!success] **最终结论 (需背诵)**
> 后验分布 $\theta|\mathbf{x} \sim N(\mu_1, v_1)$，其中：
> 1.  **后验精度 (Precision) = 先验精度 + 数据精度**
>     $$\frac{1}{v_1} = \frac{1}{v_0} + \frac{n}{\sigma^2}$$
>     *(精度是方差的倒数。数据越多，方差越小，精度越高)*
> 2.  **后验均值 = 先验均值与样本均值的加权平均**
>     $$\mu_1 = \frac{\sigma^2 \mu_0 + n v_0 \bar{x}}{\sigma^2 + n v_0}$$
>     *(谁的方差小/精度高，谁的权重就大)*

---

## 3. 课程补充说明

* **数学基础回顾**：
    * **均匀分布方差**：对于 $U(a,b)$，方差为 $\frac{(b-a)^2}{12}$。
    * **Gamma函数**：$\Gamma(\alpha) = (\alpha-1)!$。
* **跳过内容**：
    * PPT中的第一个例题被跳过。
    * 章节 7.2.5 "Subjective Probability" 被明确跳过，不作要求。
* **下节课预告**：
    * 将从 7.3.1 的正态分布例子开始深入讲解。
    * 请务必复习上述三个例子的推导过程。