### <font color="teal">1.7.3 生日问题 (The Birthday Problem) </font>

- **问题**: 在一个 `k` 人的群体中，至少有两人生日相同的概率 `p` 是多少？（假设一年365天，忽略闰年等因素）
- **解题策略**: 计算其**补集**的概率，即“所有 `k` 个人的生日都不同”的概率，然后用 1 减去它。
    - **总可能结果数**: `365ᵏ` (每个人的生日都有365种可能，这是一个**有放回抽样**问题)。
    - **生日都不同的结果数**: `P₃₆₅,ₖ` (第一个人365选1，第二个人364选1...，这是一个**无放回抽样**问题)。
    - **概率公式**: `p = 1 - (P₃₆₅,ₖ / 365ᵏ)`
- **反直觉的结果 (Table 1.1)**:
    - 当 `k=23` 时，概率 `p` 就达到了 `0.507`，超过了50%。
    - 当 `k=50` 时，概率高达 `0.970`。
### <font color="#3498DB">1.7.4 斯特林公式 (Stirling's Formula)</font>
- **用途**: 当 `n` 很大时，直接计算 `n!` 非常困难。斯特林公式提供了一个非常好的近似值。
- **公式**: `n! ≈ (2π)¹ᐟ² nⁿ⁺¹ᐟ² e⁻ⁿ`


### <font color="#3498DB">1.8.1 组合 (Combinations)</font>
- **定义**: 从 `n` 个不同元素中选出 `k` 个元素组成的**子集**。元素的顺序不重要，例如，`{a, b}` 和 `{b, a}` 是同一个组合。
- **组合数 `Cₙ,ₖ` 或 `(ⁿₖ)`**:
    - **推导关系**: 一个排列可以分两步完成：1. 选出一个k元素的组合 (`Cₙ,ₖ`种方法)；2. 将这k个元素进行全排列 (`k!`种方法)。因此 `Pₙ,ₖ = Cₙ,ₖ × k!`。
    - **公式**: `Cₙ,ₖ = Pₙ,ₖ / k! = n! / [k!(n-k)!]`
- **例子**:
    - **选委员会 (Example 1.8.2)**: 从20人中选出8人组成委员会，顺序不重要。共有 `C₂₀,₈ = 125,970` 种方式。
    - **抛硬币 (Example 1.8.7)**: 抛10次硬币，恰好出现3次正面的序列数，等于在10个位置中选择3个位置放“正面”，共有 `C₁₀,₃ = 120` 种。其概率为 `120 / 2¹⁰ ≈ 0.1172`。
    - **抽样 (Example 1.8.8)**: 班级有15名男生和30名女生，随机选10人。恰好选到3名男生的概率为 `(C₁₅,₃ × C₃₀,₇) / C₄₅,₁₀ ≈ 0.2904`。

### <font color="#3498DB">1.8.2 二项式系数 (Binomial Coefficients)</font>
- **` (ⁿₖ) `** 是组合数的另一种常用记法，称为二项式系数。
- **二项式定理 (Theorem 1.8.2)**: `(x+y)ⁿ = Σₖ (ⁿₖ) xᵏ yⁿ⁻ᵏ` (k从0到n)。
- **重要性质**: `(ⁿₖ) = (ⁿₙ₋ₖ)` (从n个里面选k个，等价于从n个里面选出剩下的n-k个)

## <font color="teal">1.9 多项式系数 (Multinomial Coefficients)</font>


- **定义**: 将 `n` 个不同元素分成 `k` 组，每组分别有 `n₁, n₂, ..., nₖ` 个元素，其中 `Σᵢ nᵢ = n`。
- **多项式系数公式**: `(ⁿₙ₁,ₙ₂,...,ₙₖ) = n! / (n₁! n₂! ... nₖ!)`
- **应用**:
    - **委员会分配 (Example 1.9.1)**: 20人分成3个委员会，人数分别为8, 8, 4。总方法数为 `(²⁰₈,₈,₄) = 20! / (8! 8! 4!)`。
    - **多类型排列**: 排列 `n` 个物品，其中有 `n₁` 个A类物品，`n₂` 个B类物品... 方法数也是多项式系数。
    - **掷骰子 (Example 1.9.3)**: 掷12次骰子，每个点数（1-6）各出现2次的概率为 `(¹²₂,₂,₂,₂,₂,₂) / 6¹² ≈ 0.0034`。
    - **扑克牌分发 (Example 1.9.4)**: 52张牌发给4个玩家，每人13张。A得6张红心, B得4张, C得2张, D得1张的概率。
        - **解法**: 首先，13张红心按(6,4,2,1)分配给4人的方法数为 `(¹³₆,₄,₂,₁)`。然后，剩下39张非红心按(7,9,11,12)分配给4人（以凑满13张）的方法数为 `(³⁹₇,₉,₁₁,₁₂)`。总有利情况为两者相乘。总的分牌方法为 `(⁵²₁₃,₁₃,₁₃,₁₃)`。最终概率为 `M/N`。

# 📬 匹配问题 (The Matching Problem)

**匹配问题**，在组合数学中也被称为**错排问题 (Derangement Problem)** 或**蒙莫尔问题 (Montmort's Problem)**，是一个著名且反直觉的概率问题。

---

## 🎯 问题描述

> 将 $n$ 封写好的信随机地放入 $n$ 个写好对应地址的信封中，每个信封只放一封信。
>
> **问题：** 至少有一封信放对了信封的概率 $p_n$ 是多少？

---

## 🔍 求解策略：容斥原理

直接计算“至少一封”正确的情况（一封对、两封对、...）比较复杂。我们可以使用**容斥原理 (Principle of Inclusion-Exclusion)** 来精确求解。

1.  **定义事件：**
    *   设 $A_i$ 为事件 “第 $i$ 封信放入了正确的信封”。
    *   我们的目标是计算这些事件的并集概率：$P(A_1 \cup A_2 \cup \dots \cup A_n)$。

2.  **容斥原理公式：**
    $$
    P(\cup_{i=1}^{n} A_i) = \sum P(A_i) - \sum P(A_i \cap A_j) + \sum P(A_i \cap A_j \cap A_k) - \dots + (-1)^{n+1} P(\cap_{i=1}^{n} A_i)
    $$

我们将逐项计算这个公式中的每一部分。

---

## 🔢 详细推导

### 第一项: $\sum P(A_i)$

*   **单个事件的概率 $P(A_i)$:**
    *   第 $i$ 封信有 $n$ 个信封可以放，只有一个是正确的。
    *   因此，$P(A_i) = \frac{1}{n}$。
*   **求和:**
    *   总共有 $n$ 个这样的事件 ($A_1, A_2, \dots, A_n$)。
    *   由于对称性，每个事件的概率都是 $\frac{1}{n}$。
    *   $$ \sum_{i=1}^{n} P(A_i) = n \times \frac{1}{n} = \mathbf{1} $$

### 第二项: $\sum P(A_i \cap A_j)$

*   **两个事件交集的概率 $P(A_i \cap A_j)$:**
    *   这是第 $i$ 封信 **和** 第 $j$ 封信都放对的概率。
    *   第 $i$ 封信放对的概率是 $\frac{1}{n}$。
    *   在第 $i$ 封信已经放对的条件下，剩下 $n-1$ 封信和 $n-1$ 个信封。第 $j$ 封信放对的概率是 $\frac{1}{n-1}$。
    *   因此，$P(A_i \cap A_j) = \frac{1}{n} \times \frac{1}{n-1} = \frac{1}{n(n-1)}$。
*   **求和:**
    *   我们需要计算有多少对这样的事件。这等价于从 $n$ 个事件中选出 2 个，即 $\binom{n}{2}$ 对。
    *   $$ \sum_{i<j} P(A_i \cap A_j) = \binom{n}{2} \times \frac{1}{n(n-1)} = \frac{n(n-1)}{2!} \times \frac{1}{n(n-1)} = \mathbf{\frac{1}{2!}} $$

### 第三项: $\sum P(A_i \cap A_j \cap A_k)$

*   **三个事件交集的概率 $P(A_i \cap A_j \cap A_k)$:**
    *   $i, j, k$ 三封信都放对的概率为 $P(A_i \cap A_j \cap A_k) = \frac{1}{n(n-1)(n-2)}$。
*   **求和:**
    *   总共有 $\binom{n}{3}$ 个这样的组合。
    *   $$ \sum_{i<j<k} P(A_i \cap A_j \cap A_k) = \binom{n}{3} \times \frac{1}{n(n-1)(n-2)} = \frac{n(n-1)(n-2)}{3!} \times \frac{1}{n(n-1)(n-2)} = \mathbf{\frac{1}{3!}} $$

### 通用项

遵循这个规律，对于 $k$ 个事件的交集，其概率和为:
$$
\sum P(A_{i_1} \cap \dots \cap A_{i_k}) = \binom{n}{k} \times \frac{(n-k)!}{n!} = \frac{n!}{k!(n-k)!} \times \frac{(n-k)!}{n!} = \mathbf{\frac{1}{k!}}
$$

### 最终组合

将所有计算出的项代入容斥原理公式：

$$
p_n = P(\cup A_i) = 1 - \frac{1}{2!} + \frac{1}{3!} - \frac{1}{4!} + \dots + (-1)^{n+1} \frac{1}{n!}
$$

这就是**至少有一封信放对的概率**的精确公式。

---

## 📈 极限与结论

这个结果最令人惊讶的部分是当 $n$ 变得很大时它的极限行为。

### 1. 与自然常数 $e$ 的联系

我们知道 $e^x$ 的泰勒级数展开是：
$$
e^x = \sum_{k=0}^{\infty} \frac{x^k}{k!} = 1 + \frac{x}{1!} + \frac{x^2}{2!} + \frac{x^3}{3!} + \dots
$$
当 $x = -1$ 时：
$$
e^{-1} = \frac{1}{e} = 1 - \frac{1}{1!} + \frac{1}{2!} - \frac{1}{3!} + \dots = \frac{1}{2!} - \frac{1}{3!} + \frac{1}{4!} - \dots
$$
因此，$1 - \frac{1}{e}$ 等于：
$$
1 - \frac{1}{e} = 1 - (\frac{1}{2!} - \frac{1}{3!} + \frac{1}{4!} - \dots) = 1 - \frac{1}{2!} + \frac{1}{3!} - \frac{1}{4!} + \dots
$$
这正好是 $p_n$ 在 $n \to \infty$ 时的极限。

### 2. 惊人的结论

$$
\lim_{n \to \infty} p_n = 1 - \frac{1}{e} \approx 1 - 0.36788 \approx \mathbf{0.63212}
$$

*   **快速收敛:** 这个级数收敛得非常快。当 $n$ 仅为 7 时，其概率值已经和极限值在小数点后四位上一致。
    *   $p_4 = 1 - 1/2 + 1/6 - 1/24 = 0.625$
    *   $p_5 = p_4 + 1/120 = 0.6333...$
    *   $p_6 = p_5 - 1/720 = 0.6319...$
    *   $p_7 = p_6 + 1/5040 = 0.6321...$

*   **直觉的颠覆:** 这意味着，无论是 7 封信还是 700 万封信，至少有一封放对的概率几乎是恒定的，都约等于 **63.2%**。这与人们“信越多，至少放对一封的概率应该越接近100%”的直觉是相悖的。

---