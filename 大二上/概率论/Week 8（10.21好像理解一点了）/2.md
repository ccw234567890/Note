# 概率论与数理统计笔记：分位数与二维随机变量

> [!NOTE] 核心概念
> 本讲义主要涵盖两大核心内容：
> 1.  **分位数 (Quantiles)**：理解为什么百分位数 (Percentiles) 比原始分数更有意义，并掌握其严格定义和计算方法。
> 2.  **二维随机变量 (Bivariate Distributions)**：从一维扩展到二维，理解联合概率分布（包括离散型和连续型）的定义、性质和计算。

---

## Part 1：分位数 (Quantiles)

### 1.1 CDF 与 PDF 的关系

在讨论分位数之前，我们先回顾一下累积分布函数 (CDF) 和概率密度函数 (PDF) 的关系。

* **PMF (概率质量函数)**: 用于**离散型** (Discrete) 随机变量。
* **PDF (概率密度函数)**: 用于**连续型** (Continuous) 随机变量。
* **CDF (累积分布函数)**: $F(x) = P(X \le x)$，对离散和连续都适用。

对于连续型随机变量，其 PDF $f(x)$ 是 CDF $F(x)$ 的导数：
$$f(x) = \frac{d}{dx} F(x) = F'(x)$$
反之，CDF 是 PDF 从负无穷到 $x$ 的积分：
$$F(x) = \int_{-\infty}^{x} f(t) \,dt$$

> [!WARNING] PDF 在端点处的定义
> 对于一个分段定义的 CDF，其 PDF 在分界点（端点）上的取值其实并**不唯一**。
> 例如，如果 CDF 在 $x=c$ 处连续但不可导（一个尖点），PDF 在 $x=c$ 处未定义。但因为单个点的积分值为 0，所以 $f(c)$ 取任何值都不影响 CDF 的积分结果。在没有额外信息（如“函数连续”）的情况下，我们无法确定 PDF 在这些端点的值。

### 1.2 为什么需要分位数 (Quantiles / Percentiles)？

> [!TIP] 讲解：分位数的意义
> 假设你在一次考试中得了 18 分。这个分数本身有意义吗？
> * 如果考试很难，18 分可能是最高分。
> * 如果考试很简单，18 分可能是最低分。
> * 如果你的大学排名很高，18 分可能意味着你表现不佳。
> 
> **原始分数 (Raw Score)** 缺乏上下文，难以解释。相比之下，**百分位数 (Percentile)** 更有意义。
> 
> 比如，如果告诉你“你的分数超过了 70% 的学生”，这就是一个**排名**信息。它告诉你，无论考试难度如何，你都处于前 30% 的位置。分位数提供了一种与分布无关的标准化比较方式。

### 1.3 分位数的严格定义

我们通常想找一个 $x$，使得 $F(x) = p$，但 CDF 不一定是严格递增的（例如离散型变量，CDF 是阶梯函数）。

**定义 (Quantile):**
设 $X$ 是一个随机变量，其 CDF 为 $F_X(x)$。对于任意 $p \in (0, 1)$， $X$ 的 **$p$-分位数**（或第 $100p$ 百分位数），记为 $F^{-1}(p)$，定义为：
$$F^{-1}(p) = \min \{ x \mid F(x) \ge p \}$$
即，它是**满足 $F(x) \ge p$ 的最小的 $x$ 值**。

* ** quantile function (分位数函数)** 就是 $F^{-1}(p)$，其定义域为 $(0, 1)$。
* 如果 $F(x)$ 是**连续且严格递增**的，那么定义可以简化为：
    $$F(x) = p \implies x = F^{-1}(p)$$
    此时，我们直接解方程 $F(x) = p$ 即可。

---

### 1.4 分位数计算示例

#### 示例 1：均匀分布 (Uniform Distribution)

> [!EXAMPLE] 
> 假设 $X \sim U(a, b)$，其 CDF 为：
> $$F(x) = \begin{cases} 0 & x < a \\ \frac{x-a}{b-a} & a \le x \le b \\ 1 & x > b \end{cases}$$
> 求 $p$-分位数函数 $F^{-1}(p)$。
> 
> **推导：**
> 由于 $F(x)$ 在 $[a, b]$ 上连续且严格递增，我们直接解 $F(x) = p$ (其中 $p \in (0, 1)$)：
> 1.  设 $F(x) = p$
> 2.  $$\frac{x-a}{b-a} = p$$
> 3.  $$x - a = p(b-a)$$
> 4.  $$x = a + p(b-a)$$
> 
> **结论：** $p$-分位数函数为 $F^{-1}(p) = a + p(b-a)$。

#### 示例 2：标准正态分布 (Standard Normal Distribution)

> [!EXAMPLE]
> 假设 $X \sim N(0, 1)$，其 CDF 为 $\Phi(x)$。我们想找到一个值 $a$，使得 $P(-a \le X \le a) = 1 - \alpha$。
> 
> > [!NOTE] 
> > 这个问题在统计学中非常常见，例如构建 $100(1-\alpha)\%$ 的**置信区间**。
> 
> **推导：**
> 1.  利用 CDF 表示概率：
>     $$P(-a \le X \le a) = P(X \le a) - P(X \le -a) = \Phi(a) - \Phi(-a)$$
> 2.  利用标准正态分布的对称性： $\Phi(-a) = 1 - \Phi(a)$
> 3.  代入：
>     $$\Phi(a) - (1 - \Phi(a)) = 2\Phi(a) - 1$$
> 4.  令其等于 $1 - \alpha$：
>     $$2\Phi(a) - 1 = 1 - \alpha$$
> 5.  求解 $\Phi(a)$：
>     $$2\Phi(a) = 2 - \alpha \implies \Phi(a) = 1 - \frac{\alpha}{2}$$
> 6.  求解 $a$：
>     $$a = \Phi^{-1}\left(1 - \frac{\alpha}{2}\right)$$
> 
> **结论：** 这个值 $a$ 通常记为 $z_{\alpha/2}$。它表示这样一个点：其右侧尾部面积为 $\alpha/2$，左侧面积为 $1 - \alpha/2$。
> 
> > [!TIP]
> > $\Phi(x)$ 没有解析解，$\Phi^{-1}(p)$ 这样的值需要通过查表或使用软件（如 R, Python）来计算。

#### 示例 3：指数分布 (Exponential Distribution)

> [!EXAMPLE]
> 假设一个连续型随机变量 $X$ 的 CDF 为：
> $$F_X(x) = \begin{cases} 1 - e^{-3x} & x > 0 \\ 0 & x \le 0 \end{cases}$$
>
> **任务 1：求 PDF $f(x)$**
>
> $$f(x) = F'(x) = \frac{d}{dx} (1 - e^{-3x}) = -(-3)e^{-3x} = 3e^{-3x} \quad (\text{for } x > 0)$$
> 所以 $f(x) = \begin{cases} 3e^{-3x} & x > 0 \\ 0 & \text{otherwise} \end{cases}$ (这是 $\lambda=3$ 的指数分布)。
>
> **任务 2：求 $P(1 \le X \le 2)$**
>
> $$P(1 \le X \le 2) = F(2) - F(1) = (1 - e^{-3(2)}) - (1 - e^{-3(1)}) = (1 - e^{-6}) - (1 - e^{-3}) = e^{-3} - e^{-6}$$
> (当然，也可以通过 $\int_1^2 3e^{-3x} \,dx$ 计算，结果相同)。
>
> **任务 3：求 $p$-分位数函数 $F^{-1}(p)$**
>
> 1.  设 $F(x) = p$ (对于 $x>0, p \in (0, 1)$):
> 2.  $$1 - e^{-3x} = p$$
> 3.  $$e^{-3x} = 1 - p$$
> 4.  两边取自然对数：
>     $$-3x = \ln(1-p)$$
> 5.  $$x = -\frac{1}{3} \ln(1-p)$$
>
> **结论：** $F^{-1}(p) = -\frac{1}{3} \ln(1-p)$。

#### 示例 4：利用 CDF 属性求解参数

> [!EXAMPLE] 
> 假设一个随机变量 $X$ 的 CDF 为：
> $$F(x) = \begin{cases} 0 & x < -1 \\ 1/2 & -1 \le x < 0 \\ a+b & 0 \le x < 1 \\ 1 & x \ge 1 \end{cases}$$
> (注：讲座中提到了一个更复杂的带 $e^x$ 的例子，但核心思想一致)。
>
> 求解 $a, b$ 必须满足的条件。
>
> **推导：**
> 我们利用 CDF 的两个基本性质：
> 1.  **右连续** (Right-continuous): (本例已满足)
> 2.  **非递减 (Non-decreasing)**: $x_1 < x_2 \implies F(x_1) \le F(x_2)$
>
> 应用非递减性质：
> * 在 $x=0$ 处： $F(0) \ge F(0^-)$ (即 $x=0$ 处的值必须大于等于 $x \to 0$ 的左极限值)
> * $F(0) = a+b$
> * $F(0^-) = \lim_{x \to 0^-} F(x) = 1/2$
> * 因此，必须满足： $a+b \ge 1/2$
>
> * 在 $x=1$ 处： $F(1) \ge F(1^-)$
> * $F(1) = 1$
> * $F(1^-) = \lim_{x \to 1^-} F(x) = a+b$
> * 因此，必须满足： $1 \ge a+b$
>
> **结论：** 参数 $a, b$ 必须满足 $1/2 \le a+b \le 1$。
>
> > [!WARNING] 不要假设连续性！
> > 讲座中特别强调，**CDF 不一定是连续的**。离散型变量的 CDF 就是阶梯状的。
> > 如果我们 *额外假设* CDF 是连续的，那么在 $x=0$ 处必须有 $F(0) = F(0^-)$，即 $a+b = 1/2$。
> > 但题目没有这个条件，所以我们只能得出 $a+b \ge 1/2$。

---

## Part 2：二维随机变量 (Bivariate Distributions)

### 2.1 引入：从一维到二维

> [!NOTE] 
> 现实世界中的问题很少只涉及一个变量。我们通常关心多个变量之间的关系，例如：
> * X =  身高, Y =  体重
> * X =  60岁以上人数, Y =  居住在20英里外的人数
>
> 我们需要研究 $(X, Y)$ 这对变量的**联合分布 (Joint Distribution)**。

### 2.2 二维离散型 (Bivariate Discrete)

**定义 (Joint PMF):**
如果 $(X, Y)$ 是一对离散型随机变量，其**联合概率质量函数 (Joint PMF)** 定义为：
$$f(x, y) = P(X=x, Y=y)$$

**性质：**
1.  $f(x, y) \ge 0$
2.  $\sum_{x} \sum_{y} f(x, y) = 1$ (所有可能情况的概率之和为 1)

**计算概率：**
对于任意集合 $C$，
$$P((X, Y) \in C) = \sum_{(x,y) \in C} f(x, y)$$

> [!EXAMPLE] 示例 5：联合 PMF 表格 (Cars & TVs)
> 假设 $X=$ 拥有汽车数量, $Y=$ 拥有电视数量。其联合 PMF 如下表：
> 
> | $f(x, y)$ | Y=1 | Y=2 | Y=3 | $P(X=x)$ |
> | :--- | :---: | :---: | :---: | :---: |
> | **X=1** | 0.1 | 0.2 | 0.1 | 0.4 |
> | **X=2** | 0.1 | 0.1 | 0.2 | 0.4 |
> | **X=3** | 0.0 | 0.1 | 0.1 | 0.2 |
> | **$P(Y=y)$** | 0.2 | 0.4 | 0.4 | **1.0** |
> 
> **计算 1：$P(X \ge 2, Y \ge 2)$**
> 我们需要对所有满足 $x \ge 2$ 且 $y \ge 2$ 的单元格求和：
> $$P = f(2, 2) + f(2, 3) + f(3, 2) + f(3, 3) = 0.1 + 0.2 + 0.1 + 0.1 = 0.5$$
>
> **计算 2：$P(X = 1)$ (边际概率, Marginal Probability)**
> 我们需要对 $X=1$ 所在的 *整行* 求和：
> $$P(X=1) = f(1, 1) + f(1, 2) + f(1, 3) = 0.1 + 0.2 + 0.1 = 0.4$$
> (这被称为 $X$ 的**边际 PMF**)。
> 
> **计算 3：求解参数 C**
> 如果 PMF 表格中是 $C \cdot g(x,y)$，我们只需将表格中所有项 $g(x,y)$ 相加，然后令 $C \cdot \sum \sum g(x,y) = 1$ 即可解出 $C$。

### 2.3 二维连续型 (Bivariate Continuous)

**定义 (Joint PDF):**
$(X, Y)$ 被称为联合连续型随机变量，如果存在一个非负函数 $f(x, y)$，称为**联合概率密度函数 (Joint PDF)**，使得对于 $xy$-平面上的任意区域 $C$：
$$P((X, Y) \in C) = \iint_C f(x, y) \,dA$$

**性质：**
1.  $f(x, y) \ge 0$
2.  $\iint_{\mathbb{R}^2} f(x, y) \,dA = \int_{-\infty}^{\infty} \int_{-\infty}^{\infty} f(x, y) \,dx \,dy = 1$ (总概率体积为 1)

> [!WARNING] 常见误解
> $X$ 是连续的， $Y$ 也是连续的，并**不**意味着 $(X, Y)$ 一定是联合连续的。

---

### 2.4 二维连续型计算示例

#### 示例 7：求解联合 PDF 中的参数 C (二重积分)

> [!EXAMPLE]
> 假设 $(X, Y)$ 的联合 PDF 为：
> $$f(x, y) = \begin{cases} C(x^2 + y) & \text{if } x^2 \le y \le 1 \\ 0 & \text{otherwise} \end{cases}$$
> 求常数 $C$ 的值。
> 
> **推导：**
> 1.  **分析区域：** 支撑域 $R$ 是由抛物线 $y=x^2$ (下方) 和 $y=1$ (上方) 围成的区域。当 $y=1$ 时，$x^2=1 \implies x = \pm 1$。
> 2.  **设置积分：** PDF 在整个 $R$ 上的积分必须为 1。
>     $$\iint_R f(x, y) \,dA = 1$$
>     我们使用 $dy\,dx$ 的积分次序：$x$ 从 -1 到 1，$y$ 从 $x^2$ 到 1。
>     $$\int_{-1}^{1} \left[ \int_{x^2}^{1} C(x^2 + y) \,dy \right] \,dx = 1$$
> 3.  **计算内层积分 (对 $y$)：**
>     $$\int_{x^2}^{1} (x^2 + y) \,dy = \left[ x^2y + \frac{y^2}{2} \right]_{y=x^2}^{y=1}$$
>     $$= \left( x^2(1) + \frac{1^2}{2} \right) - \left( x^2(x^2) + \frac{(x^2)^2}{2} \right)$$
>     $$= \left( x^2 + \frac{1}{2} \right) - \left( x^4 + \frac{x^4}{2} \right) = \frac{1}{2} + x^2 - \frac{3}{2}x^4$$
> 4.  **计算外层积分 (对 $x$)：**
>     $$C \int_{-1}^{1} \left( \frac{1}{2} + x^2 - \frac{3}{2}x^4 \right) \,dx$$
>     (由于被积函数是偶函数，积分区间对称，可以简化为 $2 \times$ 从 0 到 1 的积分)
>     $$= 2C \int_0^1 \left( \frac{1}{2} + x^2 - \frac{3}{2}x^4 \right) \,dx = 2C \left[ \frac{1}{2}x + \frac{x^3}{3} - \frac{3}{2}\frac{x^5}{5} \right]_0^1$$
>     $$= 2C \left[ \left( \frac{1}{2} + \frac{1}{3} - \frac{3}{10} \right) - 0 \right] = 2C \left( \frac{15 + 10 - 9}{30} \right) = 2C \left( \frac{16}{30} \right) = C \left( \frac{16}{15} \right)$$
> 5.  **求解 C：**
>     $$C \left( \frac{16}{15} \right) = 1 \implies C = \frac{15}{16}$$

#### 示例 8：利用联合 PDF 计算概率

> [!EXAMPLE]
> 使用上例中的 PDF ($C=15/16$)，计算 $P(X > Y)$。
>
> **推导：**
> 1.  **分析区域：** 我们需要在 PDF 的原始支撑域 $R$ ( $x^2 \le y \le 1$ ) 和我们关心的事件区域 $C$ ( $x > y$ 或 $y < x$ ) 的**交集**上进行积分。
> 2.  **画图：**
>     * 区域 $R$ 是 $y=x^2$ 和 $y=1$ 之间的 "帽子" 形状。
>     * 区域 $C$ 是 $y=x$ 这条直线 *下方* 的区域。
>     * 我们需要找到 $R$ 和 $C$ 的交集。$y=x$ 和 $y=x^2$ 相交于 $x=0, 1$。
>     * 新的积分区域 $R \cap C$ 是：$x$ 从 0 到 1；$y$ 从 $x^2$ (下界) 到 $x$ (上界)。
> 3.  **设置积分：**
>     $$P(X > Y) = \iint_{R \cap C} f(x, y) \,dA = \int_0^1 \left[ \int_{x^2}^x \frac{15}{16}(x^2 + y) \,dy \right] \,dx$$
> 4.  **计算内层积分 (对 $y$)：**
>     $$\frac{15}{16} \int_{x^2}^x (x^2 + y) \,dy = \frac{15}{16} \left[ x^2y + \frac{y^2}{2} \right]_{y=x^2}^{y=x}$$
>     $$= \frac{15}{16} \left[ \left( x^2(x) + \frac{x^2}{2} \right) - \left( x^2(x^2) + \frac{(x^2)^2}{2} \right) \right]$$
>     $$= \frac{15}{16} \left( x^3 + \frac{x^2}{2} - x^4 - \frac{x^4}{2} \right) = \frac{15}{16} \left( \frac{x^2}{2} + x^3 - \frac{3x^4}{2} \right)$$
> 5.  **计算外层积分 (对 $x$)：**
>     $$\frac{15}{16} \int_0^1 \left( \frac{x^2}{2} + x^3 - \frac{3x^4}{2} \right) \,dx = \frac{15}{16} \left[ \frac{x^3}{6} + \frac{x^4}{4} - \frac{3x^5}{10} \right]_0^1$$
>     $$= \frac{15}{16} \left( \frac{1}{6} + \frac{1}{4} - \frac{3}{10} \right) = \frac{15}{16} \left( \frac{10 + 15 - 18}{60} \right) = \frac{15}{16} \left( \frac{7}{60} \right)$$
> 6.  **化简：**
>     $$\frac{15}{16} \cdot \frac{7}{60} = \frac{1}{16} \cdot \frac{7}{4} = \frac{7}{64}$$

#### 示例 9：圆上的均匀分布 (Uniform on a Circle)

> [!EXAMPLE]
> 假设 $(X, Y)$ 在半径为 3 的圆（ $x^2 + y^2 \le 9$ ）内**均匀随机**选取。求其联合 PDF $f(x, y)$。
>
> **推导：**
> 1.  **“均匀” (Uniformly)** 意味着 PDF 在该区域内是一个常数 $C$。
>     $$f(x, y) = \begin{cases} C & \text{if } x^2+y^2 \le 9 \\ 0 & \text{otherwise} \end{cases}$$
> 2.  总概率（体积）必须为 1：
>     $$\iint_{x^2+y^2 \le 9} C \,dA = 1$$
> 3.  当被积函数为常数 $C$ 时，积分等于 $C \times \text{区域面积}$。
> 4.  圆的面积 $A = \pi r^2 = \pi (3^2) = 9\pi$。
> 5.  $$C \cdot (9\pi) = 1 \implies C = \frac{1}{9\pi}$$
>
> **结论：**
> $$f(x, y) = \begin{cases} \frac{1}{9\pi} & \text{if } x^2+y^2 \le 9 \\ 0 & \text{otherwise} \end{cases}$$