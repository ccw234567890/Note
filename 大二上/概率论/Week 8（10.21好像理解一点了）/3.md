# 概率论笔记：二维随机变量 (续)

> [!NOTE] 本讲核心
> 1.  **混合型分布 (Mixed Distributions)**：学习当一个变量是离散型，另一个是连续型时如何处理。
> 2.  **联合累积分布函数 (Joint CDF)**：掌握联合 CDF $F(x,y)$ 的定义，以及它与联合 PDF $f(x,y)$ 之间的相互转换（求偏导 vs. 求二重积分）。
> 3.  **边际分布 (Marginal Distributions)**：学习如何从一个联合分布 (Joint) 中“提取”出单个变量 (X 或 Y) 的分布。
> 4.  **条件分布 (Conditional Distributions)**：学习在“已知 $Y=y$ 的条件下，X 的分布是什么”。这是本讲的重点，特别是连续型条件分布的推导。

---

## 1. 联合分布 (Bivariate Distributions) 回顾

我们已经讨论了两种主要的二维随机变量：

1.  **<font color="#8E44AD">联合离散型 (Joint Discrete)</font>**
    * $X$ 和 $Y$ 都是离散的。
    * 由**联合概率质量函数 (Joint PMF)** $f(x,y) = P(X=x, Y=y)$ 描述。
    * 性质：$\sum_x \sum_y f(x,y) = 1$。

2.  **<font color="#2E86C1">联合连续型 (Joint Continuous)</font>**
    * 由**联合概率密度函数 (Joint PDF)** $f(x,y)$ 描述。
    * 性质：$\iint_{\mathbb{R}^2} f(x,y) \,dA = 1$。
    * 概率通过二重积分计算：$P((X,Y) \in C) = \iint_C f(x,y) \,dA$。

> [!WARNING] 连续型的微妙之处
> $X$ 是连续的, $Y$ 也是连续的, **并不能** 保证 $(X,Y)$ 一定是联合连续的。
> 但反过来, 如果 $(X,Y)$ 是联合离散的, 那么 $X$ 和 $Y$ **一定** 分别是离散的。

### <font color="#D35400">复杂性：二维正态分布</font>
一维正态分布 $N(\mu, \sigma^2)$ 的 PDF 形式是 $f(x) = \frac{1}{\sqrt{2\pi}\sigma} e^{-\frac{(x-\mu)^2}{2\sigma^2}}$。

你可能以为二维正态分布就是把两个一维的 PDF 简单乘起来，但实际上它**复杂得多**。它引入了一个新的参数 $\rho$ (相关系数)，描述 $X$ 和 $Y$ 之间的关系。
$$f(x,y) = \frac{1}{2\pi\sigma_X\sigma_Y\sqrt{1-\rho^2}} \exp\left(-\frac{1}{2(1-\rho^2)}\left[ \frac{(x-\mu_X)^2}{\sigma_X^2} - \frac{2\rho(x-\mu_X)(y-\mu_Y)}{\sigma_X\sigma_Y} + \frac{(y-\mu_Y)^2}{\sigma_Y^2} \right]\right)$$
> [!TIP] 你不需要记住这个公式。你只需要知道二维分布通常比一维分布的简单组合要复杂。

---

## 2. 混合型双变量分布 (Mixed Bivariate)

> [!NOTE] 概念
> 当 $X$ 是**离散型** (例如，取值 {1, 2, 3})，而 $Y$ 是**连续型** (例如，取值 $y \in [0, 1]$) 时，我们称 $(X,Y)$ 为混合型分布。

我们使用一个**联合 PMF-PDF** 函数 $f(x,y)$ 来描述它。

**<font color="#1E8449">如何计算概率？</font>**
我们遵循一个简单的原则：**离散的求和 (Summation)，连续的积分 (Integration)**。

$$P(X \in A, Y \in B) = \sum_{x \in A} \left( \int_{B} f(x,y) \,dy \right)$$


> [!EXAMPLE] 示例：混合型概率计算
> 假设 $X$ 是离散的，取值 $x \in \{1, 2, 3\}$， $Y$ 是连续的，取值 $y \in [0, 1]$。
> 它们的联合 PMF-PDF 为 $f(x,y) = C \cdot xy$。
>
> 我们想计算 $P(X \ge 2, Y \ge 1/2)$。
>
> 1.  **离散部分 (X)：** $X \ge 2$ 意味着 $x$ 可以取 $\{2, 3\}$。我们对这些值求和。
> 2.  **连续部分 (Y)：** $Y \ge 1/2$ 意味着 $y$ 在 $[1/2, 1]$ 范围内。我们对这个区间积分。
>
> **计算过程：**
> $$P(X \ge 2, Y \ge 1/2) = \sum_{x \in \{2, 3\}} \int_{1/2}^{1} f(x,y) \,dy$$
>
> $$= \int_{1/2}^{1} f(2,y) \,dy + \int_{1/2}^{1} f(3,y) \,dy$$
>
> $$= \int_{1/2}^{1} C \cdot 2y \,dy + \int_{1/2}^{1} C \cdot 3y \,dy$$
>
> > [!TIP]
> > 这种混合型分布在计算上通常比“联合连续型”更简单，因为它只涉及**单重积分**，而不是二重积分。

---

## 3. 联合累积分布函数 (Joint CDF)

> [!NOTE] 定义
> 对于**任意**两个随机变量 $X$ 和 $Y$ (无论离散、连续还是混合)，它们的**联合 CDF** $F(x,y)$ 始终被定义为：
> $$F(x,y) = P(X \le x, Y \le y)$$
>

联合 CDF $F(x,y)$ 是一个更通用的工具。现在我们来看它和 PMF/PDF 之间的关系。

### <font color="#1E8449">关系 1：从 Joint CDF 得到 Joint PDF</font>

对于一维变量，我们知道 $f(x) = F'(x)$。
对于二维连续变量，我们使用**偏导数**：

$$f(x,y) = \frac{\partial^2 F(x,y)}{\partial x \partial y}$$


> [!EXAMPLE] 示例：从 CDF 求 PDF
> 假设 $(X,Y)$ 的联合 CDF 在 $0 \le x \le 2, 0 \le y \le 2$ 区域内为：
> $$F(x,y) = \frac{1}{128} xy (x^2 + y^2) = \frac{1}{128} (x^3y + xy^3)$$
>
> 求其联合 PDF $f(x,y)$。
>
> 1.  **对 x 求偏导：**
>     $$\frac{\partial F}{\partial x} = \frac{1}{128} (3x^2y + y^3)$$
> 2.  **再对 y 求偏导：**
>     $$f(x,y) = \frac{\partial}{\partial y} \left( \frac{\partial F}{\partial x} \right) = \frac{\partial}{\partial y} \left( \frac{1}{128} (3x^2y + y^3) \right)$$
>     $$f(x,y) = \frac{1}{128} (3x^2 + 3y^2) = \frac{3}{128} (x^2 + y^2)$$
>     (在 $0 \le x \le 2, 0 \le y \le 2$ 区域内，其他地方为 0)
>
> > [!WARNING] 端点问题
> > 就像一维情况一样，PDF $f(x,y)$ 在支撑域的**边界线上**的值是无法唯一确定的 (除非有额外信息)。我们通常只关心其在区域内部的定义，并将边界和其他地方设为 0。

### <font color="#1E8449">关系 2：从 Joint PDF 得到 Joint CDF</font>

对于一维变量，我们知道 $F(x) = \int_{-\infty}^x f(t) \,dt$。
对于二维连续变量，我们使用**二重积分**：

$$F(x,y) = \int_{-\infty}^{y} \int_{-\infty}^{x} f(s,t) \,ds \,dt$$


这是一个非常繁琐 (tedious) 的过程，因为 PDF $f(s,t)$ 通常是分段的 (在一个区域内有值，在区域外为 0)。这意味着 $F(x,y)$ 的表达式会根据 $(x,y)$ 点所在的位置而变化，导致 $F(x,y)$ 成为一个复杂的**分段函数**。

> [!EXAMPLE] 示例：从 PDF 求 CDF (均匀分布)
> 假设 $(X,Y)$ 在一个矩形区域 $R: [a, b] \times [c, d]$ 上服从均匀分布。
>
> 1.  **求 PDF $f(x,y)$：**
>     区域面积 $A = (b - a) \times (d - c)$。
>     $f(x,y) = 1/A$ (在 R 内), $0$ (在 R 外)。
>
> 2.  **求 CDF $F(x,y)$：**
>     我们需要根据 $(x,y)$ 的位置划分整个 $xy$ 平面。
>
>     * **Case 1：左下方区域**
>         如果 $x < a$ 或 $y < c$，积分区域与 R 没有交集。
>         $F(x,y) = 0$
>
>     * **Case 2：中间区域 (最重要)**
>         如果 $a \le x \le b$ 且 $c \le y \le d$，积分区域是 $R$ 的一个子矩形。
>         $$F(x,y) = \int_{c}^{y} \int_{a}^{x} \frac{1}{A} \,ds \,dt = \frac{1}{A} \cdot (x-a) \cdot (y-c)$$
>
>     * **Case 3：右上方区域**
>         如果 $x > b$ 且 $y > d$，积分区域完整地包含了 R。
>         $F(x,y) = 1$
>
>     * **Case 4：正右方区域**
>         如果 $x > b$ 且 $c \le y \le d$。
>         $$F(x,y) = \int_{c}^{y} \int_{a}^{b} \frac{1}{A} \,ds \,dt = \frac{1}{A} \cdot (b-a) \cdot (y-c)$$
>
>     * **Case 5：正上方区域**
>         如果 $a \le x \le b$ 且 $y > d$。
>         $$F(x,y) = \int_{c}^{d} \int_{a}^{x} \frac{1}{A} \,ds \,dt = \frac{1}{A} \cdot (x-a) \cdot (d-c)$$
>
> 最终 $F(x,y)$ 是一个包含 5 个 (或更多) 部分的分段函数。

---

## 4. 边际分布 (Marginal Distributions)

> [!NOTE] 概念
> "边际" (Marginal) 的意思是：我们有了 $(X,Y)$ 的**联合**分布，但我们现在只关心 $X$ **单独**的分布 (或 $Y$ **单独**的分布)，这叫什么？
> 
> 答案是：**边际分布 (Marginal Distribution)**。

一旦联合分布给定，$X$ 和 $Y$ 各自的边际分布就被**唯一确定**了。

### <font color="#1E8449">方法 1：从 Joint CDF 求 Marginal CDF</font>

这是最通用的方法。如果我们想求 $X$ 的边际 CDF $F_X(x) = P(X \le x)$，我们只需要在联合 CDF $F(x,y)$ 中，让 $y$ 覆盖所有可能的值，即 $y \to \infty$。

**公式：**
$$F_X(x) = P(X \le x, Y \le \infty) = \lim_{y \to \infty} F(x,y)$$

$$F_Y(y) = P(X \le \infty, Y \le y) = \lim_{x \to \infty} F(x,y)$$


> [!EXAMPLE] 示例：从 均匀分布 CDF 求 边际 CDF
> 使用上一个例子 (Case 5)，当 $a \le x \le b$ 时，我们想求 $F_X(x)$：
> $$F_X(x) = \lim_{y \to \infty} F(x,y)$$
> 当 $y \to \infty$ 时，$(x,y)$ 点位于“正上方区域”(Case 5)，此时 $F(x,y) = \frac{1}{A}(x-a)(d-c) = \frac{1}{(b-a)(d-c)}(x-a)(d-c) = \frac{x-a}{b-a}$。
>
> **结论：** $X$ 的边际 CDF 是 $F_X(x) = \frac{x-a}{b-a}$ (对于 $a \le x \le b$)。
> (这正是一个 $U(a, b)$ 分布的 CDF)。

一旦有了边际 CDF $F_X(x)$，我们就可以通过**求导**得到边际 PDF $f_X(x)$：
$f_X(x) = F_X'(x) = \frac{d}{dx} \left( \frac{x-a}{b-a} \right) = \frac{1}{b-a}$。

### <font color="#1E8449">方法 2：从 Joint PMF/PDF 直接求 Marginal PMF/PDF</font>

这是一个更直接的“快捷方式”。

#### **<font color="#8E44AD">情况 A：离散型 (PMF)</font>**
我们想求 $f_X(x) = P(X=x)$。我们可以把 $Y$ 的所有可能性相加。
$$f_X(x) = \sum_{y} P(X=x, Y=y) = \sum_y f(x,y)$$

$$f_Y(y) = \sum_{x} P(X=x, Y=y) = \sum_x f(x,y)$$


> [!TIP] 为什么叫“边际” (Marginal)？
> 当联合 PMF 用表格表示时， $f_X(x)$ (例如 $P(X=1)$) 就是把 $X=1$ 对应的**一整行**加起来，写在表格的**边缘 (Margin)** 处。 $f_Y(y)$ 就是把一整列加起来，写在表格的下边缘。

#### **<font color="#2E86C1">情况 B：连续型 (PDF)</font>**
我们把离散的“求和” $\sum$ 替换为连续的“积分” $\int$。
为了得到 $f_X(x)$，我们把 $f(x,y)$ 中我们不关心的 $y$ 变量**积分积掉 (Integrate out)**。

$$f_X(x) = \int_{-\infty}^{\infty} f(x,y) \,dy$$

$$f_Y(y) = \int_{-\infty}^{\infty} f(x,y) \,dx$$


> [!EXAMPLE] 示例：从 联合 PDF 求 边际 PDF
> 假设 $f(x,y) = C(x^2+y)$ (在 $x^2 \le y \le 1, -1 \le x \le 1$ 上)。
>
> 1.  **求 $f_X(x)$** ( $x$ 固定，积分 $y$)
>     $y$ 的范围是 $[x^2, 1]$。
>     $$f_X(x) = \int_{x^2}^{1} C(x^2+y) \,dy = C \left[ x^2y + \frac{y^2}{2} \right]_{y=x^2}^{y=1}$$
>     $$= C \left( (x^2 + \frac{1}{2}) - (x^4 + \frac{x^4}{2}) \right) = C \left( \frac{1}{2} + x^2 - \frac{3}{2}x^4 \right)$$
>
> 2.  **求 $f_Y(y)$** ( $y$ 固定，积分 $x$)
>     $y=x^2 \implies x = \pm \sqrt{y}$。 $x$ 的范围是 $[-\sqrt{y}, \sqrt{y}]$。
>     $$f_Y(y) = \int_{-\sqrt{y}}^{\sqrt{y}} C(x^2+y) \,dx = C \left[ \frac{x^3}{3} + yx \right]_{x=-\sqrt{y}}^{x=\sqrt{y}}$$
>     $$= C \left( (\frac{y^{3/2}}{3} + y^{3/2}) - (-\frac{y^{3/2}}{3} - y^{3/2}) \right) = C \left( 2 \cdot \frac{4}{3}y^{3/2} \right) = \frac{8C}{3}y^{3/2}$$

#### **<font color="#D35400">情况 C：混合型</font>**
我们还是遵循“离散求和，连续积分”的原则。

> [!EXAMPLE] 示例：从 混合 PMF-PDF 求 边际
> 假设 $f(x,y) = \frac{xy}{3}$，其中 $X$ 是离散的 $x \in \{1, 2, 3\}$，$Y$ 是连续的 $y \in [0, 1]$。
>
> 1.  **求 $f_X(x)$ (X 的边际 PMF)**
>     $X$ 是离散的，我们把 $Y$ (连续) 积分积掉。
>     $$f_X(x) = \int_{0}^{1} f(x,y) \,dy = \int_{0}^{1} \frac{xy}{3} \,dy = \frac{x}{3} \left[ \frac{y^2}{2} \right]_0^1 = \frac{x}{6}$$
>     所以 $P(X=1)=1/6, P(X=2)=2/6, P(X=3)=3/6$。 (总和为 $6/6=1$，合理)。
>
> 2.  **求 $f_Y(y)$ (Y 的边际 PDF)**
>     $Y$ 是连续的，我们把 $X$ (离散) 求和加总。
>     $$f_Y(y) = \sum_{x \in \{1,2,3\}} f(x,y) = f(1,y) + f(2,y) + f(3,y)$$
>     $$= \frac{1y}{3} + \frac{2y}{3} + \frac{3y}{3} = \frac{6y}{3} = 2y$$
>     所以 $Y$ 的边际 PDF 是 $f_Y(y) = 2y$ (在 $y \in [0,1]$ 上)。

---

## 5. 条件分布 (Conditional Distributions)

> [!NOTE] 概念
> 这是最有用的概念之一。它回答了这样一个问题：“如果我们**观测**到了 $Y$ 的值 (例如 $Y=y$)，那么 $X$ 的分布会发生什么变化？”
>
> * 例如：已知一个人的身高 $Y = 1.6$ 米，他的体重 $X$ 的分布是什么？
> * 例如：已知一个学生的数学成绩 $Y$，他的英语成绩 $X$ 的分布是什么？
>
> 我们要找的是 **$X$ 在给定 $Y=y$ 下的条件分布** $f(x|y)$。

### <font color="#8E44AD">情况 A：离散型 (Conditional PMF)</font>

这非常简单，它就是我们在基础概率中学过的**条件概率公式**。
$$P(A|B) = \frac{P(A \cap B)}{P(B)}$$


我们把 $A$ 替换为 $\{X=x\}$，把 $B$ 替换为 $\{Y=y\}$。

**条件 PMF 公式：**
$$g_1(x|y) = P(X=x | Y=y) = \frac{P(X=x, Y=y)}{P(Y=y)}$$

$$g_1(x|y) = \frac{f(x,y)}{f_Y(y)}$$


> [!EXAMPLE] 示例：汽车被盗 (离散)
> 假设 $X$ 是汽车品牌 ($x=1,2,3...$)，$Y$ 是是否被盗 ($y=0$ 未被盗, $y=1$ 被盗)。
> 我们有联合 PMF $f(x,y)$。保险公司想知道 $P(Y=1 | X=3)$，即“如果品牌是 3，被盗的概率是多少？”
>
> 1.  **联合概率 (分子)：** $P(X=3, Y=1) = f(3, 1)$
> 2.  **边际概率 (分母)：** $P(X=3) = f_X(3) = \sum_y f(3,y) = f(3,0) + f(3,1)$
> 3.  **条件概率：**
>     $$P(Y=1 | X=3) = \frac{f(3, 1)}{f(3,0) + f(3,1)}$$
>
> 另一个例子：求 $g_2(y | x=2)$ (给定 $x=2$，y 的条件分布)
> $$g_2(y|x=2) = \frac{f(2,y)}{f_X(2)}$$
> 我们首先计算边际 $f_X(2) = \sum_y f(2,y)$ (即把 x=2 这一行全部加起来)，然后用 $x=2$ 这一行的每一个 $f(2,y)$ 去除以这个总和。

### <font color="#2E86C1">情况 B：连续型 (Conditional PDF)</font>

我们想直接套用离散型的公式： $g_1(x|y) = \frac{f(x,y)}{f_Y(y)}$。

> [!WARNING] 理论困境：除以零
> 这里有一个严重的问题：$Y$ 是一个连续变量。
> 对于任何连续变量， $P(Y=y) = 0$。
> 这意味着边际 PDF $f_Y(y)$ 不是概率，而 $P(Y=y)$ 是 0。
> 我们不能在条件概率的定义中除以 0。

**<font color="#D35400">推导 (The Derivation)</font>**
我们必须使用**极限**来定义连续条件概率。我们不以 $Y=y$ 为条件，而是以一个很小的区间 $y \in [c, d]$ (或 $y \in [y, y+\epsilon]$) 为条件，然后让这个区间的长度趋近于 0。

> [!ABSTRACT] 连续条件 PDF 的严格推导
> 1.  **目标：** 我们想求条件 CDF $G_1(x|y) = P(X \le x | Y=y)$。
> 2.  **近似：** 我们转而计算 $P(X \le x | c \le Y \le d)$，其中 $c \approx y, d \approx y$。
>     $$P(X \le x | c \le Y \le d) = \frac{P(X \le x, c \le Y \le d)}{P(c \le Y \le d)}$$
>    
> 3.  **用 PDF 表示分子和分母：**
>     * 分子 = $\int_{-\infty}^{x} \int_{c}^{d} f(s,t) \,dt \,ds$
>     * 分母 = $\int_{c}^{d} f_Y(t) \,dt$
> 4.  **取极限：** 我们让 $c \to y$ 且 $d \to y$。 (为方便，设 $c=y$, $d=y+\epsilon$, $\epsilon \to 0$)。
>     $$G_1(x|y) = \lim_{\epsilon \to 0} \frac{\int_{-\infty}^{x} \int_{y}^{y+\epsilon} f(s,t) \,dt \,ds}{\int_{y}^{y+\epsilon} f_Y(t) \,dt}$$
> 5.  **0/0 型：** 当 $\epsilon \to 0$ 时，分子和分母都趋近于 0。
> 6.  **应用洛必达法则 (L'Hôpital's Rule)**：我们对分子和分母同时求关于 $\epsilon$ 的导数 (根据微积分基本定理)。
>     * $\frac{d}{d\epsilon} (\text{分母}) = \frac{d}{d\epsilon} \int_{y}^{y+\epsilon} f_Y(t) \,dt = f_Y(y+\epsilon)$
>     * $\frac{d}{d\epsilon} (\text{分子}) = \frac{d}{d\epsilon} \int_{-\infty}^{x} \left( \int_{y}^{y+\epsilon} f(s,t) \,dt \right) \,ds = \int_{-\infty}^{x} f(s, y+\epsilon) \,ds$
> 7.  **代入 $\epsilon = 0$：**
>     * $\lim_{\epsilon \to 0} \frac{d}{d\epsilon} (\text{分母}) = f_Y(y)$
>     * $\lim_{\epsilon \to 0} \frac{d}{d\epsilon} (\text{分子}) = \int_{-\infty}^{x} f(s,y) \,ds$
> 8.  **得到条件 CDF：**
>     $$G_1(x|y) = \frac{\int_{-\infty}^{x} f(s,y) \,ds}{f_Y(y)}$$
>    
> 9.  **求条件 PDF：** 我们对条件 CDF $G_1(x|y)$ 求关于 $x$ 的导数。
>     $$g_1(x|y) = \frac{d}{dx} G_1(x|y) = \frac{d}{dx} \left[ \frac{\int_{-\infty}^{x} f(s,y) \,ds}{f_Y(y)} \right]$$
> 10. **最终公式：** 注意 $f_Y(y)$ 相对于 $x$ 是一个常数。
>     $$g_1(x|y) = \frac{1}{f_Y(y)} \cdot \frac{d}{dx} \left( \int_{-\infty}^{x} f(s,y) \,ds \right) = \frac{f(x,y)}{f_Y(y)}$$
>    

**结论：** 尽管推导过程复杂，但最终的公式和离散型完全一样。

**条件 PDF 公式：**
$$g_1(x|y) = \frac{\text{联合 PDF}}{\text{Y 的边际 PDF}} = \frac{f(x,y)}{f_Y(y)}$$
$$g_2(y|x) = \frac{\text{联合 PDF}}{\text{X 的边际 PDF}} = \frac{f(x,y)}{f_X(x)}$$