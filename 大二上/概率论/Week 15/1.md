# 8.4 Confidence Intervals (置信区间) 完整讲义

> [!abstract] 章节概览
> 本章基于课堂笔记整理，涵盖了置信区间定义的严谨表述、正态分布下均值与方差的区间估计、单侧置信区间以及枢轴量法的通用理论。
> - **核心定义**：Def 8.5.1, Def 8.5.2 (单侧), Def 8.5.3 (枢轴量)
> - **重要定理**：Thm 8.5.1 (均值, $\sigma$ 未知), Thm 8.5.2 (单侧), Thm 8.5.8 (枢轴量法)
> - **完整案例**：
>     - Example 1: 均值 CI ($\sigma$ 已知)
>     - Example 8.5.3: 数值计算 ($\sigma$ 未知)
>     - Example 8.5.4: 乳酸浓度 (含原始数据)
>     - Example 8.5.5: 人工降雨 (单侧区间)
>     - Example 8.5.8: 方差的 CI 推导

---

## 1. 基础定义 (Page 1)

### <font color="#2a9d8f">Def 8.5.1: Confidence Interval</font>

设 $\vec{X} = (X_1, X_2, ..., X_n)$ 是来自于依赖于参数 $\theta$ 的分布的一个随机样本。
设 $g(\theta)$ 是关于 $\theta$ 的实函数。
设 $A \le B$ 是两个统计量（仅依赖于样本，不依赖于 $\theta$），满足对于所有的 $\theta$ 值：

$$ \text{Pr}(A < g(\theta) < B) = \gamma $$

*   $(A, B)$ 被称为 $g(\theta)$ 的 **$\gamma$ 置信系数的置信区间 (Coefficient $\gamma$ Confidence Interval)**。
*   在观测到 $X_1, ..., X_n$ 后，计算出的数值 $A=a$ 和 $B=b$，区间 $(a, b)$ 被称为置信区间的 **observed value (观测值)**。

---

## 2. 正态分布均值的置信区间
### 情况一：方差 $\sigma^2$ 已知 (Page 1 Example)

**题目/情境**：
*   $X_i \sim N(\mu, \sigma^2)$
*   $\mu$ 未知 (unknown)，$\sigma^2$ 已知 (known)。
*   目标：对于 $0 < \gamma < 1$，寻找 $\mu$ 的精确置信区间 $(A, B)$。

**推导过程 (Derivation)**：
1.  **构造统计量**：
    样本均值 $\bar{X}_n \sim N(\mu, \frac{\sigma^2}{n})$。
    标准化后：
    $$ Z = \frac{\bar{X}_n - \mu}{\sigma/\sqrt{n}} \sim N(0, 1) $$
2.  **建立概率方程**：
    利用标准正态分布的分位点 $\Phi^{-1}$：
    $$ \text{Pr}\left( -\Phi^{-1}\left(\frac{1+\gamma}{2}\right) < \frac{\bar{X}_n - \mu}{\sigma/\sqrt{n}} < \Phi^{-1}\left(\frac{1+\gamma}{2}\right) \right) = \gamma $$
    *注：图中令 $\frac{1+\gamma}{2}$ 处的分位点为 $z$。*
3.  **解不等式**：
    $$ -\frac{\sigma}{\sqrt{n}}\Phi^{-1}(\dots) < \bar{X}_n - \mu < \frac{\sigma}{\sqrt{n}}\Phi^{-1}(\dots) $$
    $$ -\bar{X}_n - \frac{\sigma}{\sqrt{n}}\Phi^{-1}(\dots) < -\mu < -\bar{X}_n + \frac{\sigma}{\sqrt{n}}\Phi^{-1}(\dots) $$
    同时乘 -1 变号：
    $$ \bar{X}_n - \frac{\sigma}{\sqrt{n}}\Phi^{-1}\left(\frac{1+\gamma}{2}\right) < \mu < \bar{X}_n + \frac{\sigma}{\sqrt{n}}\Phi^{-1}\left(\frac{1+\gamma}{2}\right) $$
4.  **结论**：
    $$ A = \bar{X}_n - \frac{\sigma}{\sqrt{n}}\Phi^{-1}\left(\frac{1+\gamma}{2}\right), \quad B = \bar{X}_n + \frac{\sigma}{\sqrt{n}}\Phi^{-1}\left(\frac{1+\gamma}{2}\right) $$

---

### 情况二：方差 $\sigma^2$ 未知 (Page 2 Thm 8.5.1)

**<font color="#e76f51">Theorem 8.5.1: Confidence Interval for the mean of a normal distribution</font>**

**证明 (Proof)**：
1.  **前提**：$X_i \sim N(\mu, \sigma^2)$。
2.  **统计量定义**：
    *   $\bar{X}_n = \frac{1}{n}\sum X_i$ (Sample mean)
    *   $\sigma' = \sqrt{\frac{\sum(X_i - \bar{X}_n)^2}{n-1}}$ (Sample standard deviation)
3.  **构造枢轴量**：
    $$ T = \frac{\bar{X}_n - \mu}{\sigma'/\sqrt{n}} \sim t_{n-1} $$
    该统计量服从自由度为 $n-1$ 的 $t$-分布 (Student's t-distribution)。
4.  **推导**：
    对于给定的系数 $\gamma \in (0,1)$，选择 $c = T_{n-1}^{-1}\left(\frac{1+\gamma}{2}\right)$。
    $$ \text{Pr}(-c < T < c) = \gamma $$
    $$ \implies \text{Pr}\left( \bar{X}_n - c\frac{\sigma'}{\sqrt{n}} < \mu < \bar{X}_n + c\frac{\sigma'}{\sqrt{n}} \right) = \gamma $$
    即置信区间为：
    $$ \left( \bar{X}_n - \frac{\sigma'}{\sqrt{n}} T_{n-1}^{-1}\left(\frac{1+\gamma}{2}\right), \quad \bar{X}_n + \frac{\sigma'}{\sqrt{n}} T_{n-1}^{-1}\left(\frac{1+\gamma}{2}\right) \right) $$

---

### <font color="#e9c46a">Example 8.5.3 (数值计算)</font>

**题目题干**：
已知样本统计量：$\bar{x}_n = 5.134, \quad \sigma' = 1.6, \quad n=26$。
求 $\mu$ 的 $95\%$ 置信区间 ($\gamma = 0.95$)。

**计算过程**：
1.  **自由度**：$n-1 = 25$。
2.  **查表 ($t$ 分位点)**：
    需要 $T_{25}^{-1}\left(\frac{1+0.95}{2}\right) = T_{25}^{-1}(0.975)$。
    查表得数值 $\approx 2.060$。
3.  **计算误差项 (Margin of Error)**：
    $$ \text{Error} = \frac{\sigma'}{\sqrt{n}} \times c = \frac{1.6}{\sqrt{26}} \times 2.060 $$
    $$ = 1.6 \times 0.404 = 0.6464 $$
4.  **计算区间端点**：
    *   $a = 5.134 - 0.6464 = 4.4876 \approx 4.488$
    *   $b = 5.134 + 0.6464 = 5.7804 \approx 5.780$
5.  **结果**：
    95% Confidence Interval is $(4.488, 5.780)$。

---

### <font color="#e9c46a">Example 8.5.4 (Lactic Acid 乳酸浓度 - 含原始数据)</font>

**题目题干**：
研究乳酸浓度 (lactic acid)。
给定 $\gamma = 0.9$，样本量 $n=10$。
**原始样本数据**（笔记底部手写补充）：
$0.86, 1.53, 1.57, 1.81, 0.99, 1.09, 1.29, 1.78, 1.29, 1.58$。

**计算过程**：
1.  **计算样本均值 $\bar{x}_n$**：
    $$ \bar{x}_n = \frac{0.86 + 1.53 + 1.57 + 1.81 + 0.99 + 1.09 + 1.29 + 1.78 + 1.29 + 1.58}{10} = 1.379 $$
2.  **计算样本标准差 $\sigma'$**：
    笔记直接给出计算结果：
    $$ \sigma' = \sqrt{\frac{\sum(X_i - \bar{x}_n)^2}{n-1}} = 0.3277 $$
    (注：$\sigma'^2 \approx 0.107$, 开根号得 0.3277)
3.  **确定 $t$ 分位点**：
    自由度 $df = 9$。
    需要 $(1+0.9)/2 = 0.95$ 分位点。
    $$ c = T_{9}^{-1}(0.95) = 1.833 $$
4.  **计算区间**：
    $$ C \cdot \frac{\sigma'}{\sqrt{n}} = 1.833 \times \frac{0.3277}{\sqrt{10}} \approx 1.833 \times 0.1036 \approx 0.190 $$
    *   下界：$1.379 - 0.190 = 1.189$ (笔记中写 1.185，可能是因手算 $\frac{1.833 \times 0.3277}{3.16}$ 的精度误差)
    *   上界：$1.379 + 0.190 = 1.569$
5.  **结果**：
    置信区间为 $(1.185, 1.569)$。

---

## 3. 单侧置信区间 (Page 3)

### Def 8.5.2 & Thm 8.5.2 One-sided Confidence Intervals

**定义**：
*   **Lower (下限)**：$A = \bar{X}_n - \frac{\sigma'}{\sqrt{n}} T_{n-1}^{-1}(\gamma)$。满足 $\text{Pr}(A < \mu) = \gamma$。
*   **Upper (上限)**：$B = \bar{X}_n + \frac{\sigma'}{\sqrt{n}} T_{n-1}^{-1}(\gamma)$。满足 $\text{Pr}(\mu < B) = \gamma$。
    *(注意：单侧区间使用的分位点是 $T^{-1}(\gamma)$ 而不是 $T^{-1}(\frac{1+\gamma}{2})$)*

**推导思路**：
$$ A = \bar{X}_n - \frac{\sigma'}{\sqrt{n}}T_{n-1}^{-1}(\gamma) \iff \bar{X}_n - \frac{\sigma'}{\sqrt{n}}T_{n-1}^{-1}(\gamma) < \mu $$
$$ \iff \frac{\bar{X}_n - \mu}{\sigma'/\sqrt{n}} < T_{n-1}^{-1}(\gamma) \iff T < T_{n-1}^{-1}(\gamma) $$
由定义知 $\text{Pr}(T < T^{-1}(\gamma)) = \gamma$，证毕。

### <font color="#e9c46a">Example 8.5.5: Rain from seeded clouds</font>

**题目题干**：
*   $n=26, \bar{x}_n = 5.134, \sigma' = 1.6$。
*   求 $\mu$ 的 **One-sided Lower Confidence Interval** (单侧下置信区间)。
*   $\gamma = 0.9$。

**计算过程**：
1.  **查表**：
    $n-1 = 25$。
    $T_{25}^{-1}(0.9) = 1.316$。
2.  **代入公式**：
    $$ A = \bar{x}_n - \frac{\sigma'}{\sqrt{n}} T_{25}^{-1}(0.9) $$
    $$ A = 5.134 - 1.316 \times \frac{1.6}{\sqrt{26}} $$
    $$ A \approx 5.134 - 1.316 \times 0.3137 \approx 5.134 - 0.413 = 4.721 $$
3.  **结果**：
    Lower limit is $4.721$. 区间表示为 $(4.721, \infty)$。

---

## 4. 枢轴量法与方差估计 (Page 4 & 5)

### Def 8.5.3: Pivotal Quantity (枢轴量)

设 $\vec{X}$ 是随机样本，分布依赖参数 $\theta$。
设 $V(\vec{X}, \theta)$ 是一个随机变量。
如果 $V$ 的**分布**与参数 $\theta$ **无关**，则称 $V$ 为一个 **Pivotal Quantity**。

**Theorem 8.5.8 (构造方法)**：
1.  设 $G$ 是 $V$ 的 CDF。
2.  $A = r(G^{-1}(\gamma_1), X)$，$B = r(G^{-1}(\gamma_2), X)$，其中 $r$ 是关于 $\theta$ 的反解函数。

### <font color="#e9c46a">Example 8.5.8: Pivotal for Estimating the Variance</font>

**题目**：
估计正态分布 $N(\mu, \sigma^2)$ 的方差 $\sigma^2$。

**推导过程**：
1.  **选择枢轴量**：
    $$ V = \frac{\sum_{i=1}^n (X_i - \bar{X}_n)^2}{\sigma^2} = \frac{(n-1)\sigma'^2}{\sigma^2} $$
    根据 Thm 8.3.1，该统计量服从 $\chi^2(n-1)$ (卡方分布)，与 $\mu, \sigma^2$ 无关，故为枢轴量。

2.  **设定概率**：
    $$ \text{Pr}(c_1 < V < c_2) = \gamma $$
    令 $c_1 = G_{n-1}^{-1}(\gamma_1)$，$c_2 = G_{n-1}^{-1}(\gamma_2)$。
    通常取 $\gamma_1 = \frac{1-\gamma}{2}, \gamma_2 = \frac{1+\gamma}{2}$。

3.  **不等式变换 (Page 5)**：
    $$ G_{n-1}^{-1}(\gamma_1) < \frac{\sum (X_i - \bar{X}_n)^2}{\sigma^2} < G_{n-1}^{-1}(\gamma_2) $$
    因为 $V > 0$ 且各项均为正，取倒数（变号）：
    $$ \frac{1}{G_{n-1}^{-1}(\gamma_1)} > \frac{\sigma^2}{\sum (X_i - \bar{X}_n)^2} > \frac{1}{G_{n-1}^{-1}(\gamma_2)} $$
    整理顺序：
    $$ \frac{1}{G_{n-1}^{-1}(\gamma_2)} < \frac{\sigma^2}{\sum (X_i - \bar{X}_n)^2} < \frac{1}{G_{n-1}^{-1}(\gamma_1)} $$
    两边乘上分子：
    $$ \frac{\sum_{i=1}^n (X_i - \bar{X}_n)^2}{G_{n-1}^{-1}(\gamma_2)} < \sigma^2 < \frac{\sum_{i=1}^n (X_i - \bar{X}_n)^2}{G_{n-1}^{-1}(\gamma_1)} $$

**结论**：
方差 $\sigma^2$ 的置信区间为：
$$ \left( \frac{\sum (X_i - \bar{X}_n)^2}{\chi^2_{1-\alpha/2}}, \quad \frac{\sum (X_i - \bar{X}_n)^2}{\chi^2_{\alpha/2}} \right) $$
(注：笔记中使用 $G^{-1}$ 表示分位点，$\gamma_2$ 对应大的概率值，即分布右侧的点)。